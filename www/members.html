<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>My Garage â€“ My Car Concierge</title>
  <script>
    (function() {
      const theme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#12161c" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="My Car Concierge" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />
  <!-- Preload critical resources -->
  <link rel="preload" href="/members-core.js" as="script" />
  <link rel="preload" href="/supabaseclient.js" as="script" />
  <link rel="preload" href="/logo.png" as="image" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Preconnect to external services -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://js.stripe.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="dns-prefetch" href="https://supabase.co">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/shared-styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" defer></script>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    :root {
      /* Automotive Theme - Warmer, garage-inspired */
      --bg-deep: #12161c;
      --bg-card: rgba(26, 32, 42, 0.9);
      --bg-elevated: rgba(36, 44, 56, 0.95);
      --bg-input: rgba(30, 38, 48, 0.9);
      --text-primary: #f5f5f7;
      --text-secondary: #a0a8b8;
      --text-muted: #6b7280;
      /* Bronze/copper - engine metal vibes */
      --accent-gold: #c9a227;
      --accent-gold-soft: rgba(201, 162, 39, 0.18);
      --accent-bronze: #cd7f32;
      --accent-bronze-soft: rgba(205, 127, 50, 0.15);
      /* Coolant teal - automotive fluid accent */
      --accent-teal: #22d3ee;
      --accent-teal-soft: rgba(34, 211, 238, 0.12);
      --accent-blue: #38bdf8;
      --accent-blue-soft: rgba(56, 189, 248, 0.12);
      --accent-green: #34d399;
      --accent-green-soft: rgba(52, 211, 153, 0.12);
      --accent-red: #f87171;
      --accent-red-soft: rgba(248, 113, 113, 0.15);
      --accent-orange: #fb923c;
      --accent-orange-soft: rgba(251, 146, 60, 0.15);
      --border-subtle: rgba(160, 168, 184, 0.15);
      --border-medium: rgba(160, 168, 184, 0.25);
      --border-focus: rgba(56, 189, 248, 0.5);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }


    /* Light mode sidebar - clean white with navy accents */
    [data-theme="light"] .sidebar {
      background: linear-gradient(180deg, #ffffff 0%, #fefdfb 100%);
      border-right: 1px solid rgba(30, 58, 95, 0.1);
    }
    [data-theme="light"] .sidebar-footer {
      background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.95));
    }
    [data-theme="light"] .user-info {
      background: linear-gradient(135deg, #ffffff, #fefdfb);
      border: 1px solid rgba(30, 58, 95, 0.1);
    }
    [data-theme="light"] .nav-item:hover {
      background: rgba(30, 58, 95, 0.06);
      border-color: rgba(30, 58, 95, 0.15);
    }
    /* Light mode mobile sidebar overlay */
    [data-theme="light"] .sidebar-overlay {
      background: rgba(0, 0, 0, 0.3);
    }
    @media (max-width: 900px) {
      [data-theme="light"] .sidebar {
        background: linear-gradient(180deg, #ffffff 0%, #fefdfb 100%);
      }
      [data-theme="light"] .sidebar-footer {
        background: rgba(255, 255, 255, 0.95);
      }
    }
    [data-theme="light"] .nav-item.active {
      background: linear-gradient(135deg, rgba(184, 148, 45, 0.15), rgba(184, 148, 45, 0.08));
      color: #1e3a5f;
      border-color: rgba(184, 148, 45, 0.4);
    }

    /* Light mode cards - clean white with navy shadows */
    [data-theme="light"] .card,
    [data-theme="light"] .stat-card,
    [data-theme="light"] .vehicle-card {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(30, 58, 95, 0.06), 0 1px 2px rgba(30, 58, 95, 0.04);
      border: 1px solid rgba(30, 58, 95, 0.08);
    }
    [data-theme="light"] .stat-card:hover,
    [data-theme="light"] .vehicle-card:hover {
      box-shadow: 0 6px 20px rgba(30, 58, 95, 0.1);
    }

    /* Theme transition */
    html.theme-transition,
    html.theme-transition *,
    html.theme-transition *::before,
    html.theme-transition *::after {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease !important;
    }

    /* Theme Toggle Button */
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.2rem;
    }
    .theme-toggle:hover {
      background: var(--accent-gold-soft);
      border-color: var(--accent-gold);
      transform: scale(1.05);
    }

    /* Headlight Theme Toggle */
    .theme-toggle-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 14px;
      margin-bottom: 8px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.88rem;
      color: var(--text-secondary);
      transition: all 0.3s ease;
    }
    .theme-toggle-btn:hover {
      background: var(--accent-gold-soft);
      border-color: var(--accent-gold);
      color: var(--accent-gold);
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(201, 162, 39, 0.2);
    }
    .theme-icon-dark, .theme-icon-light {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }
    [data-theme="dark"] .theme-icon-light { display: none; }
    [data-theme="light"] .theme-icon-dark { display: none; }
    [data-theme="dark"] .theme-toggle-btn:hover .theme-icon-dark {
      animation: flashlight 0.5s ease;
    }
    @keyframes flashlight {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); filter: drop-shadow(0 0 8px #ffd700); }
    }
    .theme-label { font-weight: 500; }

    * { box-sizing: border-box; margin: 0; padding: 0; scrollbar-width: thin; scrollbar-color: var(--border-medium) var(--bg-deep); }
    body { min-height: 100vh; font-family: 'Outfit', -apple-system, sans-serif; background: var(--bg-deep); color: var(--text-primary); display: flex; overflow-x: hidden; }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-deep); }
    ::-webkit-scrollbar-thumb { background: var(--border-medium); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

    /* Sidebar */
    .sidebar { width: 260px; background: linear-gradient(180deg, rgba(18, 18, 28, 0.98) 0%, rgba(12, 12, 20, 0.99) 100%); border-right: 1px solid var(--border-subtle); padding: 20px 12px; display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 50; overflow-y: auto; backdrop-filter: blur(20px); scrollbar-width: none; -ms-overflow-style: none; }
    .sidebar::-webkit-scrollbar { display: none; }
    .sidebar-brand { display: flex; align-items: center; justify-content: center; padding: 8px 12px 20px; border-bottom: 1px solid rgba(148, 148, 168, 0.08); margin-bottom: 20px; text-decoration: none; }
    .sidebar-brand-icon { height: 100px; width: auto; border-radius: var(--radius-md); image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges; filter: brightness(1.1) contrast(1.05) drop-shadow(0 4px 16px rgba(212, 168, 85, 0.35)); transition: all 0.3s ease; }
    .sidebar-brand:hover .sidebar-brand-icon { filter: brightness(1.15) contrast(1.1) drop-shadow(0 8px 32px rgba(212, 168, 85, 0.6)); transform: scale(1.03); }
    .sidebar-brand-text { font-family: 'Playfair Display', serif; font-weight: 500; color: var(--text-primary); font-size: 1.05rem; }
    .nav-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--text-muted); padding: 16px 14px 8px; margin-bottom: 4px; font-weight: 600; opacity: 0.7; }
    .nav-label:first-of-type { margin-top: 0; padding-top: 0; }
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 11px 14px; border-radius: 10px; cursor: pointer; font-size: 0.88rem; color: var(--text-secondary); transition: all 0.2s ease; margin-bottom: 2px; border: 1px solid transparent; font-weight: 450; }
    .nav-item:hover { background: rgba(74, 124, 255, 0.08); color: var(--text-primary); border-color: rgba(74, 124, 255, 0.12); }
    .nav-item.active { background: linear-gradient(135deg, rgba(74, 124, 255, 0.15), rgba(74, 124, 255, 0.08)); color: var(--accent-blue); border-color: rgba(74, 124, 255, 0.25); font-weight: 500; }
    .nav-badge { margin-left: auto; background: var(--accent-gold); color: var(--bg-deep); font-size: 0.7rem; font-weight: 600; padding: 3px 8px; border-radius: 100px; min-width: 22px; text-align: center; }
    .sidebar-footer { margin-top: auto; padding: 16px; border-top: 1px solid rgba(148, 148, 168, 0.08); background: linear-gradient(180deg, transparent, rgba(18, 18, 28, 0.5)); }
    .user-info { display: flex; align-items: center; gap: 12px; padding: 12px 14px; border-radius: 12px; background: linear-gradient(135deg, rgba(28, 28, 42, 0.6), rgba(18, 18, 28, 0.8)); margin-bottom: 12px; border: 1px solid rgba(148, 148, 168, 0.08); }
    .user-avatar { width: 38px; height: 38px; background: linear-gradient(135deg, var(--accent-blue), #6b9fff); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; box-shadow: 0 2px 8px rgba(74, 124, 255, 0.25); }
    .user-name { font-size: 0.88rem; font-weight: 500; }
    .user-email { font-size: 0.75rem; color: var(--text-muted); }

    /* Loyalty Badges */
    .loyalty-badges { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .loyalty-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 600; letter-spacing: 0.02em; }
    .loyalty-badge.vip { background: linear-gradient(135deg, #c9a227, #e8bc5a); color: var(--bg-deep); box-shadow: 0 2px 8px rgba(201, 162, 39, 0.35); border: 1px solid rgba(232, 188, 90, 0.5); }
    .loyalty-badge.trusted { background: var(--accent-teal-soft); color: var(--accent-teal); border: 1px solid rgba(34, 211, 238, 0.4); }
    .loyalty-badge.loyal { background: var(--accent-bronze-soft); color: var(--accent-bronze); border: 1px solid rgba(205, 127, 50, 0.4); }
    .preferred-provider-info { margin-top: 8px; padding: 8px 12px; background: var(--accent-gold-soft); border-radius: var(--radius-sm); border: 1px solid rgba(201, 162, 39, 0.3); font-size: 0.75rem; color: var(--accent-gold); }

    /* Main */
    .main { flex: 1; margin-left: 260px; padding: 32px 40px 100px; min-height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
    .page-header { margin-bottom: 32px; }
    .page-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 500; margin-bottom: 8px; }
    .page-subtitle { color: var(--text-secondary); font-size: 0.95rem; }

    /* Stats */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 32px; }
    /* Premium Stat Cards - Turo Style */
    .stat-card { background: linear-gradient(145deg, var(--bg-card), rgba(20, 26, 36, 0.95)); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.03); }
    .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent-gold), var(--accent-blue)); opacity: 0; transition: opacity 0.3s ease; }
    .stat-card:hover { border-color: var(--accent-gold); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
    .stat-card:hover::before { opacity: 1; }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 16px; }
    .stat-icon.blue { background: linear-gradient(135deg, rgba(100,181,246,0.2), rgba(100,181,246,0.1)); }
    .stat-icon.gold { background: linear-gradient(135deg, rgba(212,168,85,0.2), rgba(212,168,85,0.1)); }
    .stat-icon.green { background: linear-gradient(135deg, rgba(129,199,132,0.2), rgba(129,199,132,0.1)); }
    .stat-icon.orange { background: linear-gradient(135deg, rgba(255,183,77,0.2), rgba(255,183,77,0.1)); }
    .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 4px; letter-spacing: -0.5px; }
    .stat-label { font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }

    /* Cards */
    .card { background: linear-gradient(145deg, var(--bg-card), rgba(20, 26, 36, 0.95)); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.03); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .card-title { font-size: 1.1rem; font-weight: 600; }
    
    /* Onboarding Checklist */
    .onboarding-card { background: linear-gradient(145deg, rgba(201, 162, 39, 0.08), rgba(26, 32, 42, 0.95)); border: 1px solid rgba(201, 162, 39, 0.2); }
    .onboarding-steps { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    .onboarding-step { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; }
    .onboarding-step:hover { border-color: var(--accent-gold); background: rgba(201, 162, 39, 0.05); }
    .onboarding-step.completed { opacity: 0.6; }
    .onboarding-step.completed .step-check { background: var(--accent-green); color: #fff; }
    .step-check { width: 32px; height: 32px; border-radius: 50%; background: var(--accent-gold); color: var(--bg-deep); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; flex-shrink: 0; }
    .step-content { flex: 1; }
    .step-name { display: block; font-weight: 600; margin-bottom: 2px; }
    .step-desc { display: block; font-size: 0.85rem; color: var(--text-secondary); }
    .step-arrow { color: var(--text-muted); font-size: 1.2rem; }
    .onboarding-progress { display: flex; align-items: center; gap: 12px; }
    .progress-bar { flex: 1; height: 6px; background: var(--bg-input); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold), var(--accent-green)); border-radius: 3px; transition: width 0.3s ease; }
    .progress-text { font-size: 0.8rem; color: var(--text-secondary); white-space: nowrap; }

    /* Buttons */
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; font-family: inherit; font-size: 0.88rem; font-weight: 500; border: none; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; text-decoration: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .btn-primary { background: linear-gradient(135deg, var(--accent-blue), #5eb8f7); box-shadow: 0 2px 12px rgba(56, 189, 248, 0.3); color: #fff; }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(56, 189, 248, 0.4); }
    .btn-secondary { background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-subtle); }
    .btn-secondary:hover { border-color: var(--border-medium); }
    .btn-ghost { background: transparent; color: var(--text-secondary); padding: 8px 12px; }
    .btn-sm { padding: 6px 12px; font-size: 0.82rem; }
    .btn-success { background: linear-gradient(135deg, var(--accent-green), #4ade80); box-shadow: 0 2px 12px rgba(52, 211, 153, 0.3); color: #022c22; }
    .btn-gold { background: linear-gradient(135deg, var(--accent-gold), #e6b84a); color: var(--bg-deep); box-shadow: 0 2px 12px rgba(201, 162, 39, 0.3); }
    .btn-danger { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); border: 1px solid rgba(239, 95, 95, 0.3); }

    /* Export Dropdown */
    .export-option:hover { background: var(--accent-blue-soft); color: var(--accent-blue); }

    /* Vehicle Cards */
    /* Premium Vehicle Cards - Turo Style */
    .vehicles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 24px; }
    .vehicle-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 20px; overflow: hidden; transition: all 0.3s ease; }
    .vehicle-card:hover { border-color: var(--accent-gold); transform: translateY(-6px); box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .vehicle-card-photo { position: relative; height: 200px; background: linear-gradient(135deg, var(--bg-elevated), var(--bg-input)); display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .vehicle-card-photo img { width: 100%; height: 100%; object-fit: cover; }
    .vehicle-card-photo .vehicle-emoji { font-size: 80px; opacity: 0.9; }
    .vehicle-card-badge { position: absolute; top: 12px; right: 12px; padding: 6px 14px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .vehicle-card-badge.excellent { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; }
    .vehicle-card-badge.good { background: linear-gradient(135deg, var(--accent-gold), #c9a227); color: #1a1a2e; }
    .vehicle-card-badge.fair { background: linear-gradient(135deg, #ff9800, #f57c00); color: white; }
    .vehicle-card-body { padding: 20px 24px 24px; }
    .vehicle-card-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 4px; letter-spacing: -0.3px; }
    .vehicle-card-subtitle { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; }
    .vehicle-card-meta { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; font-size: 0.85rem; color: var(--text-muted); }
    .vehicle-card-meta span { display: flex; align-items: center; gap: 6px; }
    .vehicle-card-actions { display: flex; gap: 10px; padding-top: 16px; border-top: 1px solid var(--border-subtle); }
    .vehicle-image { height: 160px; background: linear-gradient(135deg, rgba(74, 124, 255, 0.1), rgba(212, 168, 85, 0.1)); display: flex; align-items: center; justify-content: center; font-size: 56px; border-bottom: 1px solid var(--border-subtle); position: relative; }
    .vehicle-image img { width: 100%; height: 100%; object-fit: cover; }
    .health-badge { position: absolute; top: 12px; right: 12px; padding: 4px 10px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; }
    .health-badge.excellent { background: var(--accent-green-soft); color: var(--accent-green); }
    .health-badge.good { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .health-badge.fair { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .health-badge.poor { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    
    /* Recall Alert Badge */
    .recall-badge { position: absolute; top: 12px; left: 12px; padding: 5px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; background: linear-gradient(135deg, #ef5f5f, #dc3545); color: white; display: flex; align-items: center; gap: 5px; cursor: pointer; animation: pulse-recall 2s infinite; z-index: 5; box-shadow: 0 2px 8px rgba(239, 95, 95, 0.4); }
    .recall-badge:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(239, 95, 95, 0.5); }
    @keyframes pulse-recall { 0%, 100% { box-shadow: 0 2px 8px rgba(239, 95, 95, 0.4); } 50% { box-shadow: 0 2px 16px rgba(239, 95, 95, 0.7); } }
    
    /* Recall Card Styles */
    .recall-card { background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; margin-bottom: 12px; transition: all 0.2s; }
    .recall-card:hover { border-color: var(--border-medium); }
    .recall-card.unacknowledged { border-left: 3px solid var(--accent-red); }
    .recall-card.acknowledged { opacity: 0.7; border-left: 3px solid var(--accent-green); }
    .recall-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .recall-card-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 4px; }
    .recall-card-campaign { font-size: 0.78rem; color: var(--text-muted); }
    .recall-card-status { padding: 4px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 600; }
    .recall-card-status.active { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .recall-card-status.addressed { background: var(--accent-green-soft); color: var(--accent-green); }
    .recall-card-section { margin-bottom: 12px; }
    .recall-card-section-title { font-size: 0.78rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
    .recall-card-section-content { font-size: 0.88rem; color: var(--text-secondary); line-height: 1.5; }
    .recall-card-actions { display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--border-subtle); }
    
    .vehicle-content { padding: 20px; }
    .vehicle-name { font-size: 1.15rem; font-weight: 600; margin-bottom: 4px; }
    .vehicle-details { font-size: 0.88rem; color: var(--text-secondary); margin-bottom: 12px; }
    .vehicle-meta { display: flex; gap: 16px; flex-wrap: wrap; padding-top: 12px; border-top: 1px solid var(--border-subtle); font-size: 0.82rem; color: var(--text-muted); margin-bottom: 16px; }
    .vehicle-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Package Cards */
    .packages-list { display: flex; flex-direction: column; gap: 16px; }
    .package-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; }
    .package-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .package-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 4px; }
    .package-vehicle { font-size: 0.88rem; color: var(--text-secondary); }
    .package-status { padding: 4px 12px; border-radius: 100px; font-size: 0.78rem; font-weight: 500; }
    .package-status.open { background: var(--accent-green-soft); color: var(--accent-green); }
    .package-status.pending { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .package-status.accepted { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .package-status.completed { background: var(--bg-elevated); color: var(--text-muted); }
    .package-status.expired { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .package-meta { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 16px; font-size: 0.85rem; color: var(--text-muted); }
    .package-meta span { display: flex; align-items: center; gap: 6px; }
    .package-description { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px; line-height: 1.6; }
    .package-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 16px; border-top: 1px solid var(--border-subtle); }
    .bid-count { font-size: 0.88rem; color: var(--accent-gold); font-weight: 500; }

    /* Bids List */
    .bids-list { display: flex; flex-direction: column; gap: 12px; margin-top: 16px; }
    .bid-card { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px 20px; }
    .bid-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .bid-provider { display: flex; align-items: center; gap: 12px; }
    .bid-avatar { width: 40px; height: 40px; background: var(--accent-gold-soft); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; }
    .bid-provider-info h4 { font-size: 0.95rem; font-weight: 600; margin-bottom: 2px; }
    .bid-rating { font-size: 0.82rem; color: var(--accent-gold); }
    .bid-price { font-size: 1.3rem; font-weight: 600; color: var(--accent-gold); }
    .bid-details { font-size: 0.88rem; color: var(--text-secondary); margin-bottom: 12px; }
    .bid-actions { display: flex; gap: 8px; }

    /* Messages */
    .messages-container { max-height: 300px; overflow-y: auto; margin-bottom: 16px; padding: 16px; background: var(--bg-input); border-radius: var(--radius-md); }
    .message { margin-bottom: 12px; }
    .message.sent { text-align: right; }
    .message-bubble { display: inline-block; max-width: 80%; padding: 10px 14px; border-radius: var(--radius-md); font-size: 0.9rem; }
    .message.received .message-bubble { background: var(--bg-elevated); color: var(--text-primary); }
    .message.sent .message-bubble { background: var(--accent-blue); color: white; }
    .message-time { font-size: 0.72rem; color: var(--text-muted); margin-top: 4px; }
    .message-input-row { display: flex; gap: 12px; }
    .message-input-row input { flex: 1; }

    /* Modals */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 100; padding: 24px; overflow-y: auto; }
    .modal-backdrop.active { display: flex; }
    .modal { background: var(--bg-elevated); border: 1px solid var(--border-medium); border-radius: var(--radius-xl); width: 100%; max-width: 600px; max-height: 90vh; overflow-y: auto; animation: modalIn 0.2s ease; }
    .modal.wide { max-width: 800px; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 24px 28px; border-bottom: 1px solid var(--border-subtle); position: sticky; top: 0; background: var(--bg-elevated); z-index: 10; }
    .modal-title { font-size: 1.15rem; font-weight: 600; }
    .modal-close { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; color: var(--text-muted); cursor: pointer; border-radius: var(--radius-sm); font-size: 20px; }
    .modal-close:hover { background: var(--bg-input); color: var(--text-primary); }
    .modal-body { padding: 24px 28px; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 12px; padding: 20px 28px; border-top: 1px solid var(--border-subtle); }

    /* Forms */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary); }
    .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 16px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit; font-size: 0.92rem; transition: all 0.15s ease; }
    .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--border-focus); box-shadow: 0 0 0 3px rgba(74, 124, 255, 0.1); }
    .form-input::placeholder, .form-textarea::placeholder { color: var(--text-muted); }
    .form-textarea { min-height: 100px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
    .form-hint { font-size: 0.78rem; color: var(--text-muted); margin-top: 6px; }
    .form-section { margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid var(--border-subtle); }
    .form-section:last-child { border-bottom: none; margin-bottom: 0; }
    .form-section-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 16px; color: var(--text-primary); }

    /* Parts Tier Selection */
    .parts-tiers { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .parts-tier { background: var(--bg-input); border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; text-align: center; transition: all 0.15s; }
    .parts-tier:hover { border-color: var(--border-medium); }
    .parts-tier.selected { border-color: var(--accent-gold); background: var(--accent-gold-soft); }
    .parts-tier-name { font-weight: 600; margin-bottom: 4px; }
    .parts-tier-desc { font-size: 0.78rem; color: var(--text-muted); }

    /* Oil/Fluid Preference */
    .oil-preference-toggle { display: flex; flex-direction: column; gap: 10px; }
    .oil-pref-option { display: flex; align-items: flex-start; gap: 12px; background: var(--bg-input); border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 14px 16px; cursor: pointer; transition: all 0.15s; }
    .oil-pref-option:hover { border-color: var(--border-medium); }
    .oil-pref-option.selected { border-color: var(--accent-gold); background: var(--accent-gold-soft); }
    .oil-pref-radio { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--border-medium); flex-shrink: 0; margin-top: 2px; position: relative; transition: all 0.15s; }
    .oil-pref-option.selected .oil-pref-radio { border-color: var(--accent-gold); }
    .oil-pref-option.selected .oil-pref-radio::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; border-radius: 50%; background: var(--accent-gold); }
    .oil-pref-content { flex: 1; }
    .oil-pref-name { font-weight: 600; font-size: 0.92rem; margin-bottom: 2px; }
    .oil-pref-desc { font-size: 0.78rem; color: var(--text-muted); }

    /* Transfer Type Options */
    .transfer-type-option:hover { border-color: var(--border-medium); }
    .transfer-type-option.selected { border-color: var(--accent-gold) !important; background: var(--accent-gold-soft) !important; }

    /* Pulse Animation for Timeline */
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(74, 124, 255, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(74, 124, 255, 0); }
    }

    /* Bidding Window Options */
    .bidding-window-options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
    .bid-window-option { background: var(--bg-input); border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 14px 10px; cursor: pointer; text-align: center; transition: all 0.15s; }
    .bid-window-option:hover { border-color: var(--border-medium); }
    .bid-window-option.selected { border-color: var(--accent-gold); background: var(--accent-gold-soft); }
    .bid-window-time { font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }
    .bid-window-desc { font-size: 0.72rem; color: var(--text-muted); }
    
    /* Countdown Timer */
    .countdown-timer { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--accent-gold-soft); border-radius: var(--radius-sm); font-size: 0.85rem; font-weight: 500; color: var(--accent-gold); }
    .countdown-timer.urgent { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .countdown-timer.expired { background: var(--bg-input); color: var(--text-muted); }

    /* Star Ratings */
    .star-rating { display: flex; gap: 4px; }
    .star-rating .star { font-size: 28px; color: var(--border-medium); cursor: pointer; transition: color 0.15s, transform 0.1s; }
    .star-rating .star:hover { transform: scale(1.1); }
    .star-rating .star.active { color: var(--accent-gold); }
    .star-rating.small .star { font-size: 20px; }

    /* Conversation Cards */
    .conversation-card:hover { background: var(--bg-elevated) !important; border-color: var(--border-medium) !important; }

    /* File Upload */
    .file-upload { display: block; border: 2px dashed var(--border-subtle); border-radius: var(--radius-md); padding: 20px; text-align: center; cursor: pointer; transition: all 0.15s; background: var(--bg-input); }
    .file-upload:hover { border-color: var(--accent-gold); background: var(--accent-gold-soft); }

    /* Photo Upload */
    .photo-upload-area { border: 2px dashed var(--border-subtle); border-radius: var(--radius-md); padding: 32px 24px; text-align: center; cursor: pointer; transition: all 0.15s; }
    .photo-upload-area:hover { border-color: var(--accent-gold); background: var(--accent-gold-soft); }
    .vehicle-photo-upload-container:hover { border-color: var(--accent-gold) !important; background: var(--accent-gold-soft) !important; }
    .photo-upload-icon { font-size: 32px; margin-bottom: 8px; }
    .photo-upload-text { font-weight: 500; margin-bottom: 4px; }
    .photo-upload-hint { font-size: 0.8rem; color: var(--text-muted); }
    .photo-previews { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; }
    .photo-preview { position: relative; width: 100px; height: 100px; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border-subtle); }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-preview-remove { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; }
    .photo-preview-remove:hover { background: var(--accent-red); }

    /* Tabs */
    .tabs { display: flex; gap: 4px; border-bottom: 1px solid var(--border-subtle); margin-bottom: 24px; }
    .tab { padding: 12px 20px; font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
    .tab:hover { color: var(--text-primary); }
    .tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }

    /* Service History */
    .history-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-subtle); }
    .history-item:last-child { border-bottom: none; }
    .history-date { width: 80px; flex-shrink: 0; text-align: center; }
    .history-date-day { font-size: 1.4rem; font-weight: 600; }
    .history-date-month { font-size: 0.78rem; color: var(--text-muted); text-transform: uppercase; }
    .history-content { flex: 1; }
    .history-title { font-weight: 600; margin-bottom: 4px; }
    .history-details { font-size: 0.88rem; color: var(--text-secondary); }
    .history-cost { font-weight: 600; color: var(--accent-gold); }

    /* Service History Cards */
    .service-history-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); margin-bottom: 16px; overflow: hidden; transition: all 0.2s ease; }
    .service-history-card:hover { border-color: var(--border-medium); }
    .service-history-card.expanded { border-color: var(--accent-blue); }

    /* Order History Cards */
    .order-history-list { display: flex; flex-direction: column; gap: 16px; }
    .order-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden; transition: all 0.2s ease; }
    .order-card:hover { border-color: var(--border-medium); }
    .order-card.expanded { border-color: var(--accent-blue); }
    .order-card-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; cursor: pointer; gap: 16px; flex-wrap: wrap; }
    .order-card-header:hover { background: var(--bg-elevated); }
    .order-card-info { display: flex; align-items: center; gap: 16px; flex: 1; flex-wrap: wrap; }
    .order-icon { width: 48px; height: 48px; border-radius: 12px; background: var(--accent-gold-soft); display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
    .order-meta { flex: 1; min-width: 200px; }
    .order-number { font-weight: 600; font-size: 1rem; margin-bottom: 4px; }
    .order-date { font-size: 0.85rem; color: var(--text-secondary); }
    .order-summary { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
    .order-items-count { font-size: 0.88rem; color: var(--text-muted); }
    .order-total { font-size: 1.15rem; font-weight: 600; color: var(--accent-gold); }
    .order-status { padding: 6px 14px; border-radius: 100px; font-size: 0.78rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .order-status.pending { background: rgba(148, 148, 168, 0.15); color: var(--text-muted); }
    .order-status.paid { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .order-status.processing { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .order-status.shipped { background: var(--accent-green-soft); color: var(--accent-green); }
    .order-status.delivered { background: var(--accent-gold-soft); color: var(--accent-gold); }
    .order-status.cancelled { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .order-expand-icon { font-size: 18px; color: var(--text-muted); transition: transform 0.2s; }
    .order-card.expanded .order-expand-icon { transform: rotate(180deg); }
    .order-details { display: none; padding: 0 24px 24px; border-top: 1px solid var(--border-subtle); }
    .order-card.expanded .order-details { display: block; padding-top: 20px; }
    .order-details-section { margin-bottom: 20px; }
    .order-details-section:last-child { margin-bottom: 0; }
    .order-details-title { font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em; }
    .order-item-row { display: flex; align-items: center; gap: 16px; padding: 12px 0; border-bottom: 1px solid var(--border-subtle); }
    .order-item-row:last-child { border-bottom: none; }
    .order-item-image { width: 60px; height: 60px; border-radius: var(--radius-sm); background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; font-size: 28px; overflow: hidden; flex-shrink: 0; }
    .order-item-image img { width: 100%; height: 100%; object-fit: cover; }
    .order-item-info { flex: 1; }
    .order-item-name { font-weight: 500; margin-bottom: 4px; }
    .order-item-variant { font-size: 0.82rem; color: var(--text-muted); }
    .order-item-qty { font-size: 0.88rem; color: var(--text-secondary); }
    .order-item-price { font-weight: 600; color: var(--accent-gold); }
    .order-shipping-info { background: var(--bg-input); border-radius: var(--radius-md); padding: 16px; }
    .order-shipping-info p { margin-bottom: 4px; font-size: 0.9rem; color: var(--text-secondary); }
    .order-shipping-info p:last-child { margin-bottom: 0; }
    .order-tracking-btn { margin-top: 12px; }
    .service-history-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; cursor: pointer; gap: 16px; flex-wrap: wrap; }
    .service-history-header:hover { background: var(--bg-elevated); }
    .service-history-provider { display: flex; align-items: center; gap: 14px; }
    .provider-avatar { width: 48px; height: 48px; border-radius: 12px; background: var(--accent-gold-soft); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; color: var(--accent-gold); flex-shrink: 0; }
    .provider-info { }
    .provider-name { font-weight: 600; font-size: 1rem; margin-bottom: 2px; }
    .service-date { font-size: 0.85rem; color: var(--text-muted); }
    .service-history-summary { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .service-status-badge { padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .service-status-badge.status-completed { background: var(--accent-green-soft); color: var(--accent-green); }
    .service-status-badge.status-refunded { background: rgba(239,95,95,0.15); color: var(--accent-red); }
    .service-total { font-size: 1.2rem; font-weight: 700; color: var(--accent-gold); }
    .service-history-body { padding: 0 20px 16px; border-top: 1px solid var(--border-subtle); background: var(--bg-input); }
    .service-info-row { display: flex; gap: 24px; padding: 14px 0; flex-wrap: wrap; }
    .service-info-item { flex: 1; min-width: 200px; }
    .info-label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 4px; }
    .info-value { font-weight: 500; font-size: 0.95rem; }
    .expand-btn { margin-top: 4px; }
    .expand-icon { display: inline-block; transition: transform 0.2s ease; margin-right: 4px; }
    .service-history-details { padding: 0 20px 20px; background: var(--bg-elevated); border-top: 1px solid var(--border-subtle); }
    .details-section { padding: 16px 0; border-bottom: 1px solid var(--border-subtle); }
    .details-section:last-child { border-bottom: none; }
    .details-section h4 { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .receipt-breakdown { }
    .receipt-items { margin-bottom: 16px; }
    .receipt-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed var(--border-subtle); font-size: 0.9rem; }
    .receipt-item:last-child { border-bottom: none; }
    .receipt-totals { background: var(--bg-card); border-radius: var(--radius-md); padding: 12px 16px; margin-top: 8px; }
    .receipt-line { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.9rem; color: var(--text-secondary); }
    .receipt-line.total { font-weight: 700; font-size: 1.05rem; color: var(--accent-gold); border-top: 1px solid var(--border-subtle); margin-top: 8px; padding-top: 12px; }
    .payment-method { margin-top: 12px; font-size: 0.85rem; color: var(--text-muted); }
    .technician-notes { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; background: var(--bg-card); padding: 12px 16px; border-radius: var(--radius-md); border-left: 3px solid var(--accent-blue); }
    .inspection-summary { display: flex; gap: 24px; flex-wrap: wrap; margin-bottom: 12px; }
    .inspection-condition { font-weight: 600; font-size: 0.95rem; }
    .inspection-mileage { font-size: 0.88rem; color: var(--text-muted); }
    .inspection-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px; margin: 12px 0; }
    .inspection-item { display: flex; justify-content: space-between; padding: 8px 12px; background: var(--bg-card); border-radius: var(--radius-sm); font-size: 0.85rem; }
    .item-name { color: var(--text-secondary); }
    .item-condition { font-weight: 600; text-transform: uppercase; font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; }
    .item-condition.status-good, .item-condition.status-excellent { color: var(--accent-green); background: var(--accent-green-soft); }
    .item-condition.status-fair { color: var(--accent-orange); background: var(--accent-orange-soft); }
    .item-condition.status-poor, .item-condition.status-needs_attention { color: var(--accent-red); background: rgba(239,95,95,0.15); }
    .inspection-notes { font-size: 0.88rem; color: var(--text-muted); font-style: italic; margin-top: 8px; }
    .details-actions { display: flex; gap: 12px; padding-top: 16px; flex-wrap: wrap; }

    /* Reminders */
    .reminder-item { display: flex; align-items: center; gap: 16px; padding: 14px 16px; background: var(--bg-input); border-radius: var(--radius-md); margin-bottom: 8px; border-left: 4px solid transparent; }
    .reminder-item.type-registration { border-left-color: var(--accent-blue); }
    .reminder-item.type-oil_change { border-left-color: var(--accent-gold); }
    .reminder-item.type-warranty { border-left-color: #9b59b6; }
    .reminder-item.type-maintenance { border-left-color: var(--accent-green); }
    .reminder-item.type-inspection { border-left-color: var(--accent-orange); }
    .reminder-item.type-tire_rotation { border-left-color: #3498db; }
    .reminder-item.type-brake_check { border-left-color: var(--accent-red); }
    .reminder-item.type-other { border-left-color: var(--text-muted); }
    .reminder-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; }
    .reminder-icon.due { background: var(--accent-orange-soft); }
    .reminder-icon.overdue { background: rgba(239, 95, 95, 0.15); }
    .reminder-icon.ok { background: var(--accent-green-soft); }
    .reminder-content { flex: 1; }
    .reminder-title { font-weight: 500; font-size: 0.92rem; }
    .reminder-type-badge { display: inline-block; font-size: 0.7rem; padding: 2px 8px; border-radius: 100px; background: var(--bg-elevated); color: var(--text-secondary); margin-left: 8px; text-transform: capitalize; }
    .reminder-due { font-size: 0.82rem; color: var(--text-muted); }
    .reminder-actions { display: flex; gap: 6px; align-items: center; }

    /* Service Recommendations */
    .recommendation-item { display: flex; align-items: flex-start; gap: 16px; padding: 16px; background: var(--bg-input); border-radius: var(--radius-md); margin-bottom: 12px; border-left: 4px solid var(--border-subtle); transition: all 0.2s ease; }
    .recommendation-item:hover { background: var(--bg-elevated); }
    .recommendation-item.priority-urgent { border-left-color: var(--accent-red); }
    .recommendation-item.priority-soon { border-left-color: var(--accent-orange); }
    .recommendation-item.priority-upcoming { border-left-color: #eab308; }
    .recommendation-item.priority-routine { border-left-color: var(--accent-blue); }
    .recommendation-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
    .recommendation-icon.urgent { background: rgba(239, 95, 95, 0.15); }
    .recommendation-icon.soon { background: var(--accent-orange-soft); }
    .recommendation-icon.upcoming { background: rgba(234, 179, 8, 0.15); }
    .recommendation-icon.routine { background: var(--accent-blue-soft); }
    .recommendation-content { flex: 1; min-width: 0; }
    .recommendation-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 6px; flex-wrap: wrap; }
    .recommendation-title { font-weight: 600; font-size: 0.95rem; }
    .recommendation-priority { display: inline-block; padding: 3px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .recommendation-priority.urgent { background: rgba(239, 95, 95, 0.2); color: var(--accent-red); }
    .recommendation-priority.soon { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .recommendation-priority.upcoming { background: rgba(234, 179, 8, 0.15); color: #eab308; }
    .recommendation-priority.routine { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .recommendation-reason { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; line-height: 1.5; }
    .recommendation-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 12px; }
    .recommendation-meta span { display: flex; align-items: center; gap: 4px; }
    .recommendation-vehicle { font-size: 0.78rem; color: var(--text-muted); background: var(--bg-elevated); padding: 2px 8px; border-radius: 4px; margin-bottom: 8px; display: inline-block; }
    .recommendation-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Empty State */
    .empty-state { text-align: center; padding: 48px 24px; color: var(--text-muted); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }

    /* Section visibility */
    .section { display: none; }
    .section.active { display: block; min-height: min-content; }

    /* Toast */
    .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 200; display: flex; flex-direction: column; gap: 12px; }
    .toast { background: var(--bg-elevated); border: 1px solid var(--border-medium); border-radius: var(--radius-md); padding: 16px 20px; display: flex; align-items: center; gap: 12px; animation: toastIn 0.3s ease; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
    @keyframes toastIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .toast.success { border-color: var(--accent-green); }
    .toast.error { border-color: var(--accent-red); }

    /* Mobile */
    @media (max-width: 900px) {
      body { display: block; overflow-y: scroll; -webkit-overflow-scrolling: touch; }
      .sidebar { transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); width: 300px; padding: 16px 14px; padding-bottom: 100px; overflow-y: auto; -webkit-overflow-scrolling: touch; position: fixed; top: 0; left: 0; height: 100%; z-index: 100; background: rgba(12, 12, 18, 0.98); }
      .sidebar.open { transform: translateX(0); box-shadow: 8px 0 40px rgba(0,0,0,0.6); }
      .main { margin-left: 0; padding: 24px 16px 120px; min-height: 100vh; overflow: visible; }
      .mobile-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
      .mobile-header > span { flex: 1; }
      .mobile-header .header-theme-toggle { margin-left: auto; }
      .mobile-menu-btn { display: flex; width: 44px; height: 44px; align-items: center; justify-content: center; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); cursor: pointer; font-size: 1.2rem; }
      .form-row, .form-row.three, .parts-tiers { grid-template-columns: 1fr; }
      .bidding-window-options { grid-template-columns: repeat(3, 1fr); }
      .vehicles-grid { grid-template-columns: 1fr; }
      .vehicle-card-photo { height: 180px; }
      .shop-layout { grid-template-columns: 1fr !important; }
      .shop-cart-sidebar { position: relative !important; top: 0 !important; order: -1; margin-bottom: 24px; }
      #mobile-cart-btn { display: block !important; }
      .shop-products-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important; }
      .vehicle-card-body { padding: 16px 20px 20px; }
      .vehicle-card-actions { flex-wrap: wrap; }
      .nav-item { padding: 13px 16px; font-size: 0.95rem; border-radius: 12px; margin-bottom: 3px; }
      .nav-label { padding: 20px 16px 10px; font-size: 0.68rem; }
      .sidebar-brand-icon { height: 64px; }
      .sidebar-footer { padding: 16px; margin-top: auto; background: rgba(18, 18, 28, 0.5); border-radius: var(--radius-md); margin: auto 4px 8px; }
      .btn { min-height: 48px; }
      body.sidebar-open { overflow: hidden; }
    }
    @media (min-width: 901px) { .mobile-header { display: none; } }

    /* Shop Section Styles */
    .shop-filter-btn { background: var(--bg-elevated); color: var(--text-secondary); border: 1px solid var(--border-subtle); transition: all 0.2s ease; }
    .shop-filter-btn:hover { border-color: var(--accent-gold); color: var(--text-primary); }
    .shop-filter-btn.active { background: linear-gradient(135deg, var(--accent-gold), #c49a45); color: var(--bg-deep); border-color: var(--accent-gold); }
    .product-card:hover { border-color: var(--accent-gold); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
    
    /* Product Image Lazy Loading */
    .product-image-container { background: linear-gradient(135deg, rgba(74,124,255,0.1), rgba(212,168,85,0.1)); }
    .product-skeleton { animation: skeletonPulse 1.5s ease-in-out infinite; }
    .skeleton-shimmer { position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); animation: shimmer 2s infinite; }
    @keyframes skeletonPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    .product-image-lazy { position: absolute; inset: 0; }

    /* Emergency Button */
    @keyframes emergencyPulse { 0%, 100% { box-shadow: 0 4px 20px rgba(239, 95, 95, 0.4); } 50% { box-shadow: 0 4px 30px rgba(239, 95, 95, 0.7), 0 0 0 10px rgba(239, 95, 95, 0.1); } }

    /* Emergency Banner */
    .emergency-banner { background: linear-gradient(135deg, rgba(239, 95, 95, 0.2), rgba(255, 68, 68, 0.15)); border: 1px solid rgba(239, 95, 95, 0.4); color: var(--accent-red); padding: 16px 20px; border-radius: var(--radius-lg); margin-bottom: 24px; cursor: pointer; display: flex; align-items: center; gap: 12px; animation: emergencyPulse 2s infinite; }
    .emergency-banner:hover { background: linear-gradient(135deg, rgba(239, 95, 95, 0.25), rgba(255, 68, 68, 0.2)); }

    /* Emergency Status Timeline */
    .emergency-timeline { display: flex; flex-direction: column; gap: 0; margin: 20px 0; }
    .emergency-step { display: flex; align-items: flex-start; gap: 12px; position: relative; padding-bottom: 20px; }
    .emergency-step:last-child { padding-bottom: 0; }
    .emergency-step::before { content: ''; position: absolute; left: 15px; top: 32px; bottom: 0; width: 2px; background: var(--border-subtle); }
    .emergency-step:last-child::before { display: none; }
    .emergency-step-dot { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; border: 2px solid var(--border-subtle); background: var(--bg-input); }
    .emergency-step.completed .emergency-step-dot { background: var(--accent-green); border-color: var(--accent-green); color: #fff; }
    .emergency-step.current .emergency-step-dot { background: var(--accent-orange); border-color: var(--accent-orange); color: var(--bg-deep); animation: pulse 2s infinite; }
    .emergency-step.pending .emergency-step-dot { opacity: 0.5; }
    .emergency-step-info { flex: 1; padding-top: 4px; }
    .emergency-step-label { font-weight: 500; font-size: 0.9rem; margin-bottom: 2px; }
    .emergency-step.pending .emergency-step-label { color: var(--text-muted); }
    .emergency-step-time { font-size: 0.78rem; color: var(--text-muted); }

    /* Emergency Photo Grid */
    .emergency-photos { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .emergency-photo { width: 60px; height: 60px; border-radius: var(--radius-sm); overflow: hidden; position: relative; border: 1px solid var(--border-subtle); }
    .emergency-photo img { width: 100%; height: 100%; object-fit: cover; }
    .emergency-photo-remove { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; }

    /* Emergency Type Selection */
    .emergency-type-option:hover { border-color: var(--accent-red); background: rgba(239,95,95,0.1); }
    .emergency-type-option:has(input:checked) { border-color: var(--accent-red); background: rgba(239,95,95,0.15); box-shadow: 0 0 0 2px rgba(239,95,95,0.3); }
    .emergency-type-option:has(input:checked) span:first-of-type { transform: scale(1.1); }

    /* Inspection Report Display Styles */
    .inspection-report-card { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; margin-top: 16px; }
    .inspection-report-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .inspection-report-title { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .inspection-overall-badge { padding: 6px 16px; border-radius: 100px; font-weight: 600; font-size: 0.85rem; }
    .inspection-overall-badge.excellent { background: var(--accent-green); color: #fff; }
    .inspection-overall-badge.good { background: #22c55e; color: #fff; }
    .inspection-overall-badge.fair { background: #f59e0b; color: var(--bg-deep); }
    .inspection-overall-badge.needs_attention { background: #f97316; color: #fff; }
    .inspection-counts { display: flex; gap: 12px; margin-bottom: 16px; }
    .inspection-count-item { display: flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: var(--radius-md); font-size: 0.85rem; font-weight: 500; }
    .inspection-count-item.urgent { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .inspection-count-item.attention { background: rgba(249, 115, 22, 0.15); color: #f97316; }
    .inspection-count-item.good { background: var(--accent-green-soft); color: var(--accent-green); }
    .inspection-category-section { background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); margin-bottom: 12px; overflow: hidden; }
    .inspection-category-toggle { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 500; }
    .inspection-category-toggle:hover { background: var(--bg-elevated); }
    .inspection-category-items { padding: 12px 16px; border-top: 1px solid var(--border-subtle); display: none; }
    .inspection-category-section.expanded .inspection-category-items { display: block; }
    .inspection-item-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border-subtle); font-size: 0.88rem; }
    .inspection-item-row:last-child { border-bottom: none; }
    .inspection-status-badge { padding: 4px 10px; border-radius: 100px; font-size: 0.75rem; font-weight: 500; }
    .inspection-status-badge.good { background: var(--accent-green-soft); color: var(--accent-green); }
    .inspection-status-badge.fair { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
    .inspection-status-badge.needs_attention { background: rgba(249, 115, 22, 0.15); color: #f97316; }
    .inspection-status-badge.urgent { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .inspection-status-badge.na { background: var(--bg-elevated); color: var(--text-muted); }
    .inspection-recommendations { background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; margin-top: 16px; }
    .inspection-recommendations-title { font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .inspection-recommendations-text { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5; }
    .inspection-date { font-size: 0.8rem; color: var(--text-muted); }

    /* Fleet Management Styles */
    .fleet-table { width: 100%; border-collapse: collapse; }
    .fleet-table th, .fleet-table td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border-subtle); }
    .fleet-table th { font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; background: var(--bg-input); }
    .fleet-table tr:hover td { background: var(--bg-elevated); }
    .fleet-table tbody tr:last-child td { border-bottom: none; }
    .fleet-role-badge { padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
    .fleet-role-badge.owner { background: linear-gradient(135deg, var(--accent-gold), #c49a45); color: var(--bg-deep); }
    .fleet-role-badge.manager { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .fleet-role-badge.driver { background: var(--accent-green-soft); color: var(--accent-green); }
    .fleet-role-badge.viewer { background: var(--bg-elevated); color: var(--text-muted); }
    .fleet-status-badge { padding: 4px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 500; }
    .fleet-status-badge.active { background: var(--accent-green-soft); color: var(--accent-green); }
    .fleet-status-badge.pending { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .fleet-status-badge.inactive { background: var(--bg-elevated); color: var(--text-muted); }
    .fleet-assignment-badge { padding: 4px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 500; }
    .fleet-assignment-badge.permanent { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .fleet-assignment-badge.temporary { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .fleet-assignment-badge.pool { background: rgba(168, 85, 247, 0.15); color: #a855f7; }
    .fleet-vehicle-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden; transition: all 0.2s ease; }
    .fleet-vehicle-card:hover { border-color: var(--accent-gold); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
    .fleet-vehicle-photo { height: 140px; background: linear-gradient(135deg, var(--bg-elevated), var(--bg-input)); display: flex; align-items: center; justify-content: center; font-size: 48px; position: relative; overflow: hidden; }
    .fleet-vehicle-photo img { width: 100%; height: 100%; object-fit: cover; }
    .fleet-vehicle-body { padding: 16px; }
    .fleet-vehicle-title { font-weight: 600; font-size: 1rem; margin-bottom: 4px; }
    .fleet-vehicle-driver { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; }
    .fleet-vehicle-meta { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
    .batch-status-badge { padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; }
    .batch-status-badge.draft { background: var(--bg-elevated); color: var(--text-muted); }
    .batch-status-badge.pending_approval { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .batch-status-badge.approved { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .batch-status-badge.in_progress { background: rgba(168, 85, 247, 0.15); color: #a855f7; }
    .batch-status-badge.completed { background: var(--accent-green-soft); color: var(--accent-green); }
    .batch-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px; }
    .batch-card:hover { border-color: var(--border-medium); }
    .batch-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
    .batch-title { font-weight: 600; font-size: 1.05rem; margin-bottom: 4px; }
    .batch-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px; }
    .batch-meta span { display: flex; align-items: center; gap: 6px; }
    .batch-actions { display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--border-subtle); }
    .wizard-steps { display: flex; gap: 4px; margin-bottom: 32px; }
    .wizard-step { flex: 1; padding: 12px 8px; text-align: center; background: var(--bg-input); border-radius: var(--radius-sm); font-size: 0.85rem; color: var(--text-muted); position: relative; transition: all 0.2s; }
    .wizard-step.active { background: var(--accent-gold); color: var(--bg-deep); font-weight: 600; }
    .wizard-step.completed { background: var(--accent-green-soft); color: var(--accent-green); }
    .wizard-step-num { font-weight: 700; margin-right: 6px; }
    .fleet-business-badge { padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 600; background: linear-gradient(135deg, rgba(212,168,85,0.2), rgba(212,168,85,0.1)); color: var(--accent-gold); }
    .approval-indicator { display: inline-flex; align-items: center; gap: 4px; font-size: 0.75rem; color: var(--accent-orange); }
    .approval-indicator.no-approval { color: var(--accent-green); }
    
    /* Document Expiration Badges */
    .expiration-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 500; margin-left: 8px; }
    .expiration-badge.valid { background: var(--accent-green-soft); color: var(--accent-green); }
    .expiration-badge.expiring-soon { background: var(--accent-orange); color: var(--bg-deep); animation: pulse 2s infinite; }
    .expiration-badge.expired { background: var(--accent-red); color: #fff; }
    .expiration-warning { display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: rgba(239, 95, 95, 0.1); border: 1px solid rgba(239, 95, 95, 0.3); border-radius: var(--radius-md); margin-bottom: 16px; font-size: 0.9rem; color: var(--accent-red); }
    .expiration-warning.warning { background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3); color: var(--accent-orange); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

    /* Toggle Switch Styles */
    .toggle-switch { position: relative; display: inline-flex; align-items: center; cursor: pointer; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }
    .toggle-slider { position: relative; width: 44px; height: 24px; background: var(--bg-elevated); border: 1px solid var(--border-medium); border-radius: 100px; transition: all 0.3s ease; flex-shrink: 0; }
    .toggle-slider::before { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: var(--text-muted); border-radius: 50%; transition: all 0.3s ease; }
    .toggle-switch input:checked + .toggle-slider { background: linear-gradient(135deg, var(--accent-gold), #c49a45); border-color: var(--accent-gold); }
    .toggle-switch input:checked + .toggle-slider::before { transform: translateX(20px); background: var(--bg-deep); }
    .toggle-switch input:focus + .toggle-slider { box-shadow: 0 0 0 3px rgba(212, 168, 85, 0.2); }
    .notif-pref-group { transition: border-color 0.2s ease; }
    .notif-pref-group:hover { border-color: var(--border-medium); }

    /* Learn Hub Styles */
    .learn-categories-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px; }
    .learn-category-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
    .learn-category-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent-gold), var(--accent-blue)); opacity: 0; transition: opacity 0.3s ease; }
    .learn-category-card:hover { border-color: var(--accent-gold); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
    .learn-category-card:hover::before { opacity: 1; }
    .learn-category-card.active { border-color: var(--accent-blue); background: rgba(74, 124, 255, 0.08); }
    .learn-category-icon { font-size: 40px; margin-bottom: 16px; display: block; }
    .learn-category-title { font-size: 1.15rem; font-weight: 600; margin-bottom: 6px; }
    .learn-category-desc { font-size: 0.88rem; color: var(--text-secondary); line-height: 1.5; }
    .learn-category-count { display: inline-block; margin-top: 12px; padding: 4px 10px; background: var(--accent-blue-soft); color: var(--accent-blue); border-radius: 100px; font-size: 0.75rem; font-weight: 500; }
    .learn-articles-container { margin-top: 24px; }
    .learn-articles-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .learn-articles-title { font-size: 1.2rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
    .learn-article-item { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); margin-bottom: 12px; overflow: hidden; transition: all 0.2s ease; }
    .learn-article-item:hover { border-color: var(--border-medium); }
    .learn-article-header { display: flex; align-items: center; gap: 14px; padding: 16px 20px; cursor: pointer; }
    .learn-article-header:hover { background: rgba(74, 124, 255, 0.05); }
    .learn-article-icon { font-size: 24px; flex-shrink: 0; }
    .learn-article-title { flex: 1; font-weight: 500; font-size: 0.95rem; }
    .learn-article-expand { color: var(--text-muted); font-size: 1.2rem; transition: transform 0.3s ease; }
    .learn-article-item.expanded .learn-article-expand { transform: rotate(180deg); }
    .learn-article-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; }
    .learn-article-item.expanded .learn-article-content { max-height: 500px; padding: 0 20px 20px; }
    .learn-article-text { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.7; background: var(--bg-input); padding: 16px; border-radius: var(--radius-md); border-left: 3px solid var(--accent-gold); }
    .learn-severity-badge { display: inline-block; padding: 3px 10px; border-radius: 100px; font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-left: auto; margin-right: 12px; }
    .learn-severity-badge.low { background: var(--accent-green-soft); color: var(--accent-green); }
    .learn-severity-badge.medium { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .learn-severity-badge.high { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .learn-glossary-section { margin-top: 40px; }
    .learn-glossary-header { display: flex; justify-content: space-between; align-items: center; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; }
    .learn-glossary-search { display: flex; align-items: center; gap: 8px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 10px 16px; min-width: 280px; }
    .learn-glossary-search input { background: transparent; border: none; color: var(--text-primary); font-size: 0.9rem; width: 100%; outline: none; }
    .learn-glossary-search input::placeholder { color: var(--text-muted); }
    .learn-glossary-alphabet { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 20px; }
    .learn-glossary-letter { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); font-size: 0.85rem; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.15s ease; }
    .learn-glossary-letter:hover { border-color: var(--accent-gold); color: var(--accent-gold); }
    .learn-glossary-letter.active { background: var(--accent-gold); color: var(--bg-deep); border-color: var(--accent-gold); }
    .learn-glossary-letter.disabled { opacity: 0.3; cursor: default; pointer-events: none; }
    .learn-glossary-list { display: grid; gap: 12px; }
    .learn-glossary-item { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px 20px; transition: all 0.2s ease; }
    .learn-glossary-item:hover { border-color: var(--border-medium); }
    .learn-glossary-term { font-weight: 600; font-size: 1rem; color: var(--accent-gold); margin-bottom: 6px; }
    .learn-glossary-definition { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; }
    .learn-back-btn { display: inline-flex; align-items: center; gap: 6px; color: var(--text-muted); font-size: 0.88rem; cursor: pointer; margin-bottom: 16px; padding: 8px 0; transition: color 0.15s; }
    .learn-back-btn:hover { color: var(--accent-blue); }

    /* Educational Info Expandable Sections */
    .edu-toggle-btn { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--accent-gold-soft); border: 1px solid rgba(212, 168, 85, 0.3); border-radius: 100px; font-size: 0.75rem; color: var(--accent-gold); cursor: pointer; transition: all 0.2s ease; font-weight: 500; }
    .edu-toggle-btn:hover { background: rgba(212, 168, 85, 0.25); border-color: var(--accent-gold); }
    .edu-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease; opacity: 0; }
    .edu-content.expanded { max-height: 500px; padding-top: 12px; opacity: 1; }
    .edu-card { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; border-left: 3px solid var(--accent-gold); }
    .edu-section { margin-bottom: 12px; }
    .edu-section:last-child { margin-bottom: 0; }
    .edu-section-title { font-size: 0.8rem; font-weight: 600; color: var(--accent-gold); margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
    .edu-section-text { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }
    .edu-difficulty { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 100px; font-size: 0.75rem; font-weight: 500; }
    .edu-difficulty.easy { background: var(--accent-green-soft); color: var(--accent-green); }
    .edu-difficulty.moderate { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .edu-difficulty.professional { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }

    /* Registration Verification Styles */
    .registration-verified-badge { 
      position: absolute; 
      top: 12px; 
      left: 12px; 
      background: linear-gradient(135deg, var(--accent-green), #3da577); 
      color: white; 
      padding: 5px 12px; 
      border-radius: 100px; 
      font-size: 0.72rem; 
      font-weight: 600; 
      display: flex; 
      align-items: center; 
      gap: 5px; 
      z-index: 5; 
      box-shadow: 0 2px 8px rgba(74, 200, 140, 0.3); 
    }
    .registration-status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .registration-status-badge.pending { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .registration-status-badge.approved { background: var(--accent-green-soft); color: var(--accent-green); }
    .registration-status-badge.rejected { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .registration-status-badge.needs_review { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .registration-upload-area {
      border: 2px dashed var(--border-medium);
      border-radius: var(--radius-lg);
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--bg-input);
    }
    .registration-upload-area:hover {
      border-color: var(--accent-gold);
      background: var(--accent-gold-soft);
    }
    .registration-upload-area.has-file {
      border-style: solid;
      border-color: var(--accent-green);
      background: var(--accent-green-soft);
    }
    .registration-preview-img {
      max-width: 100%;
      max-height: 200px;
      border-radius: var(--radius-md);
      margin-top: 12px;
      display: none;
    }
    .verify-btn-container {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-subtle);
    }
  </style>
  <script src="/i18n.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:40;"></div>
  <aside class="sidebar" id="sidebar">
    <div class="mobile-close" id="mobile-close-btn" onclick="toggleSidebar()" style="display:none;position:absolute;top:16px;right:16px;width:36px;height:36px;background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:50%;cursor:pointer;font-size:1.2rem;align-items:center;justify-content:center;">âœ•</div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:0 8px 16px;">
      <a href="index.html" class="sidebar-brand" style="padding:8px 4px 8px;margin-bottom:0;border-bottom:none;">
        <img src="logo.png" alt="My Car Concierge" class="sidebar-brand-icon">
      </a>
      <button class="theme-toggle" id="theme-toggle-btn" onclick="toggleTheme()" title="Toggle theme">
        <span id="theme-icon">ðŸŒ™</span>
      </button>
    </div>
    <div id="language-switcher" style="padding:0 12px 16px;"></div>

    <div class="nav-label" data-i18n="member.navDashboard">Dashboard</div>
    <div class="nav-item active" data-section="overview"><span data-i18n="member.overview">ðŸ“Š Overview</span></div>
    
    <div class="nav-label" data-i18n="member.navDigitalGarage">Digital Garage</div>
    <div class="nav-item" data-section="vehicles"><span data-i18n="member.myVehicles">ðŸš— My Vehicles</span></div>
    <div class="nav-item" data-section="my-next-car"><span>ðŸš˜ My Next Car</span> <span class="nav-badge" id="prospect-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="dream-car-finder"><span>âœ¨ Dream Car Finder</span> <span class="nav-badge" id="dream-car-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="maintenance-schedule"><span>ðŸ”§ Maintenance Schedule</span> <span class="nav-badge" id="maintenance-due-count" style="display:none;background:var(--accent-orange);">0</span></div>
    <div class="nav-item" data-section="learn"><span>ðŸŽ“ My Car Concierge Academy</span></div>
    <div class="nav-item" data-section="household"><span>ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Household</span> <span class="nav-badge" id="household-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="fleet"><span>ðŸ¢ Fleet</span> <span class="nav-badge" id="fleet-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="reminders"><span data-i18n="member.reminders">ðŸ”” Reminders</span> <span class="nav-badge" id="reminder-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="referrals"><span>ðŸŽ Refer a Friend</span> <span class="nav-badge" id="referral-credits-badge" style="display:none;background:var(--accent-green);">$0</span></div>
    
    <div class="nav-label" data-i18n="member.navServices">Services</div>
    <div class="nav-item" data-section="packages"><span data-i18n="member.maintenancePackages">ðŸ“¦ Maintenance Packages</span></div>
    <div class="nav-item" data-section="shop"><span>ðŸ›ï¸ Shop</span></div>
    <div class="nav-item" data-section="order-history"><span>ðŸ“¦ Order History</span></div>
    <div class="nav-item" data-section="cost-estimator"><span>ðŸ’° Cost Estimator</span></div>
    <div class="nav-item" onclick="window.open('/rideshare.html#calculator', '_blank')" style="cursor:pointer;"><span>ðŸš• Rideshare Calculator</span></div>
    <div class="nav-item" data-section="upsells"><span data-i18n="member.additionalWork">âš ï¸ Additional Work</span> <span class="nav-badge" id="upsell-count" style="display:none;background:var(--accent-orange);">0</span></div>
    <div class="nav-item" data-section="messages"><span data-i18n="nav.messages">ðŸ’¬ Messages</span> <span class="nav-badge" id="message-count" style="display:none;">0</span></div>
    <div class="nav-item" data-section="history"><span data-i18n="member.serviceHistory">ðŸ“œ Service History</span></div>
    <div class="nav-item" data-section="spending-analytics"><span>ðŸ“Š Spending Analytics</span></div>
    <div class="nav-item" data-section="fuel-tracker"><span>â›½ Fuel Tracker</span></div>
    <div class="nav-item" data-section="insurance"><span>ðŸ“‹ Insurance</span></div>
    <div class="nav-item" data-section="emergency"><span>ðŸ†˜ Emergency Roadside</span></div>
    <div class="nav-item" data-section="destination-services"><span>ðŸš— Destination Services</span> <span class="nav-badge" id="destination-count" style="display:none;background:var(--accent-blue);">0</span></div>

    <div class="nav-label" data-i18n="member.navSupport">Support</div>
    <div class="nav-item" onclick="openSupport()"><span data-i18n="member.helpSupport">ðŸŽ« Help & Support</span></div>
    <div class="nav-item" data-section="notifications"><span data-i18n="nav.notifications">ðŸ”” Notifications</span> <span class="nav-badge" id="notif-count" style="display:none;background:var(--accent-red);">0</span></div>
    <div class="nav-item" data-section="settings"><span data-i18n="nav.settings">âš™ï¸ Settings</span></div>
    <div class="nav-item" data-section="qr-checkin"><span>ðŸ“± My Check-In QR</span></div>

    <!-- Founder Access (only visible to approved founders) -->
    <div id="founder-nav" style="display:none;">
      <div class="nav-label">Founder</div>
      <div class="nav-item" onclick="window.location.href='founder-dashboard.html'"><span>ðŸ’° Founder Dashboard</span></div>
    </div>

    <!-- Admin Access (only visible to admins) -->
    <div id="admin-nav" style="display:none;">
      <div class="nav-label">Admin</div>
      <div class="nav-item" onclick="window.location.href='admin.html'"><span>ðŸ‘‘ Admin Portal</span></div>
    </div>

    <div class="sidebar-footer">
      <div id="realtime-status" style="padding:8px 12px;margin-bottom:8px;font-size:0.75rem;display:flex;align-items:center;gap:6px;color:var(--text-muted);">
        <span id="realtime-dot" style="width:8px;height:8px;border-radius:50%;background:var(--accent-orange);"></span>
        <span id="realtime-text">Connecting...</span>
      </div>
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">JD</div>
        <div style="flex:1;">
          <div class="user-name" id="user-name">Loading...</div>
          <div class="user-email" id="user-email">...</div>
          <div id="user-loyalty-badges" class="loyalty-badges" style="display:none;"></div>
        </div>
      </div>
      <div id="preferred-provider-display" class="preferred-provider-info" style="display:none;"></div>
      <div id="switch-portal-container" style="display:none;background:var(--bg-elevated);border:1px solid var(--accent-gold);border-radius:var(--radius-md);padding:12px;margin-bottom:12px;">
        <div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">Switch Portal</div>
        <button id="switch-portal-btn" class="btn" onclick="switchToProvider()" style="width:100%;padding:12px 16px;font-size:0.9rem;background:linear-gradient(135deg, var(--accent-gold), #e8bc5a);color:var(--bg-deep);font-weight:600;border:none;">
          ðŸ”§ Provider Portal
        </button>
        <div style="font-size:0.72rem;color:var(--text-muted);margin-top:6px;text-align:center;">You have dual access</div>
      </div>
      <button class="btn btn-secondary" onclick="logout()" style="width:100%;padding:14px 20px;font-size:0.95rem;">ðŸšª Log Out</button>
      <div class="sidebar-disclaimer" style="margin-top:12px;padding:10px 12px;background:rgba(148,148,168,0.06);border-radius:8px;border:1px solid rgba(148,148,168,0.08);">
        <p style="font-size:0.68rem;color:var(--text-muted);line-height:1.5;margin:0;">
          <strong style="color:var(--text-secondary);">Disclaimer:</strong> MCC is a marketplace only. We connect you with independent providers but do not perform or guarantee any services.
        </p>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <div class="mobile-header">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
      <span style="font-weight: 600;">My Car Concierge</span>
    </div>

    <!-- Desktop Header with Theme Toggle -->
    <div class="desktop-header">
      <button class="header-theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <span class="theme-icon-sun">â˜€ï¸ Day</span>
        <span class="theme-icon-moon">ðŸŒ™ Night</span>
      </button>
    </div>

    <!-- Active Emergency Banner -->
    <div id="emergency-alert-banner" class="emergency-banner" style="display:none;" onclick="openEmergencyStatus()">
      <span style="font-size:24px;">ðŸš¨</span>
      <div style="flex:1;">
        <strong>Active Emergency Request</strong>
        <div id="emergency-banner-status" style="font-size:0.9rem;opacity:0.9;">Waiting for a provider...</div>
      </div>
      <span style="text-decoration:underline;">View Status â†’</span>
    </div>

    <!-- Upsell Alert Banner (shows when pending upsells) -->
    <div id="upsell-alert-banner" style="display:none;background:var(--accent-orange-soft);border:1px solid rgba(245,158,11,0.3);color:var(--accent-orange);padding:16px 20px;border-radius:var(--radius-lg);margin-bottom:24px;cursor:pointer;" onclick="showSection('upsells')">
      <strong>âš ï¸ Action Required:</strong> A provider has found additional issues that need your approval. <span style="text-decoration:underline;">Review now â†’</span>
    </div>

    <!-- Overview Section -->
    <section id="overview" class="section active">
      <div class="page-header" style="margin-bottom: 32px;">
        <h1 class="page-title" data-i18n="member.welcomeBack" style="font-size: 2rem; font-weight: 700; letter-spacing: -0.5px;">Welcome back</h1>
        <p class="page-subtitle" data-i18n="member.garageSubtitle" style="font-size: 1rem; margin-top: 8px;">Here's what's happening with your garage.</p>
      </div>

      <!-- Quick Actions - Turo Style -->
      <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 32px;">
        <button class="btn btn-primary" onclick="openVehicleModal()" style="padding: 12px 24px; font-weight: 600; border-radius: 100px;">
          <span data-i18n="member.addVehicle">+ Add Vehicle</span>
        </button>
        <button class="btn btn-secondary" onclick="openPackageModal()" style="padding: 12px 24px; font-weight: 600; border-radius: 100px; border: 2px solid var(--accent-gold); background: transparent; color: var(--accent-gold);">
          <span data-i18n="member.newMaintenancePackage">+ New Service Request</span>
        </button>
      </div>
      
      <!-- Onboarding Checklist - Shows for new users -->
      <div id="onboarding-checklist" class="card onboarding-card" style="margin-bottom: 32px; display: none;">
        <div class="card-header">
          <h2 class="card-title">ðŸš€ Get Started</h2>
          <button class="btn btn-ghost" onclick="dismissOnboarding()" title="Dismiss">âœ•</button>
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">Complete these steps to get the most out of My Car Concierge</p>
        <div class="onboarding-steps">
          <div class="onboarding-step" id="step-add-vehicle" onclick="openVehicleModal()">
            <span class="step-check">1</span>
            <div class="step-content">
              <span class="step-name">Add your first vehicle</span>
              <span class="step-desc">Register a vehicle to start requesting services</span>
            </div>
            <span class="step-arrow">â†’</span>
          </div>
          <div class="onboarding-step" id="step-verify-vehicle" onclick="showSection('vehicles')">
            <span class="step-check">2</span>
            <div class="step-content">
              <span class="step-name">Verify ownership</span>
              <span class="step-desc">Upload registration for priority service</span>
            </div>
            <span class="step-arrow">â†’</span>
          </div>
          <div class="onboarding-step" id="step-create-request" onclick="openPackageModal()">
            <span class="step-check">3</span>
            <div class="step-content">
              <span class="step-name">Create a service request</span>
              <span class="step-desc">Post your needs and receive competitive bids</span>
            </div>
            <span class="step-arrow">â†’</span>
          </div>
        </div>
        <div class="onboarding-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="onboarding-progress-fill" style="width: 0%;"></div>
          </div>
          <span class="progress-text" id="onboarding-progress-text">0 of 3 complete</span>
        </div>
      </div>

      <div class="stats-grid" style="margin-bottom: 40px;">
        <div class="stat-card" onclick="showSection('vehicles')" style="cursor:pointer;">
          <div class="stat-icon blue">ðŸš—</div>
          <div class="stat-value" id="stat-vehicles">0</div>
          <div class="stat-label" data-i18n="member.vehicles">Vehicles</div>
        </div>
        <div class="stat-card" onclick="showSection('packages')" style="cursor:pointer;">
          <div class="stat-icon gold">ðŸ“¦</div>
          <div class="stat-value" id="stat-packages">0</div>
          <div class="stat-label" data-i18n="member.activePackages">Active Requests</div>
        </div>
        <div class="stat-card" onclick="showSection('packages')" style="cursor:pointer;">
          <div class="stat-icon green">ðŸ’¬</div>
          <div class="stat-value" id="stat-bids">0</div>
          <div class="stat-label" data-i18n="member.bidsReceived">Bids Received</div>
        </div>
        <div class="stat-card" onclick="showSection('reminders')" style="cursor:pointer;">
          <div class="stat-icon orange">ðŸ””</div>
          <div class="stat-value" id="stat-reminders">0</div>
          <div class="stat-label" data-i18n="member.dueSoon">Due Soon</div>
        </div>
        <div class="stat-card" onclick="showSection('history')" style="cursor:pointer;">
          <div class="stat-icon green">âœ“</div>
          <div class="stat-value" id="stat-completed">0</div>
          <div class="stat-label" data-i18n="member.completed">Completed</div>
        </div>
        <div class="stat-card" onclick="showSection('packages')" style="cursor:pointer;" title="Browse available service providers">
          <div class="stat-icon blue">ðŸ”§</div>
          <div class="stat-value" id="stat-providers">0</div>
          <div class="stat-label">Providers</div>
        </div>
      </div>

      <!-- Rideshare Calculator Promo Card -->
      <div class="card" style="background: linear-gradient(135deg, rgba(74,200,140,0.1), rgba(74,124,255,0.08)); border: 1px solid rgba(74,200,140,0.3); margin-bottom: 24px;">
        <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
          <div style="font-size: 48px;">ðŸš•</div>
          <div style="flex: 1; min-width: 200px;">
            <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">Rideshare Profit Calculator</h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 4px;">Are you really making money driving for Uber, Lyft, or DoorDash?</p>
            <p style="color: var(--text-muted); font-size: 0.85rem;">Calculate your true earnings after ALL hidden costs - depreciation, fuel, maintenance, and insurance.</p>
          </div>
          <button onclick="window.open('/rideshare/', '_blank')" class="btn" style="padding: 14px 28px; font-weight: 600; border-radius: 100px; background: linear-gradient(135deg, var(--accent-green), #3cb371); color: white; border: none; cursor: pointer; white-space: nowrap;">
            Calculate Now
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title" data-i18n="member.recentActivity">Recent Activity</h2>
          <button class="btn btn-ghost" onclick="showSection('packages')"><span data-i18n="common.viewAll">View All â†’</span></button>
        </div>
        <div id="recent-activity">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸ“¦</div>
            <p>No recent activity.</p>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title" data-i18n="member.upcomingReminders">Upcoming Reminders</h2>
          <button class="btn btn-ghost" onclick="showSection('reminders')"><span data-i18n="common.viewAll">View All â†’</span></button>
        </div>
        <div id="upcoming-reminders">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸ””</div>
            <p data-i18n="member.noUpcomingReminders">No upcoming reminders.</p>
          </div>
        </div>
      </div>

      <div class="card" id="recommendations-card">
        <div class="card-header">
          <h2 class="card-title">ðŸ”§ Recommended Services</h2>
          <button class="btn btn-ghost btn-sm" onclick="refreshAllRecommendations()">â†» Refresh</button>
        </div>
        <div id="recommendations-list">
          <div class="empty-state" style="padding:24px;">
            <div class="empty-state-icon">âœ…</div>
            <p>No service recommendations at this time.</p>
            <p style="font-size:0.85rem;margin-top:8px;">Recommendations will appear based on your vehicle data and service history.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Vehicles Section (Digital Garage) -->
    <section id="vehicles" class="section">
      <div class="page-header" style="margin-bottom: 32px;">
        <h1 class="page-title" data-i18n="member.vehiclesTitle" style="font-size: 2rem; font-weight: 700; letter-spacing: -0.5px;">My Vehicles</h1>
        <p class="page-subtitle" data-i18n="member.vehiclesSubtitle" style="font-size: 1rem; margin-top: 8px;">Your digital garage - all your vehicles in one place.</p>
      </div>

      <div style="margin-bottom: 28px; display: flex; gap: 12px; flex-wrap: wrap;">
        <button class="btn btn-primary" onclick="openVehicleModal()" style="padding: 12px 24px; font-weight: 600; border-radius: 100px; border: 2px solid var(--accent-gold); background: transparent; color: var(--accent-gold);">
          <span data-i18n="member.addVehicle">+ Add Vehicle</span>
        </button>
        <button class="btn btn-secondary" onclick="openVehicleAssistantModal()" style="padding: 12px 24px; font-weight: 600; border-radius: 100px; background: linear-gradient(135deg, var(--accent-blue), #5a9cff); color: white; border: none;">
          ðŸ¤– Vehicle Assistant
        </button>
      </div>

      <div class="vehicles-grid" id="vehicles-grid">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸš—</div>
          <p>No vehicles in your garage yet.</p>
        </div>
      </div>
    </section>

    <!-- My Next Car Section -->
    <section id="my-next-car" class="section">
      <div class="page-header" style="margin-bottom: 32px;">
        <h1 class="page-title" style="font-size: 2rem; font-weight: 700; letter-spacing: -0.5px;">ðŸš˜ My Next Car</h1>
        <p class="page-subtitle" style="font-size: 1rem; margin-top: 8px;">Compare vehicles you're considering and find your perfect match.</p>
      </div>

      <div class="tabs" style="margin-bottom: 24px;">
        <div class="tab active" data-prospect-tab="prospects" onclick="showProspectTab('prospects')">ðŸš— Prospects</div>
        <div class="tab" data-prospect-tab="compare" onclick="showProspectTab('compare')">âš–ï¸ Compare</div>
        <div class="tab" data-prospect-tab="preferences" onclick="showProspectTab('preferences')">âš™ï¸ My Preferences</div>
        <div class="tab" data-prospect-tab="ai-search" onclick="showProspectTab('ai-search')">ðŸ¤– AI Search</div>
      </div>

      <!-- Prospects Tab -->
      <div id="prospects-tab" class="prospect-tab-content">
        <div style="margin-bottom: 24px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: space-between; align-items: center;">
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="openAddProspectModal()" style="padding: 12px 24px; font-weight: 600; border-radius: 100px;">
              + Add Prospect Vehicle
            </button>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <select id="prospect-filter" onchange="filterProspects()" style="padding: 8px 16px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 0.88rem;">
              <option value="all">All Prospects</option>
              <option value="considering">Considering</option>
              <option value="test_driven">Test Driven</option>
              <option value="offer_made">Offer Made</option>
              <option value="purchased">Purchased</option>
              <option value="passed">Passed</option>
            </select>
          </div>
        </div>

        <div class="vehicles-grid" id="prospects-grid">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸš˜</div>
            <p>No prospect vehicles yet.</p>
            <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px;">Add vehicles you're considering to compare them.</p>
          </div>
        </div>
      </div>

      <!-- Compare Tab -->
      <div id="compare-tab" class="prospect-tab-content" style="display: none;">
        <div style="margin-bottom: 24px; padding: 20px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);">
          <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">Select vehicles to compare (2-4):</h3>
          <div id="compare-selection" style="display: flex; flex-wrap: wrap; gap: 12px;">
            <p style="color: var(--text-muted); font-size: 0.9rem;">Add prospect vehicles first to compare them.</p>
          </div>
          <button class="btn btn-primary" onclick="generateComparison()" style="margin-top: 16px;" id="compare-btn" disabled>
            Compare Selected
          </button>
        </div>

        <div id="comparison-results" style="display: none;">
          <div class="card">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 20px;">ðŸ“Š Side-by-Side Comparison</h3>
            <div style="overflow-x: auto;">
              <table id="comparison-table" style="width: 100%; border-collapse: collapse; min-width: 600px;">
                <thead id="comparison-thead"></thead>
                <tbody id="comparison-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Preferences Tab -->
      <div id="preferences-tab" class="prospect-tab-content" style="display: none;">
        <div class="card">
          <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 8px;">ðŸŽ¯ My Ideal Car Preferences</h3>
          <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 24px;">Set your preferences and we'll calculate a match score for each prospect vehicle.</p>

          <form id="preferences-form" onsubmit="saveCarPreferences(event)">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Budget Range</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input type="number" id="pref-min-budget" placeholder="Min $" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <span style="color: var(--text-muted);">to</span>
                  <input type="number" id="pref-max-budget" placeholder="Max $" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                </div>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Year Range</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input type="number" id="pref-min-year" placeholder="Min Year" min="1990" max="2030" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <span style="color: var(--text-muted);">to</span>
                  <input type="number" id="pref-max-year" placeholder="Max Year" min="1990" max="2030" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                </div>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Maximum Mileage</label>
                <input type="number" id="pref-max-mileage" placeholder="e.g. 50000" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Fuel Preference</label>
                <select id="pref-fuel" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">No Preference</option>
                  <option value="Gasoline">Gasoline</option>
                  <option value="Diesel">Diesel</option>
                  <option value="Hybrid">Hybrid</option>
                  <option value="Electric">Electric</option>
                  <option value="Plug-in Hybrid">Plug-in Hybrid</option>
                </select>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Transmission Preference</label>
                <select id="pref-transmission" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">No Preference</option>
                  <option value="Automatic">Automatic</option>
                  <option value="Manual">Manual</option>
                  <option value="CVT">CVT</option>
                </select>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Drivetrain Preference</label>
                <select id="pref-drivetrain" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">No Preference</option>
                  <option value="FWD">Front-Wheel Drive (FWD)</option>
                  <option value="RWD">Rear-Wheel Drive (RWD)</option>
                  <option value="AWD">All-Wheel Drive (AWD)</option>
                  <option value="4WD">Four-Wheel Drive (4WD)</option>
                </select>
              </div>
            </div>

            <div class="form-group" style="margin-top: 20px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Preferred Makes (comma separated)</label>
              <input type="text" id="pref-makes" placeholder="e.g. Toyota, Honda, BMW" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 20px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Must-Have Features (comma separated)</label>
              <input type="text" id="pref-must-have" placeholder="e.g. Leather seats, Sunroof, Navigation" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 20px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Deal Breakers (comma separated)</label>
              <input type="text" id="pref-deal-breakers" placeholder="e.g. Salvage title, More than 2 accidents" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 20px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;">Notes</label>
              <textarea id="pref-notes" rows="3" placeholder="Any other preferences or notes..." style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); resize: vertical;"></textarea>
            </div>

            <div style="margin-top: 24px; display: flex; gap: 12px;">
              <button type="submit" class="btn btn-primary">Save Preferences</button>
              <button type="button" class="btn btn-secondary" onclick="clearCarPreferences()">Clear All</button>
            </div>
          </form>
        </div>
      </div>

      <!-- AI Search Tab -->
      <div id="ai-search-tab" class="prospect-tab-content" style="display: none;">
        <!-- Section A: Active Searches -->
        <div class="card" style="margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 4px;" data-i18n="member.aiSearch.activeSearches">ðŸ” Active Searches</h3>
              <p style="color: var(--text-secondary); font-size: 0.85rem;" data-i18n="member.aiSearch.activeSearchesDesc">AI-powered searches running in the background to find your dream car.</p>
            </div>
            <button class="btn btn-primary" onclick="openAISearchModal()" style="padding: 10px 20px; font-weight: 600; border-radius: 100px;">
              <span data-i18n="member.aiSearch.createNew">+ Create New Search</span>
            </button>
          </div>
          
          <div id="ai-searches-list">
            <div class="empty-state" style="padding: 40px 20px;">
              <div class="empty-state-icon">ðŸ¤–</div>
              <p data-i18n="member.aiSearch.noSearches">No AI searches yet.</p>
              <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px;" data-i18n="member.aiSearch.noSearchesDesc">Create a search and we'll automatically find matching cars for you.</p>
            </div>
          </div>
        </div>

        <!-- Section B: Recent Matches -->
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 4px;" data-i18n="member.aiSearch.recentMatches">ðŸŽ¯ Recent Matches</h3>
              <p style="color: var(--text-secondary); font-size: 0.85rem;" data-i18n="member.aiSearch.recentMatchesDesc">Cars found by your AI searches that match your criteria.</p>
            </div>
            <select id="ai-matches-filter" onchange="filterAIMatches()" style="padding: 8px 16px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 0.88rem;">
              <option value="all" data-i18n="member.aiSearch.filterAll">All Matches</option>
              <option value="unseen" data-i18n="member.aiSearch.filterUnseen">Unseen</option>
              <option value="saved" data-i18n="member.aiSearch.filterSaved">Saved</option>
            </select>
          </div>
          
          <div class="vehicles-grid" id="ai-matches-grid" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));">
            <div class="empty-state" style="padding: 40px 20px; grid-column: 1 / -1;">
              <div class="empty-state-icon">ðŸš—</div>
              <p data-i18n="member.aiSearch.noMatches">No matches found yet.</p>
              <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px;" data-i18n="member.aiSearch.noMatchesDesc">Create an AI search and matches will appear here.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- AI Search Modal -->
    <div class="modal-backdrop" id="ai-search-modal">
      <div class="modal wide">
        <div class="modal-header">
          <h2 class="modal-title" id="ai-search-modal-title" data-i18n="member.aiSearch.createSearch">Create AI Search</h2>
          <button class="modal-close" onclick="closeAISearchModal()">Ã—</button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
          <form id="ai-search-form" onsubmit="saveAISearch(event)">
            <input type="hidden" id="ai-search-id">
            
            <div class="form-group">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.searchName">Search Name *</label>
              <input type="text" id="ai-search-name" required placeholder="e.g. Family SUV under 40k" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);" data-i18n="member.aiSearch.vehicleCriteria">Vehicle Criteria</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.yearRange">Year Range</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <input type="number" id="ai-search-min-year" placeholder="Min" min="1990" max="2030" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <span style="color: var(--text-muted);">to</span>
                  <input type="number" id="ai-search-max-year" placeholder="Max" min="1990" max="2030" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                </div>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.priceRange">Price Range ($)</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <input type="number" id="ai-search-min-price" placeholder="Min" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <span style="color: var(--text-muted);">to</span>
                  <input type="number" id="ai-search-max-price" placeholder="Max" style="flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                </div>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.maxMileage">Max Mileage</label>
                <input type="number" id="ai-search-max-mileage" placeholder="e.g. 50000" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.preferredMakes">Preferred Makes (comma separated)</label>
              <input type="text" id="ai-search-makes" placeholder="e.g. Toyota, Honda, BMW, Mercedes" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.preferredModels">Preferred Models (comma separated)</label>
              <input type="text" id="ai-search-models" placeholder="e.g. Camry, Accord, 3 Series" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.preferredTrims">Preferred Trims/Versions (comma separated)</label>
              <input type="text" id="ai-search-trims" placeholder="e.g. Sport, GTI, Type R, Turbo, Mk 7.5, CLA 45" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 12px; display: block;" data-i18n="member.aiSearch.bodyStyles">Body Styles</label>
              
              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">Sedans & Coupes</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Sedan"> Sedan</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Coupe"> Coupe</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Sports Car"> Sports Car</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Muscle Car"> Muscle Car</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Supercar"> Supercar</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Luxury Sedan"> Luxury Sedan</label>
                </div>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">Hatchbacks & Wagons</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Hatchback"> Hatchback</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Hot Hatch"> Hot Hatch</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Wagon"> Wagon</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Liftback"> Liftback</label>
                </div>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">SUVs & Crossovers</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="SUV"> SUV</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Crossover"> Crossover</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Compact SUV"> Compact SUV</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Midsize SUV"> Midsize SUV</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Full-Size SUV"> Full-Size SUV</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="SUV Coupe"> SUV Coupe</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Off-Road SUV"> Off-Road SUV</label>
                </div>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">Trucks</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Pickup Truck"> Pickup Truck</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Compact Truck"> Compact Truck</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Midsize Truck"> Midsize Truck</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Full-Size Truck"> Full-Size Truck</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Heavy Duty Truck"> Heavy Duty Truck</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Crew Cab"> Crew Cab</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Extended Cab"> Extended Cab</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Regular Cab"> Regular Cab</label>
                </div>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">Vans & Family</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Minivan"> Minivan</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Passenger Van"> Passenger Van</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Cargo Van"> Cargo Van</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Camper Van"> Camper Van</label>
                </div>
              </div>

              <div style="margin-bottom: 12px;">
                <span style="font-size: 0.75rem; font-weight: 600; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 0.5px;">Convertibles & Open-Top</span>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Convertible"> Convertible</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Roadster"> Roadster</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Targa"> Targa</label>
                  <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);"><input type="checkbox" name="ai-body-style" value="Cabriolet"> Cabriolet</label>
                </div>
              </div>
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 12px; display: block;" data-i18n="member.aiSearch.fuelTypes">Fuel Types</label>
              <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);">
                  <input type="checkbox" name="ai-fuel-type" value="Gasoline"> Gasoline
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);">
                  <input type="checkbox" name="ai-fuel-type" value="Diesel"> Diesel
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);">
                  <input type="checkbox" name="ai-fuel-type" value="Hybrid"> Hybrid
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);">
                  <input type="checkbox" name="ai-fuel-type" value="Electric"> Electric
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: var(--bg-input); border-radius: var(--radius-sm); border: 1px solid var(--border-subtle);">
                  <input type="checkbox" name="ai-fuel-type" value="Plug-in Hybrid"> Plug-in Hybrid
                </label>
              </div>
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);" data-i18n="member.aiSearch.location">Location</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.zipCode">Zip Code</label>
                <input type="text" id="ai-search-zip" placeholder="e.g. 90210" maxlength="10" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.searchRadius">Search Radius (miles)</label>
                <input type="number" id="ai-search-radius" placeholder="e.g. 50" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.exteriorColors">Exterior Colors (optional, comma separated)</label>
              <input type="text" id="ai-search-colors" placeholder="e.g. Black, White, Silver" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <div class="form-group" style="margin-top: 16px;">
              <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.mustHaveFeatures">Must-Have Features (comma separated)</label>
              <input type="text" id="ai-search-features" placeholder="e.g. Leather seats, Sunroof, Navigation" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);" data-i18n="member.aiSearch.notifications">Notifications & Settings</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 12px; display: block;" data-i18n="member.aiSearch.notifyVia">Notify me via</label>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="ai-search-notify-email" checked> 
                    <span data-i18n="member.aiSearch.emailNotify">Email notifications</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="ai-search-notify-sms"> 
                    <span data-i18n="member.aiSearch.smsNotify">SMS notifications</span>
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.searchFrequency">Search Frequency</label>
                <select id="ai-search-frequency" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="hourly" data-i18n="member.aiSearch.freqHourly">Hourly</option>
                  <option value="twice_daily" data-i18n="member.aiSearch.freqTwiceDaily">Twice Daily</option>
                  <option value="daily" selected data-i18n="member.aiSearch.freqDaily">Daily</option>
                </select>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 8px; display: block;" data-i18n="member.aiSearch.emailReportFrequency">Email Report Frequency</label>
                <select id="ai-search-email-report-frequency" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="none">No email reports</option>
                  <option value="daily" selected>Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="quarterly">Quarterly</option>
                  <option value="yearly">Yearly</option>
                </select>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 6px;">Receive a comprehensive list of all matches found during this period</p>
              </div>

              <div class="form-group">
                <label style="font-size: 0.88rem; font-weight: 500; margin-bottom: 12px; display: block;" data-i18n="member.aiSearch.activeStatus">Active Status</label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="ai-search-active" checked>
                  <span data-i18n="member.aiSearch.searchActive">Search is active</span>
                </label>
              </div>
            </div>

            <div class="modal-footer" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-subtle); display: flex; justify-content: flex-end; gap: 12px;">
              <button type="button" class="btn btn-secondary" onclick="closeAISearchModal()" data-i18n="common.cancel">Cancel</button>
              <button type="submit" class="btn btn-primary" data-i18n="common.save">Save Search</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- AI Match Detail Modal -->
    <div class="modal-backdrop" id="ai-match-detail-modal">
      <div class="modal wide">
        <div class="modal-header">
          <h2 class="modal-title" id="ai-match-modal-title" data-i18n="member.aiSearch.matchDetails">Match Details</h2>
          <button class="modal-close" onclick="closeAIMatchModal()">Ã—</button>
        </div>
        <div class="modal-body" id="ai-match-modal-body">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeAIMatchModal()" data-i18n="common.close">Close</button>
          <button class="btn btn-primary" id="ai-match-add-prospect-btn" onclick="addMatchToProspects()" data-i18n="member.aiSearch.addToProspects">Add to Prospects</button>
        </div>
      </div>
    </div>

    <!-- Add Prospect Vehicle Modal -->
    <div id="add-prospect-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>Add Prospect Vehicle</h2>
          <button class="modal-close" onclick="closeAddProspectModal()">Ã—</button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
          <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-input); border-radius: var(--radius-md); border: 1px solid var(--border-subtle);">
            <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 12px;">Quick VIN Lookup (Optional)</h4>
            <div style="display: flex; gap: 12px;">
              <input type="text" id="prospect-vin-lookup" placeholder="Enter VIN to auto-fill specs" maxlength="17" style="flex: 1; padding: 12px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); text-transform: uppercase;">
              <button type="button" class="btn btn-secondary" onclick="lookupProspectVIN()" id="vin-lookup-btn">
                ðŸ” Lookup
              </button>
            </div>
            <p style="font-size: 0.78rem; color: var(--text-muted); margin-top: 8px;">Uses free NHTSA database - fills year, make, model, and specs.</p>
          </div>

          <form id="add-prospect-form" onsubmit="saveProspectVehicle(event)">
            <h4 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 16px; color: var(--accent-gold);">Vehicle Details</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <div class="form-group">
                <label>Year *</label>
                <input type="number" id="prospect-year" required min="1900" max="2030" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Make *</label>
                <input type="text" id="prospect-make" required placeholder="e.g. Toyota" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Model *</label>
                <input type="text" id="prospect-model" required placeholder="e.g. Camry" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Trim</label>
                <input type="text" id="prospect-trim" placeholder="e.g. XLE, Sport" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Body Style</label>
                <select id="prospect-body-style" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">Select...</option>
                  <option value="Sedan">Sedan</option>
                  <option value="SUV">SUV</option>
                  <option value="Truck">Truck</option>
                  <option value="Coupe">Coupe</option>
                  <option value="Hatchback">Hatchback</option>
                  <option value="Wagon">Wagon</option>
                  <option value="Convertible">Convertible</option>
                  <option value="Van">Van/Minivan</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Engine</label>
                <input type="text" id="prospect-engine" placeholder="e.g. 2.5L 4-cyl" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Fuel Type</label>
                <select id="prospect-fuel-type" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">Select...</option>
                  <option value="Gasoline">Gasoline</option>
                  <option value="Diesel">Diesel</option>
                  <option value="Hybrid">Hybrid</option>
                  <option value="Electric">Electric</option>
                  <option value="Plug-in Hybrid">Plug-in Hybrid</option>
                </select>
              </div>
              <div class="form-group">
                <label>Mileage</label>
                <input type="number" id="prospect-mileage" placeholder="e.g. 45000" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Asking Price ($)</label>
                <input type="number" id="prospect-price" placeholder="e.g. 25000" step="0.01" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Exterior Color</label>
                <input type="text" id="prospect-ext-color" placeholder="e.g. Silver" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Interior Color</label>
                <input type="text" id="prospect-int-color" placeholder="e.g. Black leather" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>VIN (if known)</label>
                <input type="text" id="prospect-vin" placeholder="17-character VIN" maxlength="17" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); text-transform: uppercase;">
              </div>
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);">Seller Information</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <div class="form-group">
                <label>Seller Type</label>
                <select id="prospect-seller-type" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
                  <option value="">Select...</option>
                  <option value="dealer">Dealer</option>
                  <option value="private">Private Seller</option>
                  <option value="auction">Auction</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Seller Name</label>
                <input type="text" id="prospect-seller-name" placeholder="Dealer or seller name" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Location</label>
                <input type="text" id="prospect-location" placeholder="City, State or Address" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Listing URL</label>
                <input type="url" id="prospect-listing-url" placeholder="https://..." style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);">Carfax / History (Manual Entry)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div class="form-group">
                <label>Accidents</label>
                <input type="number" id="prospect-accidents" placeholder="0" min="0" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group">
                <label>Previous Owners</label>
                <input type="number" id="prospect-owners" placeholder="1" min="1" style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary);">
              </div>
              <div class="form-group" style="display: flex; flex-direction: column; justify-content: center;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="prospect-service-records" style="width: 18px; height: 18px; accent-color: var(--accent-gold);">
                  <span>Has Service Records</span>
                </label>
              </div>
            </div>
            <div class="form-group" style="margin-top: 12px;">
              <label>Carfax/History Notes</label>
              <textarea id="prospect-carfax-notes" rows="2" placeholder="Any notes from the Carfax report..." style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); resize: vertical;"></textarea>
            </div>

            <h4 style="font-size: 0.95rem; font-weight: 600; margin: 24px 0 16px; color: var(--accent-gold);">Your Assessment</h4>
            <div class="form-group">
              <label>Your Rating</label>
              <div id="prospect-rating-stars" style="display: flex; gap: 8px; margin-top: 8px;">
                <span class="rating-star" data-rating="1" onclick="setProspectRating(1)" style="font-size: 28px; cursor: pointer; opacity: 0.3;">â­</span>
                <span class="rating-star" data-rating="2" onclick="setProspectRating(2)" style="font-size: 28px; cursor: pointer; opacity: 0.3;">â­</span>
                <span class="rating-star" data-rating="3" onclick="setProspectRating(3)" style="font-size: 28px; cursor: pointer; opacity: 0.3;">â­</span>
                <span class="rating-star" data-rating="4" onclick="setProspectRating(4)" style="font-size: 28px; cursor: pointer; opacity: 0.3;">â­</span>
                <span class="rating-star" data-rating="5" onclick="setProspectRating(5)" style="font-size: 28px; cursor: pointer; opacity: 0.3;">â­</span>
              </div>
              <input type="hidden" id="prospect-rating" value="">
            </div>
            <div class="form-group" style="margin-top: 16px;">
              <label>Personal Notes</label>
              <textarea id="prospect-notes" rows="3" placeholder="Your thoughts on this vehicle..." style="width: 100%; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); resize: vertical;"></textarea>
            </div>

            <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
              <button type="button" class="btn btn-secondary" onclick="closeAddProspectModal()">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Prospect</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- View Prospect Modal -->
    <div id="view-prospect-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h2 id="view-prospect-title">Vehicle Details</h2>
          <button class="modal-close" onclick="closeViewProspectModal()">Ã—</button>
        </div>
        <div class="modal-body" id="view-prospect-body" style="max-height: 70vh; overflow-y: auto;">
        </div>
      </div>
    </div>

    <!-- Dream Car Finder Section -->
    <section id="dream-car-finder" class="section">
      <div class="page-header" style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
        <div>
          <h1 class="page-title">âœ¨ Dream Car Finder</h1>
          <p class="page-subtitle">AI-powered searches to find your perfect vehicle. Set your criteria and we'll notify you when matches are found.</p>
        </div>
        <button class="btn btn-primary" onclick="openAISearchModal()">+ Create AI Search</button>
      </div>

      <div class="card" style="margin-bottom: 24px;">
        <h3 style="margin-bottom: 16px;">ðŸ” Your Active Searches</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">Set up criteria for your dream car and our AI will continuously search for matching listings.</p>
        <div id="dream-car-searches-list">
          <div class="empty-state" style="padding: 40px 20px;">
            <div class="empty-state-icon">ðŸš—</div>
            <p style="margin-bottom: 16px;">No AI searches configured yet.</p>
            <button class="btn btn-primary" onclick="openAISearchModal()">Create Your First Search</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3>ðŸŽ¯ Recent Matches</h3>
          <span class="nav-badge" id="dream-matches-badge" style="display: none;">0</span>
        </div>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">Vehicles that match your search criteria. Review and save the ones you like!</p>
        <div id="dream-car-matches-list">
          <div class="empty-state" style="padding: 40px 20px;">
            <div class="empty-state-icon">ðŸ“­</div>
            <p>No matches yet. Create a search to start finding vehicles!</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Reminders Section -->
    <section id="reminders" class="section">
      <div class="page-header" style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
        <div>
          <h1 class="page-title">Reminders</h1>
          <p class="page-subtitle">Stay on top of your vehicle maintenance.</p>
        </div>
        <div style="display:flex;gap:12px;align-items:center;">
          <button id="show-dismissed-btn" class="btn btn-ghost btn-sm" onclick="toggleDismissedReminders()" style="display:none;">Show dismissed</button>
          <button class="btn btn-primary" onclick="openCreateReminderModal()">+ Add Reminder</button>
        </div>
      </div>

      <div id="reminders-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ””</div>
          <p>No reminders set.</p>
        </div>
      </div>
    </section>

    <!-- Maintenance Packages Section -->
    <section id="packages" class="section">
      <div class="page-header">
        <h1 class="page-title">Maintenance Packages</h1>
        <p class="page-subtitle">Create packages and let providers compete for your business.</p>
      </div>

      <div style="margin-bottom: 24px;">
        <button class="btn btn-primary" onclick="openPackageModal()">+ New Package</button>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="open">Open</div>
        <div class="tab" data-tab="active">In Progress</div>
        <div class="tab" data-tab="completed">Completed</div>
        <div class="tab" data-tab="all">All</div>
      </div>

      <div class="packages-list" id="packages-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ“¦</div>
          <p>No maintenance packages yet.</p>
        </div>
      </div>
    </section>

    <!-- Shop Section -->
    <section id="shop" class="section">
      <div class="page-header">
        <h1 class="page-title">ðŸ›ï¸ MCC Shop</h1>
        <p class="page-subtitle">Official My Car Concierge merchandise and accessories</p>
      </div>

      <div class="shop-layout" style="display:grid;grid-template-columns:1fr 320px;gap:24px;">
        <!-- Products Area -->
        <div class="shop-products-area">
          <!-- Category Filters -->
          <div class="shop-filters" style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap;">
            <button class="btn shop-filter-btn active" data-category="all" onclick="filterShopProducts('all')">All Products</button>
            <button class="btn shop-filter-btn" data-category="apparel" onclick="filterShopProducts('apparel')">ðŸ‘• Apparel</button>
            <button class="btn shop-filter-btn" data-category="accessories" onclick="filterShopProducts('accessories')">ðŸŽ’ Accessories</button>
            <button class="btn shop-filter-btn" data-category="decals" onclick="filterShopProducts('decals')">ðŸ·ï¸ Decals</button>
          </div>

          <!-- Product Grid -->
          <div class="shop-products-grid" id="shop-products-grid" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));gap:20px;">
            <!-- Products will be loaded here -->
          </div>

          <div id="shop-empty-state" class="empty-state" style="display:none;">
            <div class="empty-state-icon">ðŸ›ï¸</div>
            <p>No products available in this category.</p>
          </div>
        </div>

        <!-- Cart Sidebar -->
        <div class="shop-cart-sidebar" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;height:fit-content;position:sticky;top:24px;">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border-subtle);">
            <span style="font-size:24px;">ðŸ›’</span>
            <h3 style="font-size:1.1rem;font-weight:600;">Your Cart</h3>
            <span class="nav-badge" id="cart-item-count" style="margin-left:auto;background:var(--accent-gold);color:var(--bg-deep);">0</span>
          </div>

          <div id="cart-items-list" style="max-height:300px;overflow-y:auto;margin-bottom:16px;">
            <div class="empty-state" style="padding:24px 0;">
              <div style="font-size:40px;margin-bottom:12px;">ðŸ›’</div>
              <p style="color:var(--text-muted);font-size:0.9rem;">Your cart is empty</p>
            </div>
          </div>

          <div id="cart-summary" style="display:none;padding-top:16px;border-top:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span style="color:var(--text-secondary);">Subtotal:</span>
              <span id="cart-subtotal" style="font-weight:500;">$0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span style="color:var(--text-secondary);">Shipping:</span>
              <span id="cart-shipping" style="font-weight:500;">Calculated at checkout</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding-top:12px;border-top:1px solid var(--border-subtle);margin-top:12px;">
              <span style="font-weight:600;">Estimated Total:</span>
              <span id="cart-total" style="font-size:1.2rem;font-weight:700;color:var(--accent-gold);">$0.00</span>
            </div>
          </div>

          <button id="checkout-btn" class="btn btn-primary" onclick="proceedToCheckout()" style="width:100%;margin-top:20px;padding:14px 20px;font-size:1rem;" disabled>
            Proceed to Checkout
          </button>
          <button id="clear-cart-btn" class="btn btn-ghost" onclick="clearCart()" style="width:100%;margin-top:8px;display:none;">
            Clear Cart
          </button>
        </div>
      </div>

      <!-- Mobile Cart Button -->
      <div id="mobile-cart-btn" style="display:none;position:fixed;bottom:24px;right:24px;z-index:50;">
        <button class="btn btn-primary" onclick="showCartModal()" style="width:60px;height:60px;border-radius:50%;font-size:24px;padding:0;box-shadow:0 4px 20px rgba(212,168,85,0.4);">
          ðŸ›’
          <span id="mobile-cart-count" style="position:absolute;top:-5px;right:-5px;background:var(--accent-red);color:white;font-size:0.7rem;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;">0</span>
        </button>
      </div>
    </section>

    <!-- Cart Modal (for mobile) -->
    <div id="cart-modal" class="modal-backdrop">
      <div class="modal" style="max-width:400px;">
        <div class="modal-header">
          <h3 class="modal-title">ðŸ›’ Your Cart</h3>
          <button class="btn btn-ghost" onclick="closeModal('cart-modal')">âœ•</button>
        </div>
        <div class="modal-body">
          <div id="cart-modal-items" style="max-height:400px;overflow-y:auto;margin-bottom:16px;">
            <!-- Cart items rendered here -->
          </div>
          <div id="cart-modal-summary" style="padding-top:16px;border-top:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span style="color:var(--text-secondary);">Subtotal:</span>
              <span id="cart-modal-subtotal" style="font-weight:500;">$0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding-top:12px;border-top:1px solid var(--border-subtle);margin-top:12px;">
              <span style="font-weight:600;">Total:</span>
              <span id="cart-modal-total" style="font-size:1.2rem;font-weight:700;color:var(--accent-gold);">$0.00</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal('cart-modal')">Continue Shopping</button>
          <button class="btn btn-primary" onclick="proceedToCheckout()">Checkout</button>
        </div>
      </div>
    </div>

    <!-- Order History Section -->
    <section id="order-history" class="section">
      <div class="page-header">
        <h1 class="page-title">ðŸ“¦ Order History</h1>
        <p class="page-subtitle">View your merchandise orders and track shipments</p>
      </div>

      <div id="order-history-content">
        <div id="order-history-loading" class="empty-state" style="padding:60px 20px;">
          <div style="font-size:48px;margin-bottom:16px;">â³</div>
          <p style="color:var(--text-secondary);">Loading your orders...</p>
        </div>

        <div id="order-history-empty" class="empty-state" style="display:none;padding:60px 20px;">
          <div style="font-size:64px;margin-bottom:16px;">ðŸ“¦</div>
          <h3 style="font-size:1.2rem;font-weight:600;margin-bottom:8px;">No Orders Yet</h3>
          <p style="color:var(--text-secondary);margin-bottom:24px;">You haven't placed any merchandise orders yet.</p>
          <button class="btn btn-primary" onclick="showSection('shop')">ðŸ›ï¸ Browse Shop</button>
        </div>

        <div id="order-history-list" class="order-history-list" style="display:none;">
        </div>
      </div>
    </section>

    <!-- Cost Estimator Section -->
    <section id="cost-estimator" class="section">
      <div class="page-header">
        <h1 class="page-title">Cost Estimator</h1>
        <p class="page-subtitle">Get an idea of fair pricing before providers bid</p>
      </div>

      <!-- Step Indicator -->
      <div class="estimator-steps" style="display:flex;gap:8px;margin-bottom:32px;flex-wrap:wrap;">
        <div class="estimator-step active" id="estimator-step-1" style="flex:1;min-width:120px;padding:12px 16px;background:var(--accent-gold-soft);border:2px solid var(--accent-gold);border-radius:var(--radius-md);text-align:center;cursor:pointer;" onclick="showEstimatorStep(1)">
          <div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:4px;">Step 1</div>
          <div style="font-weight:600;color:var(--accent-gold);">Category</div>
        </div>
        <div class="estimator-step" id="estimator-step-2" style="flex:1;min-width:120px;padding:12px 16px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-md);text-align:center;opacity:0.5;">
          <div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:4px;">Step 2</div>
          <div style="font-weight:600;">Vehicle</div>
        </div>
        <div class="estimator-step" id="estimator-step-3" style="flex:1;min-width:120px;padding:12px 16px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-md);text-align:center;opacity:0.5;">
          <div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:4px;">Step 3</div>
          <div style="font-weight:600;">Service</div>
        </div>
        <div class="estimator-step" id="estimator-step-4" style="flex:1;min-width:120px;padding:12px 16px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-md);text-align:center;opacity:0.5;">
          <div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:4px;">Step 4</div>
          <div style="font-weight:600;">Results</div>
        </div>
      </div>

      <!-- Step 1: Category Selection -->
      <div id="estimator-panel-1" class="estimator-panel">
        <h3 style="margin-bottom:20px;font-size:1.1rem;">What type of service do you need?</h3>
        <div class="category-grid" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(160px, 1fr));gap:16px;">
          <div class="category-card" onclick="selectEstimatorCategory('maintenance')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ”§</div>
            <div style="font-weight:600;">Maintenance</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Oil changes, brakes, fluids</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('repair')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ› ï¸</div>
            <div style="font-weight:600;">Repairs</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Engine, transmission, AC</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('detailing')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">âœ¨</div>
            <div style="font-weight:600;">Detailing</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Wash, wax, interior clean</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('body')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸš—</div>
            <div style="font-weight:600;">Body Work</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Dents, scratches, paint</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('inspection')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ”</div>
            <div style="font-weight:600;">Inspection</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Pre-purchase, state</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('diagnostic')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ“Š</div>
            <div style="font-weight:600;">Diagnostics</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Check engine, electrical</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('ev_hybrid')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">âš¡</div>
            <div style="font-weight:600;">EV & Hybrid</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Battery, charging, hybrid</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('protection')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ›¡ï¸</div>
            <div style="font-weight:600;">Protection</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Coatings, PPF, tinting</div>
          </div>
          <div class="category-card" onclick="selectEstimatorCategory('engine_performance')" style="background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
            <div style="font-size:2.5rem;margin-bottom:12px;">âš™ï¸</div>
            <div style="font-weight:600;">Engine & Performance</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">Carbon cleaning, tuning</div>
          </div>
        </div>
      </div>

      <!-- Step 2: Vehicle Selection -->
      <div id="estimator-panel-2" class="estimator-panel" style="display:none;">
        <h3 style="margin-bottom:20px;font-size:1.1rem;">Select your vehicle</h3>
        
        <div id="estimator-saved-vehicles" style="margin-bottom:24px;"></div>
        
        <div class="card" style="background:var(--bg-elevated);border-style:dashed;">
          <h4 style="margin-bottom:16px;">Or enter vehicle details manually</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:16px;">
            <div class="form-group" style="margin-bottom:0;">
              <label class="form-label">Make</label>
              <select class="form-select" id="estimator-make" onchange="updateEstimatorModels()">
                <option value="">Select Make</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label class="form-label">Model (optional)</label>
              <input type="text" class="form-input" id="estimator-model" placeholder="e.g., Camry">
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label class="form-label">Year (optional)</label>
              <input type="number" class="form-input" id="estimator-year" placeholder="e.g., 2022" min="1980" max="2026">
            </div>
          </div>
          <button class="btn btn-primary" style="margin-top:16px;" onclick="useManualVehicle()">Use This Vehicle</button>
        </div>
        
        <div style="display:flex;gap:12px;margin-top:24px;">
          <button class="btn btn-secondary" onclick="showEstimatorStep(1)">â† Back</button>
        </div>
      </div>

      <!-- Step 3: Service Selection -->
      <div id="estimator-panel-3" class="estimator-panel" style="display:none;">
        <h3 style="margin-bottom:8px;font-size:1.1rem;">Select service type</h3>
        <p style="color:var(--text-secondary);margin-bottom:20px;font-size:0.9rem;">
          <span id="estimator-category-display" style="background:var(--accent-gold-soft);color:var(--accent-gold);padding:4px 12px;border-radius:100px;font-weight:500;"></span>
          for <span id="estimator-vehicle-display" style="font-weight:500;"></span>
        </p>
        
        <div class="form-group">
          <label class="form-label">Service Type</label>
          <select class="form-select" id="estimator-service" onchange="updateEstimatorTiers()">
            <option value="">Select a service...</option>
          </select>
        </div>
        
        <div id="estimator-tier-section" style="display:none;margin-top:20px;">
          <label class="form-label">Service Level</label>
          <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px;">
            <div class="tier-option" data-tier="basic" onclick="selectEstimatorTier('basic')" style="background:var(--bg-card);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
              <div style="font-weight:600;margin-bottom:4px;">Basic</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Standard parts</div>
            </div>
            <div class="tier-option selected" data-tier="standard" onclick="selectEstimatorTier('standard')" style="background:var(--accent-gold-soft);border:2px solid var(--accent-gold);border-radius:var(--radius-md);padding:16px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
              <div style="font-weight:600;margin-bottom:4px;color:var(--accent-gold);">Standard</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Recommended</div>
            </div>
            <div class="tier-option" data-tier="premium" onclick="selectEstimatorTier('premium')" style="background:var(--bg-card);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;text-align:center;cursor:pointer;transition:all 0.2s ease;">
              <div style="font-weight:600;margin-bottom:4px;">Premium</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">OEM/Synthetic</div>
            </div>
          </div>
        </div>

        <div id="estimator-region-section" style="margin-top:20px;">
          <label class="form-label">Your Region</label>
          <select class="form-select" id="estimator-region">
            <option value="national">National Average</option>
            <option value="west">West Coast (CA, WA, OR, NV, AZ, CO)</option>
            <option value="northeast">Northeast (NY, NJ, CT, MA, PA, MD)</option>
            <option value="midwest">Midwest (IL, OH, MI, IN, WI, MN)</option>
            <option value="south">South (TX, FL, GA, NC, TN, LA)</option>
          </select>
        </div>
        
        <div style="display:flex;gap:12px;margin-top:24px;">
          <button class="btn btn-secondary" onclick="showEstimatorStep(2)">â† Back</button>
          <button class="btn btn-primary" id="calculate-estimate-btn" onclick="calculateEstimate()" disabled>Calculate Estimate â†’</button>
        </div>
      </div>

      <!-- Step 4: Results -->
      <div id="estimator-panel-4" class="estimator-panel" style="display:none;">
        <div class="card" style="background:linear-gradient(135deg, rgba(74,124,255,0.1), rgba(212,168,85,0.08));border-color:rgba(74,124,255,0.2);margin-bottom:24px;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;margin-bottom:24px;">
            <div>
              <h3 style="font-size:1.3rem;margin-bottom:8px;" id="estimate-service-title">Oil Change</h3>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <span id="estimate-vehicle-badge" style="background:var(--accent-blue-soft);color:var(--accent-blue);padding:4px 12px;border-radius:100px;font-size:0.8rem;font-weight:500;">European</span>
                <span id="estimate-region-badge" style="background:var(--accent-gold-soft);color:var(--accent-gold);padding:4px 12px;border-radius:100px;font-size:0.8rem;font-weight:500;">West Coast +15%</span>
                <span id="estimate-tier-badge" style="background:var(--accent-green-soft);color:var(--accent-green);padding:4px 12px;border-radius:100px;font-size:0.8rem;font-weight:500;display:none;">Premium</span>
              </div>
            </div>
            <div id="estimate-confidence" style="text-align:right;">
              <div style="font-size:0.8rem;color:var(--text-muted);">Confidence</div>
              <div style="font-weight:600;color:var(--accent-green);">Industry Estimate</div>
            </div>
          </div>
          
          <!-- Price Range Visualization -->
          <div style="margin-bottom:24px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.85rem;">
              <span style="color:var(--text-muted);">Low</span>
              <span style="color:var(--text-muted);">Average</span>
              <span style="color:var(--text-muted);">High</span>
            </div>
            <div style="position:relative;height:40px;background:linear-gradient(90deg, var(--accent-green), var(--accent-gold), var(--accent-orange));border-radius:var(--radius-md);overflow:hidden;">
              <div id="estimate-avg-marker" style="position:absolute;top:0;bottom:0;width:4px;background:white;box-shadow:0 0 10px rgba(0,0,0,0.5);"></div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:8px;">
              <span id="estimate-price-low" style="font-size:1.2rem;font-weight:600;color:var(--accent-green);">$75</span>
              <span id="estimate-price-avg" style="font-size:1.5rem;font-weight:700;color:var(--accent-gold);">$125</span>
              <span id="estimate-price-high" style="font-size:1.2rem;font-weight:600;color:var(--accent-orange);">$180</span>
            </div>
          </div>

          <div style="text-align:center;padding:16px;background:var(--bg-card);border-radius:var(--radius-md);margin-bottom:20px;">
            <div style="font-size:0.9rem;color:var(--text-muted);margin-bottom:4px;">Expected Price Range</div>
            <div style="font-size:2rem;font-weight:700;color:var(--text-primary);" id="estimate-range-display">$75 - $180</div>
          </div>
        </div>

        <!-- Why This Range -->
        <div class="card" style="margin-bottom:20px;">
          <h4 style="margin-bottom:16px;display:flex;align-items:center;gap:8px;">
            <span>ðŸ’¡</span> Why This Range?
          </h4>
          <ul id="estimate-factors" style="list-style:none;padding:0;margin:0;color:var(--text-secondary);line-height:2;">
          </ul>
          <div id="estimate-education-container"></div>
        </div>

        <!-- Ways to Save -->
        <div class="card" style="background:var(--accent-green-soft);border-color:rgba(74,200,140,0.3);margin-bottom:24px;">
          <h4 style="margin-bottom:16px;display:flex;align-items:center;gap:8px;color:var(--accent-green);">
            <span>ðŸ’¡</span> Ways to Save
          </h4>
          <ul style="list-style:none;padding:0;margin:0;color:var(--text-secondary);line-height:2;">
            <li>âœ“ Schedule ahead for non-urgent services</li>
            <li>âœ“ Consider aftermarket parts for non-safety items</li>
            <li>âœ“ Compare multiple bids - post a service request</li>
            <li>âœ“ Ask about bundle discounts for multiple services</li>
          </ul>
        </div>

        <!-- Important Disclaimer -->
        <div style="background:rgba(148,148,168,0.08);border:1px solid rgba(148,148,168,0.15);border-radius:var(--radius-md);padding:16px 20px;margin-bottom:24px;">
          <div style="display:flex;align-items:flex-start;gap:12px;">
            <span style="font-size:1.2rem;flex-shrink:0;">âš ï¸</span>
            <div>
              <div style="font-weight:600;color:var(--text-secondary);margin-bottom:6px;font-size:0.85rem;text-transform:uppercase;letter-spacing:0.03em;">Important Disclaimer</div>
              <p style="font-size:0.85rem;color:var(--text-muted);line-height:1.6;margin:0;">
                This estimate is for <strong style="color:var(--text-secondary);">informational purposes only</strong> and is based on industry averages and regional data. It does <strong style="color:var(--text-secondary);">not constitute a price guarantee</strong>. Actual provider bids may vary based on vehicle condition, parts availability, labor complexity, and other factors. My Car Concierge does not guarantee pricing, service quality, or outcomes. Always review provider bids carefully before accepting.
              </p>
            </div>
          </div>
        </div>
        
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <button class="btn btn-secondary" onclick="showEstimatorStep(1)">â† Start Over</button>
          <button class="btn btn-primary" onclick="postServiceFromEstimate()" style="flex:1;min-width:200px;">
            ðŸ“¦ Post Service Request
          </button>
        </div>
      </div>
    </section>

    <!-- Maintenance Schedule Section -->
    <section id="maintenance-schedule" class="section">
      <div class="page-header">
        <h1 class="page-title">ðŸ”§ Maintenance Schedule</h1>
        <p class="page-subtitle">Personalized service intervals for your vehicles based on manufacturer recommendations.</p>
      </div>

      <!-- Vehicle Selector Tabs -->
      <div id="maintenance-vehicle-tabs" class="tabs" style="margin-bottom:24px;flex-wrap:wrap;gap:8px;">
        <div class="empty-state" id="maintenance-no-vehicles" style="display:none;">
          <div class="empty-state-icon">ðŸš—</div>
          <p>Add a vehicle to see its maintenance schedule.</p>
          <button class="btn btn-primary" onclick="showSection('vehicles')">Add Vehicle</button>
        </div>
      </div>

      <!-- Legend -->
      <div class="card" style="margin-bottom:24px;padding:16px;">
        <div style="display:flex;flex-wrap:wrap;gap:20px;align-items:center;font-size:0.85rem;">
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:var(--accent-red);"></span>
            <span style="color:var(--text-secondary);">Overdue</span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:var(--accent-orange);"></span>
            <span style="color:var(--text-secondary);">Due Soon</span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:var(--accent-green);"></span>
            <span style="color:var(--text-secondary);">Up to Date</span>
          </div>
          <div style="margin-left:auto;display:flex;gap:8px;">
            <button class="btn btn-secondary btn-sm" onclick="openDrivingConditionsModal()" style="font-size:0.8rem;padding:8px 12px;">âš™ï¸ Driving Conditions</button>
            <button class="btn btn-primary btn-sm" onclick="openLogServiceModal()" style="font-size:0.8rem;padding:8px 12px;">+ Log Service</button>
          </div>
        </div>
      </div>

      <!-- Maintenance Summary Stats -->
      <div id="maintenance-summary" style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:16px;margin-bottom:24px;">
        <div class="stat-card" style="border-color:var(--accent-red);cursor:pointer;" onclick="filterMaintenanceStatus('overdue')">
          <div class="stat-icon" style="background:rgba(239,95,95,0.1);color:var(--accent-red);">âš ï¸</div>
          <div class="stat-value" id="maint-overdue-count" style="color:var(--accent-red);">0</div>
          <div class="stat-label">Overdue</div>
        </div>
        <div class="stat-card" style="border-color:var(--accent-orange);cursor:pointer;" onclick="filterMaintenanceStatus('due-soon')">
          <div class="stat-icon" style="background:rgba(255,159,67,0.1);color:var(--accent-orange);">ðŸ””</div>
          <div class="stat-value" id="maint-due-soon-count" style="color:var(--accent-orange);">0</div>
          <div class="stat-label">Due Soon</div>
        </div>
        <div class="stat-card" style="border-color:var(--accent-green);cursor:pointer;" onclick="filterMaintenanceStatus('up-to-date')">
          <div class="stat-icon" style="background:rgba(74,200,140,0.1);color:var(--accent-green);">âœ…</div>
          <div class="stat-value" id="maint-up-to-date-count" style="color:var(--accent-green);">0</div>
          <div class="stat-label">Up to Date</div>
        </div>
        <div class="stat-card" onclick="filterMaintenanceStatus('all')">
          <div class="stat-icon">ðŸ“‹</div>
          <div class="stat-value" id="maint-total-count">0</div>
          <div class="stat-label">Total Items</div>
        </div>
      </div>

      <!-- Current Mileage Input -->
      <div class="card" style="margin-bottom:24px;background:var(--accent-blue-soft);border-color:rgba(74,124,255,0.3);">
        <div style="display:flex;flex-wrap:wrap;align-items:center;gap:16px;">
          <div style="flex:1;min-width:200px;">
            <div style="font-weight:600;margin-bottom:4px;">Current Mileage</div>
            <div style="font-size:0.85rem;color:var(--text-muted);">Enter your current odometer reading for accurate due dates</div>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            <input type="number" id="current-mileage-input" placeholder="e.g., 45000" style="width:140px;padding:10px 14px;border-radius:var(--radius-md);border:1px solid var(--border-subtle);background:var(--bg-card);color:var(--text-primary);font-size:1rem;" />
            <span style="color:var(--text-muted);">miles</span>
            <button class="btn btn-primary btn-sm" onclick="updateVehicleMileage()">Update</button>
          </div>
        </div>
      </div>

      <!-- Maintenance Items Grid -->
      <div id="maintenance-items-container">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ”§</div>
          <p>Select a vehicle to view its maintenance schedule.</p>
        </div>
      </div>

      <!-- Disclaimer -->
      <div style="background:rgba(148,148,168,0.08);border:1px solid rgba(148,148,168,0.15);border-radius:var(--radius-md);padding:16px 20px;margin-top:24px;">
        <div style="display:flex;align-items:flex-start;gap:12px;">
          <span style="font-size:1.2rem;flex-shrink:0;">â„¹ï¸</span>
          <p style="font-size:0.8rem;color:var(--text-muted);line-height:1.6;margin:0;">
            Maintenance intervals are based on manufacturer recommendations and adjusted for your vehicle's age, mileage, and driving conditions. Actual needs may vary. Always consult your owner's manual or a qualified mechanic for specific guidance.
          </p>
        </div>
      </div>
    </section>

    <!-- Log Service Modal -->
    <div id="log-service-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:500px;">
        <div class="modal-header">
          <h2>Log Completed Service</h2>
          <button class="modal-close" onclick="closeLogServiceModal()">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Service Type</label>
            <select id="log-service-type" class="form-control">
              <option value="">Select a service...</option>
            </select>
          </div>
          <div class="form-group">
            <label>Service Date</label>
            <input type="date" id="log-service-date" class="form-control" />
          </div>
          <div class="form-group">
            <label>Mileage at Service</label>
            <input type="number" id="log-service-mileage" class="form-control" placeholder="e.g., 45000" />
          </div>
          <div class="form-group">
            <label>Performed By (optional)</label>
            <input type="text" id="log-service-by" class="form-control" placeholder="e.g., Dealer, DIY, Shop Name" />
          </div>
          <div class="form-group">
            <label>Cost (optional)</label>
            <input type="number" id="log-service-cost" class="form-control" placeholder="e.g., 75.00" step="0.01" />
          </div>
          <div class="form-group">
            <label>Notes (optional)</label>
            <textarea id="log-service-notes" class="form-control" rows="2" placeholder="Any additional details..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeLogServiceModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveServiceLog()">Save Service</button>
        </div>
      </div>
    </div>

    <!-- Driving Conditions Modal -->
    <div id="driving-conditions-modal" class="modal" style="display:none;">
      <div class="modal-content" style="max-width:500px;">
        <div class="modal-header">
          <h2>Driving Conditions</h2>
          <button class="modal-close" onclick="closeDrivingConditionsModal()">âœ•</button>
        </div>
        <div class="modal-body">
          <p style="color:var(--text-muted);font-size:0.9rem;margin-bottom:20px;">
            Your driving conditions affect how often maintenance is needed. Select options that apply to shorten intervals appropriately.
          </p>
          <div class="form-group">
            <label>Primary Use</label>
            <select id="driving-primary-use" class="form-control">
              <option value="mixed">Mixed (City & Highway)</option>
              <option value="highway">Mostly Highway</option>
              <option value="city">Mostly City/Stop-and-Go</option>
              <option value="severe">Severe (Towing, Off-road, etc.)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Climate</label>
            <select id="driving-climate" class="form-control">
              <option value="moderate">Moderate</option>
              <option value="hot">Hot Climate</option>
              <option value="cold">Cold Climate</option>
              <option value="extreme">Extreme (Very Hot or Cold)</option>
            </select>
          </div>
          <div style="display:flex;flex-direction:column;gap:12px;margin-top:16px;">
            <label class="toggle-switch">
              <input type="checkbox" id="driving-towing" />
              <span class="toggle-slider"></span>
              <span style="margin-left:12px;">Regular towing or heavy hauling</span>
            </label>
            <label class="toggle-switch">
              <input type="checkbox" id="driving-short-trips" />
              <span class="toggle-slider"></span>
              <span style="margin-left:12px;">Frequent short trips (under 10 miles)</span>
            </label>
            <label class="toggle-switch">
              <input type="checkbox" id="driving-dusty" />
              <span class="toggle-slider"></span>
              <span style="margin-left:12px;">Dusty or dirty conditions</span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeDrivingConditionsModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveDrivingConditions()">Save Conditions</button>
        </div>
      </div>
    </div>

    <!-- Messages Section -->
    <section id="messages" class="section">
      <div class="page-header">
        <h1 class="page-title">Messages</h1>
        <p class="page-subtitle">Communicate with service providers.</p>
      </div>

      <div id="conversations-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ’¬</div>
          <p>No conversations yet.</p>
        </div>
      </div>
    </section>

    <!-- Upsell Requests Section (Additional Work Requests) -->
    <section id="upsells" class="section">
      <div class="page-header">
        <h1 class="page-title">Additional Work Requests</h1>
        <p class="page-subtitle">Providers may find additional issues during service. Review and approve below.</p>
      </div>

      <div class="card" style="background:var(--accent-blue-soft);border-color:rgba(74,124,255,0.3);margin-bottom:24px;">
        <h3 style="margin-bottom:12px;">ðŸ›¡ï¸ Your Protection</h3>
        <ul style="color:var(--text-secondary);line-height:1.8;padding-left:20px;">
          <li><strong>No pressure:</strong> You have 24 hours to decide on any additional work</li>
          <li><strong>Photo evidence:</strong> Providers must show you what they found</li>
          <li><strong>Your choice:</strong> You can approve, decline, or get competing bids</li>
          <li><strong>Scope locked:</strong> Original work proceeds regardless of your decision</li>
          <li><strong>Second opinion:</strong> Create a new package for competitive bids on any findings</li>
        </ul>
      </div>

      <div class="tabs" style="margin-bottom:20px;">
        <div class="tab active" data-upsell-filter="pending">Pending</div>
        <div class="tab" data-upsell-filter="approved">Approved</div>
        <div class="tab" data-upsell-filter="declined">Declined</div>
        <div class="tab" data-upsell-filter="all">All</div>
      </div>

      <div id="upsells-list">
        <div class="empty-state">
          <div class="empty-state-icon">âœ…</div>
          <p>No additional work requests. You're all set!</p>
        </div>
      </div>
    </section>

    <!-- Service History Section -->
    <section id="history" class="section">
      <div class="page-header">
        <h1 class="page-title">Service History</h1>
        <p class="page-subtitle">Complete record of all services performed across all providers.</p>
      </div>

      <div class="card" style="margin-bottom:24px;">
        <div style="display:flex;flex-wrap:wrap;gap:16px;align-items:flex-end;">
          <div class="form-group" style="flex:1;min-width:180px;margin-bottom:0;">
            <label class="form-label">Vehicle</label>
            <select class="form-select" id="history-vehicle-filter">
              <option value="">All Vehicles</option>
            </select>
          </div>
          <div class="form-group" style="flex:1;min-width:180px;margin-bottom:0;">
            <label class="form-label">Provider</label>
            <select class="form-select" id="history-provider-filter">
              <option value="">All Providers</option>
            </select>
          </div>
          <div class="form-group" style="flex:1;min-width:140px;margin-bottom:0;">
            <label class="form-label">From</label>
            <input type="date" class="form-input" id="history-start-date">
          </div>
          <div class="form-group" style="flex:1;min-width:140px;margin-bottom:0;">
            <label class="form-label">To</label>
            <input type="date" class="form-input" id="history-end-date">
          </div>
          <div class="form-group" style="flex:2;min-width:200px;margin-bottom:0;">
            <label class="form-label">Search</label>
            <input type="text" class="form-input" id="history-search" placeholder="Search services...">
          </div>
          <button class="btn btn-secondary" onclick="loadPosServiceHistory()" style="height:44px;">
            ðŸ” Search
          </button>
          <button class="btn btn-ghost" onclick="clearHistoryFilters()" style="height:44px;">
            Clear
          </button>
          <div style="position:relative;margin-left:auto;">
            <button class="btn btn-primary" id="export-history-btn" onclick="toggleExportDropdown()" style="height:44px;">
              ðŸ“¥ Export History
            </button>
            <div id="export-dropdown" class="export-dropdown" style="display:none;position:absolute;right:0;top:100%;margin-top:8px;background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:8px 0;min-width:160px;z-index:100;box-shadow:0 8px 24px rgba(0,0,0,0.3);">
              <button class="export-option" onclick="exportServiceHistory('pdf')" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;background:none;border:none;color:var(--text-primary);font-size:0.9rem;cursor:pointer;text-align:left;font-family:inherit;">
                ðŸ“„ Export as PDF
              </button>
              <button class="export-option" onclick="exportServiceHistory('csv')" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;background:none;border:none;color:var(--text-primary);font-size:0.9rem;cursor:pointer;text-align:left;font-family:inherit;">
                ðŸ“Š Export as CSV
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="history-stats" style="display:flex;gap:16px;margin-bottom:24px;flex-wrap:wrap;">
        <div class="stat-card" style="flex:1;min-width:150px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:12px;padding:16px;">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:4px;">Total Services</div>
          <div id="history-stat-total" style="font-size:1.5rem;font-weight:600;color:var(--text-primary);">0</div>
        </div>
        <div class="stat-card" style="flex:1;min-width:150px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:12px;padding:16px;">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:4px;">Total Spent</div>
          <div id="history-stat-spent" style="font-size:1.5rem;font-weight:600;color:var(--accent-gold);">$0.00</div>
        </div>
        <div class="stat-card" style="flex:1;min-width:150px;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:12px;padding:16px;">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:4px;">Providers Used</div>
          <div id="history-stat-providers" style="font-size:1.5rem;font-weight:600;color:var(--accent-blue);">0</div>
        </div>
      </div>

      <div id="history-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ“œ</div>
          <p>No service history yet.</p>
          <p style="font-size:0.9rem;color:var(--text-muted);margin-top:8px;">Completed walk-in services will appear here.</p>
        </div>
      </div>

      <div id="history-pagination" style="display:none;text-align:center;margin-top:24px;">
        <button class="btn btn-secondary" id="load-more-history" onclick="loadMoreHistory()">Load More</button>
      </div>
    </section>

    <!-- Spending Analytics Section -->
    <section id="spending-analytics" class="section">
      <div class="page-header">
        <h1 class="page-title">Spending Analytics</h1>
        <p class="page-subtitle">Track your service spending over time.</p>
      </div>

      <div class="card">
        <div class="card-header" style="flex-wrap:wrap;gap:16px;">
          <div>
            <h2 class="card-title">Service Spending</h2>
            <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Total spent in <span id="spending-year-label">2025</span>: <strong id="spending-total-label" style="color:var(--accent-gold);">$0.00</strong></p>
          </div>
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
            <select class="form-select" id="spending-vehicle-filter" style="min-width:180px;">
              <option value="">All Vehicles</option>
            </select>
            <select class="form-select" id="spending-year-filter" style="min-width:100px;"></select>
            <button class="btn btn-secondary btn-sm" onclick="downloadSpendingCSV()">ðŸ“¥ Download CSV</button>
          </div>
        </div>
        <div style="position:relative;height:350px;margin-top:20px;">
          <canvas id="spending-chart"></canvas>
        </div>
        <div id="spending-legend" style="display:flex;flex-wrap:wrap;gap:16px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border-subtle);">
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#4a7cff;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Parts: <strong id="legend-parts" style="color:var(--text-primary);">$0</strong></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#9b59b6;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Labor: <strong id="legend-labor" style="color:var(--text-primary);">$0</strong></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#e74c3c;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Taxes: <strong id="legend-taxes" style="color:var(--text-primary);">$0</strong></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#3498db;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Towing: <strong id="legend-towing" style="color:var(--text-primary);">$0</strong></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#4ac88c;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Platform Fee: <strong id="legend-platform" style="color:var(--text-primary);">$0</strong></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="width:12px;height:12px;border-radius:50%;background:#f59e0b;"></span>
            <span style="font-size:0.85rem;color:var(--text-secondary);">Other: <strong id="legend-other" style="color:var(--text-primary);">$0</strong></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Notifications Section -->
    <section id="notifications" class="section">
      <div class="page-header">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <h1 class="page-title">Notifications</h1>
            <p class="page-subtitle">Stay updated on your packages and bids.</p>
          </div>
          <button class="btn btn-secondary" onclick="markAllNotificationsRead()">Mark All Read</button>
        </div>
      </div>

      <div id="notifications-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸ””</div>
          <p>No notifications yet.</p>
        </div>
      </div>
    </section>

    <!-- Referrals Section -->
    <section id="referrals" class="section">
      <div class="page-header">
        <h1 class="page-title" style="display:flex;align-items:center;gap:12px;">ðŸŽ Refer a Friend</h1>
        <p class="page-subtitle">Share the love and earn $10 for every friend who completes their first service!</p>
      </div>

      <!-- Referral Stats -->
      <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));margin-bottom:32px;">
        <div class="stat-card">
          <div class="stat-icon gold">ðŸ’°</div>
          <div class="stat-value" id="referral-total-credits">$0</div>
          <div class="stat-label">Total Credits Earned</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">âœ…</div>
          <div class="stat-value" id="referral-completed-count">0</div>
          <div class="stat-label">Completed Referrals</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon blue">â³</div>
          <div class="stat-value" id="referral-pending-count">0</div>
          <div class="stat-label">Pending Referrals</div>
        </div>
      </div>

      <!-- Referral Code Card -->
      <div class="card" style="background:linear-gradient(135deg, rgba(212,168,85,0.15), rgba(74,200,140,0.08));border:1px solid rgba(212,168,85,0.3);">
        <div class="card-header" style="border-bottom:none;margin-bottom:0;">
          <h2 class="card-title" style="color:var(--accent-gold);">Your Referral Code</h2>
        </div>
        <div style="display:flex;flex-direction:column;gap:20px;">
          <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
            <div id="referral-code-display" style="font-size:2rem;font-weight:700;letter-spacing:0.15em;font-family:monospace;background:var(--bg-deep);padding:16px 32px;border-radius:12px;border:2px dashed var(--accent-gold);color:var(--accent-gold);">
              Loading...
            </div>
            <button class="btn btn-primary" onclick="copyReferralCode()" style="padding:14px 24px;">
              ðŸ“‹ Copy Code
            </button>
          </div>
          
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <button class="btn btn-secondary" onclick="copyReferralLink()" style="flex:1;min-width:140px;">
              ðŸ”— Copy Link
            </button>
            <button class="btn btn-secondary" onclick="shareReferralEmail()" style="flex:1;min-width:140px;">
              âœ‰ï¸ Share via Email
            </button>
            <button class="btn btn-secondary" onclick="shareReferralSMS()" style="flex:1;min-width:140px;">
              ðŸ’¬ Share via SMS
            </button>
          </div>
        </div>
      </div>

      <!-- How it Works -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <h2 class="card-title">How It Works</h2>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:24px;">
          <div style="text-align:center;padding:16px;">
            <div style="font-size:48px;margin-bottom:12px;">ðŸ“¤</div>
            <h3 style="font-size:1.1rem;margin-bottom:8px;">1. Share Your Code</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Send your unique referral code to friends and family who need car services.</p>
          </div>
          <div style="text-align:center;padding:16px;">
            <div style="font-size:48px;margin-bottom:12px;">ðŸ‘‹</div>
            <h3 style="font-size:1.1rem;margin-bottom:8px;">2. They Sign Up</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">Your friend creates an account using your code and gets a <strong style="color:var(--accent-gold);">$10 welcome bonus</strong>!</p>
          </div>
          <div style="text-align:center;padding:16px;">
            <div style="font-size:48px;margin-bottom:12px;">ðŸš—</div>
            <h3 style="font-size:1.1rem;margin-bottom:8px;">3. First Service</h3>
            <p style="color:var(--text-secondary);font-size:0.9rem;">When they complete their first paid service, you earn <strong style="color:var(--accent-gold);">$10 in credits</strong>!</p>
          </div>
        </div>
      </div>

      <!-- Referral List -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <h2 class="card-title">Your Referrals</h2>
        </div>
        <div id="referrals-loading" style="text-align:center;padding:40px;color:var(--text-muted);">
          Loading referrals...
        </div>
        <div id="referrals-empty" style="display:none;text-align:center;padding:60px 20px;">
          <div style="font-size:64px;margin-bottom:16px;opacity:0.5;">ðŸ‘¥</div>
          <h3 style="color:var(--text-secondary);margin-bottom:8px;">No referrals yet</h3>
          <p style="color:var(--text-muted);font-size:0.9rem;">Share your referral code with friends to start earning credits!</p>
        </div>
        <div id="referrals-list" style="display:none;flex-direction:column;gap:12px;"></div>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings" class="section">
      <div class="page-header">
        <h1 class="page-title">Settings</h1>
        <p class="page-subtitle">Manage your profile and preferences.</p>
      </div>

      <!-- Theme Settings -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">ðŸŽ¨ Appearance</h2>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:1.5rem;" id="settings-theme-icon-display">ðŸŒ™</span>
            <div>
              <div style="font-weight:600;" id="settings-theme-label">Dark Mode</div>
              <div style="font-size:0.85rem;color:var(--text-muted);">Switch between light and dark themes</div>
            </div>
          </div>
          <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
            <input type="checkbox" id="settings-theme-toggle" onchange="setThemeFromToggle(this.checked)">
            <span class="toggle-slider" style="position:relative;width:50px;height:26px;background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:13px;transition:all 0.3s;display:inline-block;"></span>
          </label>
        </div>
        <style>
          #settings-theme-toggle { display: none; }
          #settings-theme-toggle + .toggle-slider::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 18px;
            height: 18px;
            background: var(--text-muted);
            border-radius: 50%;
            transition: all 0.3s;
          }
          #settings-theme-toggle:checked + .toggle-slider {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
          }
          #settings-theme-toggle:checked + .toggle-slider::after {
            left: 27px;
            background: var(--bg-deep);
          }
        </style>
        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const toggle = document.getElementById('settings-theme-toggle');
            const label = document.getElementById('settings-theme-label');
            const iconDisplay = document.getElementById('settings-theme-icon-display');
            if (toggle) toggle.checked = currentTheme === 'light';
            if (label) label.textContent = currentTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
            if (iconDisplay) iconDisplay.textContent = currentTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
          });
        </script>
      </div>

      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">Profile Information</h2>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" id="settings-name" placeholder="Your full name">
          </div>
          <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input type="tel" class="form-input" id="settings-phone" placeholder="(555) 555-5555">
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ“ Service Location</h2>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">This helps providers in your area find your service requests.</p>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ZIP Code <span class="required">*</span></label>
            <input type="text" class="form-input" id="settings-zip" placeholder="e.g., 07003" maxlength="10" style="max-width:150px;">
          </div>
          <div class="form-group">
            <label class="form-label">City</label>
            <input type="text" class="form-input" id="settings-city" placeholder="City name">
          </div>
          <div class="form-group">
            <label class="form-label">State</label>
            <select class="form-select" id="settings-state">
              <option value="">Select State</option>
              <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option>
              <option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option>
              <option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option>
              <option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option>
              <option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option>
              <option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option>
              <option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option>
              <option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option>
              <option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option>
              <option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option>
              <option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option>
              <option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option>
              <option value="WI">Wisconsin</option><option value="WY">Wyoming</option><option value="DC">Washington DC</option>
            </select>
          </div>
        </div>
        <div id="location-status" style="margin-top:12px;display:none;"></div>
      </div>

      <!-- SMS Notifications -->
      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ“± SMS Notifications</h2>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Get text alerts for important updates.</p>
        </div>
        
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
            <input type="checkbox" id="sms-enabled" onchange="toggleSmsOptions()">
            <span style="font-weight:500;">Enable SMS notifications</span>
          </label>
          <p class="form-hint">Standard messaging rates may apply.</p>
        </div>

        <div id="sms-options" style="display:none;margin-top:16px;padding-top:16px;border-top:1px solid var(--border-subtle);">
          <p style="font-weight:500;margin-bottom:12px;">Notify me when:</p>
          <div style="display:grid;gap:10px;">
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
              <input type="checkbox" id="sms-bid-received" checked>
              <span>ðŸ’° I receive a new bid</span>
            </label>
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
              <input type="checkbox" id="sms-work-completed" checked>
              <span>âœ… Work is completed</span>
            </label>
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
              <input type="checkbox" id="sms-new-message">
              <span>ðŸ’¬ I receive a new message</span>
            </label>
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
              <input type="checkbox" id="sms-bidding-ending" checked>
              <span>â° Bidding window is ending soon</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Push Notifications -->
      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ”” Push Notifications</h2>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Get instant alerts on your device - even when you're not on the site.</p>
        </div>
        
        <div id="push-not-supported" style="display:none;padding:16px;background:rgba(239,95,95,0.1);border:1px solid rgba(239,95,95,0.3);border-radius:var(--radius-md);">
          <p style="color:var(--accent-red);margin:0;font-size:0.9rem;">Your browser doesn't support push notifications.</p>
        </div>
        
        <div id="push-content">
          <div id="push-status-display" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <span id="push-status-icon" style="font-size:1.5rem;">ðŸ”•</span>
            <div style="flex:1;">
              <div id="push-status-text" style="font-weight:600;margin-bottom:2px;">Push Notifications Disabled</div>
              <div id="push-status-desc" style="font-size:0.85rem;color:var(--text-muted);">Enable to receive instant alerts for bids, vehicle updates, and more.</div>
            </div>
            <span id="push-status-badge" class="package-status" style="background:rgba(239,95,95,0.15);color:var(--accent-red);">Off</span>
          </div>
          
          <div id="push-enable-section">
            <button class="btn btn-primary" id="push-enable-btn" onclick="enablePushNotifications()">
              ðŸ”” Enable Push Notifications
            </button>
          </div>
          
          <div id="push-enabled-section" style="display:none;">
            <div style="display:flex;align-items:center;gap:16px;padding:16px;background:var(--accent-green-soft);border:1px solid rgba(74,200,140,0.3);border-radius:var(--radius-md);margin-bottom:20px;">
              <span style="font-size:1.5rem;">âœ…</span>
              <div style="flex:1;">
                <div style="font-weight:600;color:var(--accent-green);margin-bottom:2px;">Push Notifications Active</div>
                <div style="font-size:0.9rem;color:var(--text-secondary);">You'll receive instant alerts on this device.</div>
              </div>
            </div>
            
            <div style="display:grid;gap:12px;">
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:12px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
                <input type="checkbox" id="push-bid-alerts" checked>
                <div>
                  <span style="font-weight:500;">ðŸ’° Bid Alerts</span>
                  <p style="font-size:0.82rem;color:var(--text-muted);margin:2px 0 0;">Get notified when providers submit bids on your requests</p>
                </div>
              </label>
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:12px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
                <input type="checkbox" id="push-vehicle-status" checked>
                <div>
                  <span style="font-weight:500;">ðŸš— Vehicle Status</span>
                  <p style="font-size:0.82rem;color:var(--text-muted);margin:2px 0 0;">Updates when your vehicle is picked up, in service, or ready</p>
                </div>
              </label>
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:12px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
                <input type="checkbox" id="push-dream-car" checked>
                <div>
                  <span style="font-weight:500;">ðŸš˜ Dream Car Finder</span>
                  <p style="font-size:0.82rem;color:var(--text-muted);margin:2px 0 0;">Alerts when we find vehicles matching your search criteria</p>
                </div>
              </label>
              <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:12px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
                <input type="checkbox" id="push-maintenance" checked>
                <div>
                  <span style="font-weight:500;">ðŸ”§ Maintenance Reminders</span>
                  <p style="font-size:0.82rem;color:var(--text-muted);margin:2px 0 0;">Get reminded when service is due for your vehicles</p>
                </div>
              </label>
            </div>
            
            <button class="btn btn-secondary" style="margin-top:16px;" onclick="disablePushNotifications()">
              ðŸ”• Disable Push Notifications
            </button>
          </div>
        </div>
      </div>

      <!-- Notification Preferences -->
      <div class="card" style="margin-top:20px;">
        <div class="card-header" style="flex-wrap:wrap;gap:12px;">
          <div>
            <h2 class="card-title">ðŸ“§ Email & SMS Preferences</h2>
            <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Control which notifications you receive via email and SMS.</p>
          </div>
          <div id="notif-prefs-status" style="display:none;padding:6px 12px;border-radius:100px;font-size:0.8rem;font-weight:500;"></div>
        </div>
        
        <div style="display:flex;flex-direction:column;gap:20px;">
          <!-- Service Follow-ups -->
          <div class="notif-pref-group" style="padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
              <div>
                <h4 style="font-weight:600;margin-bottom:4px;">ðŸ“§ Service Follow-ups</h4>
                <p style="font-size:0.85rem;color:var(--text-muted);">Feedback requests after your vehicle is serviced</p>
              </div>
            </div>
            <div style="display:flex;gap:20px;flex-wrap:wrap;">
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-followup-email" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">Email</span>
              </label>
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-followup-sms" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">SMS</span>
              </label>
            </div>
          </div>

          <!-- Maintenance Reminders -->
          <div class="notif-pref-group" style="padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
              <div>
                <h4 style="font-weight:600;margin-bottom:4px;">ðŸ”§ Maintenance Reminders</h4>
                <p style="font-size:0.85rem;color:var(--text-muted);">Reminders when service is due (oil changes, tire rotations, etc.)</p>
              </div>
            </div>
            <div style="display:flex;gap:20px;flex-wrap:wrap;">
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-maintenance-email" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">Email</span>
              </label>
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-maintenance-sms" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">SMS</span>
              </label>
            </div>
          </div>

          <!-- Urgent Updates -->
          <div class="notif-pref-group" style="padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
              <div>
                <h4 style="font-weight:600;margin-bottom:4px;">ðŸš¨ Urgent Updates</h4>
                <p style="font-size:0.85rem;color:var(--text-muted);">Critical safety alerts and important service notifications</p>
              </div>
            </div>
            <div style="display:flex;gap:20px;flex-wrap:wrap;">
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-urgent-email" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">Email</span>
              </label>
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-urgent-sms" checked>
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">SMS</span>
              </label>
            </div>
          </div>

          <!-- Marketing & Promotions -->
          <div class="notif-pref-group" style="padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
              <div>
                <h4 style="font-weight:600;margin-bottom:4px;">ðŸ“¢ Marketing & Promotions</h4>
                <p style="font-size:0.85rem;color:var(--text-muted);">Special offers, discounts, and promotional updates</p>
              </div>
            </div>
            <div style="display:flex;gap:20px;flex-wrap:wrap;">
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-marketing-email">
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">Email</span>
              </label>
              <label class="toggle-switch" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                <input type="checkbox" id="pref-marketing-sms">
                <span class="toggle-slider"></span>
                <span style="font-size:0.9rem;">SMS</span>
              </label>
            </div>
          </div>
        </div>

        <div style="margin-top:20px;display:flex;gap:12px;align-items:center;">
          <button class="btn btn-primary" onclick="saveNotificationPreferences()">Save Notification Preferences</button>
          <span id="notif-save-status" style="display:none;font-size:0.85rem;"></span>
        </div>
      </div>

      <!-- 2FA Security Settings -->
      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ” Two-Factor Authentication (2FA)</h2>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Add an extra layer of security to your account.</p>
        </div>
        
        <div id="2fa-loading" style="text-align:center;padding:24px;display:none;">
          <div style="width:32px;height:32px;border:3px solid var(--border-subtle);border-top-color:var(--accent-blue);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px;"></div>
          <p style="color:var(--text-muted);font-size:0.9rem;">Loading 2FA status...</p>
        </div>
        
        <div id="2fa-content">
          <div id="2fa-status-display" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <span id="2fa-status-icon" style="font-size:1.5rem;">ðŸ”“</span>
            <div style="flex:1;">
              <div id="2fa-status-text" style="font-weight:600;margin-bottom:2px;">2FA is Disabled</div>
              <div id="2fa-status-desc" style="font-size:0.85rem;color:var(--text-muted);">Your account is protected by password only.</div>
            </div>
            <span id="2fa-status-badge" class="package-status" style="background:rgba(239,95,95,0.15);color:var(--accent-red);">Disabled</span>
          </div>
          
          <!-- Enable 2FA Section (shown when disabled) -->
          <div id="2fa-enable-section">
            <p style="color:var(--text-secondary);margin-bottom:16px;font-size:0.9rem;line-height:1.6;">
              Enable 2FA to receive a verification code via SMS each time you log in. This helps protect your account even if your password is compromised.
            </p>
            
            <div class="form-group">
              <label class="form-label">Phone Number for 2FA</label>
              <div style="display:flex;gap:12px;align-items:flex-start;">
                <input type="tel" class="form-input" id="2fa-phone-input" placeholder="(555) 555-5555" style="max-width:200px;" oninput="format2FAPhoneInput(this)">
                <button class="btn btn-primary" id="2fa-enable-btn" onclick="initiate2FAEnable()">
                  ðŸ”’ Enable 2FA
                </button>
              </div>
              <p class="form-hint">We'll send a verification code to this number.</p>
            </div>
          </div>
          
          <!-- Disable 2FA Section (shown when enabled) -->
          <div id="2fa-disable-section" style="display:none;">
            <div style="display:flex;align-items:center;gap:16px;padding:16px;background:var(--accent-green-soft);border:1px solid rgba(74,200,140,0.3);border-radius:var(--radius-md);margin-bottom:20px;">
              <span style="font-size:1.5rem;">âœ…</span>
              <div style="flex:1;">
                <div style="font-weight:600;color:var(--accent-green);margin-bottom:2px;">2FA is Active</div>
                <div style="font-size:0.9rem;color:var(--text-secondary);">Verification codes are sent to: <strong id="2fa-masked-phone">***-***-1234</strong></div>
              </div>
            </div>
            
            <button class="btn btn-danger" onclick="open2FADisableModal()">
              ðŸ”“ Disable 2FA
            </button>
            <p style="font-size:0.82rem;color:var(--text-muted);margin-top:12px;">
              Disabling 2FA will make your account less secure. You'll only need your password to log in.
            </p>
          </div>
        </div>
      </div>

      <!-- Login Activity -->
      <div class="card" style="margin-top:20px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ“‹ Login Activity</h2>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-top:4px;">Review your recent login history for security.</p>
        </div>
        
        <div id="login-activity-alert" style="display:none;margin-bottom:20px;padding:16px;background:rgba(239,95,95,0.1);border:1px solid rgba(239,95,95,0.3);border-radius:var(--radius-md);">
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:1.5rem;">âš ï¸</span>
            <div style="flex:1;">
              <div style="font-weight:600;color:var(--accent-red);margin-bottom:2px;">Failed Login Attempts Detected</div>
              <div style="font-size:0.9rem;color:var(--text-secondary);" id="login-activity-alert-text">There were recent failed login attempts on your account. Review them below and consider changing your password if you don't recognize them.</div>
            </div>
          </div>
        </div>
        
        <div id="login-activity-loading" style="text-align:center;padding:24px;">
          <div style="width:32px;height:32px;border:3px solid var(--border-subtle);border-top-color:var(--accent-blue);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px;"></div>
          <p style="color:var(--text-muted);font-size:0.9rem;">Loading login activity...</p>
        </div>
        
        <div id="login-activity-content" style="display:none;">
          <div id="login-activity-empty" style="display:none;text-align:center;padding:32px;color:var(--text-muted);">
            <span style="font-size:48px;display:block;margin-bottom:12px;">ðŸ“‹</span>
            <p>No login activity recorded yet.</p>
          </div>
          
          <div style="overflow-x:auto;">
            <table id="login-activity-table" style="width:100%;border-collapse:collapse;font-size:0.88rem;">
              <thead>
                <tr style="border-bottom:1px solid var(--border-subtle);">
                  <th style="text-align:left;padding:12px 8px;color:var(--text-muted);font-weight:500;">Date/Time</th>
                  <th style="text-align:left;padding:12px 8px;color:var(--text-muted);font-weight:500;">Device</th>
                  <th style="text-align:left;padding:12px 8px;color:var(--text-muted);font-weight:500;">Browser</th>
                  <th style="text-align:left;padding:12px 8px;color:var(--text-muted);font-weight:500;">IP Address</th>
                  <th style="text-align:left;padding:12px 8px;color:var(--text-muted);font-weight:500;">Status</th>
                  <th style="text-align:right;padding:12px 8px;color:var(--text-muted);font-weight:500;">Actions</th>
                </tr>
              </thead>
              <tbody id="login-activity-tbody">
              </tbody>
            </table>
          </div>
          
          <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border-subtle);">
            <button class="btn btn-secondary btn-sm" onclick="loadLoginActivity()">ðŸ”„ Refresh</button>
            <span style="font-size:0.82rem;color:var(--text-muted);margin-left:12px;">Showing last 30 days (up to 50 entries)</span>
          </div>
        </div>
      </div>

      <div style="margin-top:24px;">
        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
      </div>
    </section>

    <!-- Learn Section -->
    <section id="learn" class="section">
      <div class="page-header">
        <h1 class="page-title">ðŸŽ“ My Car Concierge Academy</h1>
        <p class="page-subtitle">Learn about your vehicle in plain English</p>
      </div>

      <div class="learn-ai-cta" style="margin-bottom:24px;padding:20px 24px;background:linear-gradient(135deg,rgba(212,168,85,0.15),rgba(212,168,85,0.05));border:1px solid rgba(212,168,85,0.3);border-radius:var(--radius-lg);display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
        <div style="flex:1;min-width:200px;">
          <h4 style="margin:0 0 6px;font-size:1.1rem;color:var(--text-primary);display:flex;align-items:center;gap:8px;">
            <span>ðŸ¤–</span> Got car questions?
          </h4>
          <p style="margin:0;font-size:0.9rem;color:var(--text-secondary);line-height:1.5;">
            Our AI tutor explains car concepts in plain English - no question is too basic!
          </p>
        </div>
        <button class="btn btn-primary" onclick="openCarAcademyAI()" style="padding:12px 24px;font-size:0.95rem;white-space:nowrap;">
          ðŸŽ“ Ask our AI about cars
        </button>
      </div>

      <div id="learn-content">
        <div class="learn-categories-grid" id="learn-categories">
          <div class="learn-category-card" onclick="showLearnCategory('maintenance101')">
            <span class="learn-category-icon">ðŸ”§</span>
            <div class="learn-category-title">Maintenance 101</div>
            <div class="learn-category-desc">Understanding routine maintenance</div>
            <span class="learn-category-count">6 articles</span>
          </div>
          <div class="learn-category-card" onclick="showLearnCategory('repairs')">
            <span class="learn-category-icon">ðŸ”©</span>
            <div class="learn-category-title">Understanding Repairs</div>
            <div class="learn-category-desc">What mechanics mean when they say...</div>
            <span class="learn-category-count">6 articles</span>
          </div>
          <div class="learn-category-card" onclick="showLearnCategory('warningSigns')">
            <span class="learn-category-icon">âš ï¸</span>
            <div class="learn-category-title">Warning Signs</div>
            <div class="learn-category-desc">Sounds, smells, and symptoms to watch for</div>
            <span class="learn-category-count">6 articles</span>
          </div>
          <div class="learn-category-card" onclick="showLearnCategory('savingTips')">
            <span class="learn-category-icon">ðŸ’°</span>
            <div class="learn-category-title">Money-Saving Tips</div>
            <div class="learn-category-desc">How to save on car care</div>
            <span class="learn-category-count">6 articles</span>
          </div>
          <div class="learn-category-card" onclick="showLearnCategory('rideshare')">
            <span class="learn-category-icon">ðŸš—</span>
            <div class="learn-category-title">Rideshare & High-Mileage Drivers</div>
            <div class="learn-category-desc">Tips for drivers who put serious miles on their vehicles</div>
            <span class="learn-category-count">6 articles</span>
          </div>
          <div class="learn-category-card" onclick="showLearnCategory('commercial')">
            <span class="learn-category-icon">ðŸš</span>
            <div class="learn-category-title">Commercial & Fleet Vehicles</div>
            <div class="learn-category-desc">Maintenance for vans, buses, and commercial transport</div>
            <span class="learn-category-count">6 articles</span>
          </div>
        </div>

        <div id="learn-articles-view" style="display:none;"></div>

        <div class="learn-glossary-section">
          <div class="learn-glossary-header">
            <h2 style="font-size:1.3rem;font-weight:600;display:flex;align-items:center;gap:10px;">
              <span>ðŸ“–</span> Automotive Glossary
            </h2>
            <div class="learn-glossary-search">
              <span>ðŸ”</span>
              <input type="text" id="glossary-search" placeholder="Search terms..." oninput="filterGlossary(this.value)">
            </div>
          </div>
          <div class="learn-glossary-alphabet" id="glossary-alphabet"></div>
          <div class="learn-glossary-list" id="glossary-list"></div>
        </div>
      </div>
    </section>

    <!-- QR Check-In Section -->
    <section id="qr-checkin" class="section">
      <div class="page-header">
        <h1 class="page-title" style="color:var(--accent-blue);">ðŸ“± My Check-In QR Code</h1>
        <p class="page-subtitle">Skip the phone verification - just scan and go at any partner location.</p>
      </div>

      <div class="card" style="max-width:500px;">
        <div style="text-align:center;padding:24px 16px;">
          <div id="qr-code-container" style="display:inline-block;background:#fff;padding:16px;border-radius:var(--radius-lg);margin-bottom:20px;">
            <canvas id="qr-code-canvas" width="200" height="200"></canvas>
          </div>
          
          <div id="qr-loading" style="display:none;padding:40px;">
            <div style="font-size:2rem;margin-bottom:12px;">â³</div>
            <p style="color:var(--text-muted);">Generating your QR code...</p>
          </div>
          
          <div id="qr-error" style="display:none;padding:20px;background:var(--accent-red-soft);border:1px solid var(--accent-red);border-radius:var(--radius-md);margin-bottom:16px;">
            <p style="color:var(--accent-red);margin:0;">Failed to generate QR code. Please try again.</p>
          </div>

          <p style="color:var(--text-secondary);font-size:0.95rem;margin-bottom:24px;line-height:1.6;">
            Show this code at any partner location for <strong>instant check-in</strong>.<br>
            No phone number or OTP verification required.
          </p>

          <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="downloadQrCode()" style="padding:12px 24px;">
              ðŸ“¥ Download QR Code
            </button>
            <button class="btn btn-secondary" onclick="showQrFullscreen()" style="padding:12px 24px;">
              ðŸ“º Full Screen
            </button>
          </div>

          <div style="margin-top:24px;padding:16px;background:var(--bg-elevated);border-radius:var(--radius-md);text-align:left;">
            <h4 style="margin:0 0 12px;font-size:0.95rem;color:var(--accent-gold);">ðŸ’¡ How it works:</h4>
            <ol style="margin:0;padding-left:20px;color:var(--text-secondary);font-size:0.9rem;line-height:1.8;">
              <li>Show this QR code to the service provider</li>
              <li>They scan it with their POS system</li>
              <li>Your account is instantly verified</li>
              <li>Proceed directly to vehicle selection</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <!-- QR Fullscreen Modal -->
    <div id="qr-fullscreen-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:2000;flex-direction:column;align-items:center;justify-content:center;">
      <button onclick="closeQrFullscreen()" style="position:absolute;top:20px;right:20px;background:transparent;border:none;color:#fff;font-size:2rem;cursor:pointer;padding:10px;">âœ•</button>
      <div style="background:#fff;padding:32px;border-radius:16px;text-align:center;">
        <canvas id="qr-fullscreen-canvas" width="300" height="300"></canvas>
        <p style="margin-top:16px;color:#333;font-weight:600;">My Car Concierge Check-In</p>
      </div>
      <p style="color:#fff;margin-top:24px;font-size:1.1rem;">Scan this code for instant check-in</p>
    </div>

    <!-- Fuel Tracker Section -->
    <section id="fuel-tracker" class="section">
      <div class="page-header">
        <h1 class="page-title">â›½ Fuel Tracker</h1>
        <p class="page-subtitle">Track your fuel expenses and monitor your vehicle's efficiency.</p>
      </div>

      <div class="stats-grid" id="fuel-stats-grid">
        <div class="stat-card">
          <div class="stat-icon gold">â›½</div>
          <div class="stat-value" id="fuel-avg-mpg">--</div>
          <div class="stat-label">Avg MPG</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon blue">ðŸ’µ</div>
          <div class="stat-value" id="fuel-monthly-cost">$0</div>
          <div class="stat-label">This Month</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">ðŸ“ˆ</div>
          <div class="stat-value" id="fuel-cost-per-mile">--</div>
          <div class="stat-label">Cost/Mile</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon orange">ðŸ›¢ï¸</div>
          <div class="stat-value" id="fuel-total-gallons">0</div>
          <div class="stat-label">Total Gallons</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Recent Fill-Ups</h2>
          <div style="display:flex;gap:12px;align-items:center;">
            <select id="fuel-vehicle-filter" onchange="loadFuelLogs()" style="padding:8px 16px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-md);color:var(--text-primary);font-size:0.88rem;">
              <option value="">All Vehicles</option>
            </select>
            <button class="btn btn-primary" onclick="openFuelLogModal()">+ Add Fill-Up</button>
          </div>
        </div>

        <div id="fuel-logs-list">
          <div class="empty-state" style="padding:40px;">
            <div class="empty-state-icon">â›½</div>
            <p>No fuel logs yet.</p>
            <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Start tracking your fuel expenses to see stats and trends.</p>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ“Š MPG Trend</h2>
        </div>
        <div id="fuel-mpg-chart-container" style="height:250px;position:relative;">
          <canvas id="fuel-mpg-chart"></canvas>
        </div>
      </div>

      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <h2 class="card-title">ðŸ’° Spending by Month</h2>
        </div>
        <div id="fuel-spending-chart-container" style="height:250px;position:relative;">
          <canvas id="fuel-spending-chart"></canvas>
        </div>
      </div>
    </section>

    <!-- Add/Edit Fuel Log Modal -->
    <div class="modal-backdrop" id="fuel-log-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title" id="fuel-log-modal-title">Add Fill-Up</h3>
          <button class="modal-close" onclick="closeFuelLogModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <form id="fuel-log-form" onsubmit="saveFuelLog(event)">
            <input type="hidden" id="fuel-log-id">
            
            <div class="form-group">
              <label class="form-label">Vehicle *</label>
              <select id="fuel-log-vehicle" class="form-select" required>
                <option value="">Select a vehicle</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Date *</label>
                <input type="date" id="fuel-log-date" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Odometer (miles) *</label>
                <input type="number" id="fuel-log-odometer" class="form-input" placeholder="e.g. 45000" required min="0">
              </div>
            </div>

            <div class="form-row three">
              <div class="form-group">
                <label class="form-label">Gallons *</label>
                <input type="number" id="fuel-log-gallons" class="form-input" placeholder="e.g. 12.5" required step="0.001" min="0">
              </div>
              <div class="form-group">
                <label class="form-label">Price/Gallon *</label>
                <input type="number" id="fuel-log-price" class="form-input" placeholder="e.g. 3.45" required step="0.001" min="0">
              </div>
              <div class="form-group">
                <label class="form-label">Total Cost</label>
                <input type="number" id="fuel-log-total" class="form-input" placeholder="Auto-calculated" step="0.01" min="0">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Fuel Type</label>
              <select id="fuel-log-type" class="form-select">
                <option value="regular">Regular</option>
                <option value="mid-grade">Mid-Grade</option>
                <option value="premium">Premium</option>
                <option value="diesel">Diesel</option>
                <option value="electric">Electric</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Station Name</label>
              <input type="text" id="fuel-log-station" class="form-input" placeholder="e.g. Shell, Costco, BP">
            </div>

            <div class="form-group">
              <label class="form-label">Notes</label>
              <textarea id="fuel-log-notes" class="form-textarea" rows="2" placeholder="Any additional notes..."></textarea>
            </div>

            <div class="form-group" style="display:flex;align-items:center;gap:12px;">
              <input type="checkbox" id="fuel-log-full-tank" checked style="width:20px;height:20px;accent-color:var(--accent-gold);">
              <label for="fuel-log-full-tank" style="cursor:pointer;">Filled to full tank (for accurate MPG calculation)</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeFuelLogModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" form="fuel-log-form">Save Fill-Up</button>
        </div>
      </div>
    </div>

    <!-- Insurance Documents Section -->
    <section id="insurance" class="section">
      <div class="page-header">
        <h1 class="page-title">ðŸ“‹ Insurance Documents</h1>
        <p class="page-subtitle">Store and manage your vehicle insurance cards and policy documents.</p>
      </div>

      <div class="stats-grid" id="insurance-stats-grid">
        <div class="stat-card">
          <div class="stat-icon blue">ðŸ“„</div>
          <div class="stat-value" id="insurance-total-docs">0</div>
          <div class="stat-label">Total Documents</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">âœ“</div>
          <div class="stat-value" id="insurance-active-count">0</div>
          <div class="stat-label">Active Policies</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon orange">â³</div>
          <div class="stat-value" id="insurance-expiring-count">0</div>
          <div class="stat-label">Expiring Soon</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:rgba(239,95,95,0.15);">âš ï¸</div>
          <div class="stat-value" id="insurance-expired-count" style="color:var(--accent-red);">0</div>
          <div class="stat-label">Expired</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Your Insurance Documents</h2>
          <div style="display:flex;gap:12px;align-items:center;">
            <select id="insurance-vehicle-filter" onchange="loadInsuranceDocuments()" style="padding:8px 16px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-md);color:var(--text-primary);font-size:0.88rem;">
              <option value="">All Vehicles</option>
            </select>
            <button class="btn btn-primary" onclick="openInsuranceDocumentModal()">+ Add Document</button>
          </div>
        </div>

        <div id="insurance-documents-list">
          <div class="empty-state" style="padding:40px;">
            <div class="empty-state-icon">ðŸ“‹</div>
            <p>No insurance documents yet.</p>
            <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Upload your insurance cards and policy documents to keep them handy.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Add Insurance Document Modal -->
    <div class="modal-backdrop" id="insurance-document-modal">
      <div class="modal" style="max-width:560px;">
        <div class="modal-header">
          <h3 class="modal-title">Add Insurance Document</h3>
          <button class="modal-close" onclick="closeInsuranceDocumentModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <form id="insurance-document-form" onsubmit="saveInsuranceDocument(event)">
            <div class="form-group">
              <label class="form-label">Vehicle *</label>
              <select id="insurance-doc-vehicle" class="form-select" required>
                <option value="">Select a vehicle</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Document Type *</label>
              <select id="insurance-doc-type" class="form-select" required>
                <option value="insurance_card">Insurance Card</option>
                <option value="policy_declaration">Policy Declaration</option>
                <option value="proof_of_insurance">Proof of Insurance</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Insurance Provider *</label>
              <input type="text" id="insurance-doc-provider" class="form-input" placeholder="e.g. State Farm, Geico, Progressive" required>
            </div>

            <div class="form-group">
              <label class="form-label">Policy Number</label>
              <input type="text" id="insurance-doc-policy-number" class="form-input" placeholder="e.g. POL-123456789">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Coverage Start Date</label>
                <input type="date" id="insurance-doc-start-date" class="form-input">
              </div>
              <div class="form-group">
                <label class="form-label">Coverage End Date</label>
                <input type="date" id="insurance-doc-end-date" class="form-input">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Upload Document (PDF, JPG, PNG)</label>
              <div id="insurance-file-dropzone" style="border:2px dashed var(--border-subtle);border-radius:var(--radius-md);padding:32px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(--bg-input);" onclick="document.getElementById('insurance-file-input').click()">
                <div style="font-size:2.5rem;margin-bottom:12px;">ðŸ“¤</div>
                <p style="color:var(--text-secondary);margin:0;">Drag & drop a file here or click to browse</p>
                <p style="font-size:0.78rem;color:var(--text-muted);margin-top:8px;">Supported formats: PDF, JPG, PNG (Max 10MB)</p>
                <input type="file" id="insurance-file-input" accept=".pdf,.jpg,.jpeg,.png" style="display:none;" onchange="handleInsuranceFileSelect(event)">
              </div>
              <div id="insurance-file-preview" style="display:none;margin-top:12px;padding:12px;background:var(--bg-elevated);border-radius:var(--radius-md);display:flex;align-items:center;gap:12px;">
                <span style="font-size:1.5rem;">ðŸ“„</span>
                <div style="flex:1;">
                  <p id="insurance-file-name" style="margin:0;font-weight:500;"></p>
                  <p id="insurance-file-size" style="margin:2px 0 0;font-size:0.78rem;color:var(--text-muted);"></p>
                </div>
                <button type="button" class="btn btn-secondary btn-sm" onclick="clearInsuranceFile()">Remove</button>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeInsuranceDocumentModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" form="insurance-document-form" id="insurance-submit-btn">Save Document</button>
        </div>
      </div>
    </div>

    <!-- Emergency Roadside Section -->
    <section id="emergency" class="section">
      <div class="page-header">
        <h1 class="page-title" style="color:var(--accent-red);">ðŸ†˜ Emergency Roadside Assistance</h1>
        <p class="page-subtitle">Get immediate help when you're stranded.</p>
      </div>

      <!-- Active Emergency Status (shown when there's an active request) -->
      <div id="emergency-active-status" style="display:none;margin-bottom:24px;">
        <div class="card" style="background:linear-gradient(135deg, rgba(239,95,95,0.15), rgba(255,68,68,0.1));border:2px solid rgba(239,95,95,0.4);">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
            <span style="font-size:2.5rem;animation:pulse 2s infinite;">ðŸš¨</span>
            <div>
              <h3 style="margin:0;color:var(--accent-red);">Active Emergency Request</h3>
              <p id="emergency-active-type" style="margin:4px 0 0;color:var(--text-secondary);"></p>
            </div>
          </div>
          <div id="emergency-status-timeline" class="emergency-timeline"></div>
          <div id="emergency-provider-info" style="display:none;margin-top:16px;padding:16px;background:var(--bg-elevated);border-radius:var(--radius-md);"></div>
          <button class="btn btn-secondary" onclick="cancelActiveEmergency()" style="margin-top:16px;">Cancel Request</button>
        </div>
      </div>

      <!-- New Emergency Request Form -->
      <div id="emergency-request-form">
        <div class="card" style="border:2px solid rgba(239,95,95,0.3);">
          <div class="card-header">
            <h2 class="card-title" style="color:var(--accent-red);">Request Emergency Help</h2>
            <p style="color:var(--text-secondary);margin-top:4px;">Describe your situation and we'll dispatch nearby providers.</p>
          </div>

          <div class="form-group">
            <label class="form-label">What's your emergency? *</label>
            <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:12px;margin-top:8px;">
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="flat_tire" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">ðŸ›ž</span>
                <span style="font-size:0.85rem;text-align:center;">Flat Tire</span>
              </label>
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="dead_battery" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">ðŸ”‹</span>
                <span style="font-size:0.85rem;text-align:center;">Dead Battery</span>
              </label>
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="lockout" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">ðŸ”‘</span>
                <span style="font-size:0.85rem;text-align:center;">Locked Out</span>
              </label>
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="tow_needed" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">ðŸš›</span>
                <span style="font-size:0.85rem;text-align:center;">Need a Tow</span>
              </label>
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="fuel_delivery" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">â›½</span>
                <span style="font-size:0.85rem;text-align:center;">Out of Fuel</span>
              </label>
              <label class="emergency-type-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-elevated);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="emergency-type" value="other" style="display:none;">
                <span style="font-size:2rem;margin-bottom:8px;">â“</span>
                <span style="font-size:0.85rem;text-align:center;">Other Issue</span>
              </label>
            </div>
          </div>

          <div class="form-group" style="margin-top:20px;">
            <label class="form-label">Select Vehicle</label>
            <select class="form-select" id="emergency-vehicle">
              <option value="">Loading vehicles...</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Your Location</label>
            <div style="display:flex;gap:12px;align-items:center;">
              <input type="text" class="form-input" id="emergency-address" placeholder="Getting your location..." readonly style="flex:1;">
              <button class="btn btn-secondary" onclick="refreshEmergencyLocation()" style="white-space:nowrap;">ðŸ“ Refresh</button>
            </div>
            <input type="hidden" id="emergency-lat">
            <input type="hidden" id="emergency-lng">
          </div>

          <div class="form-group">
            <label class="form-label">Additional Details (optional)</label>
            <textarea class="form-input" id="emergency-description" rows="3" placeholder="Describe your situation..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Photos (optional)</label>
            <div class="emergency-photos" id="emergency-photo-preview"></div>
            <input type="file" id="emergency-photos" accept="image/*" multiple style="display:none;" onchange="previewEmergencyPhotos(this)">
            <button class="btn btn-secondary" onclick="document.getElementById('emergency-photos').click()" style="margin-top:8px;">ðŸ“· Add Photos</button>
          </div>

          <button class="btn" onclick="submitEmergencyRequest()" style="width:100%;margin-top:20px;padding:18px;font-size:1.1rem;background:linear-gradient(135deg, #ef5f5f, #ff4444);color:white;font-weight:600;">
            ðŸ†˜ Request Emergency Help
          </button>
        </div>
      </div>

      <!-- Past Emergencies -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <h2 class="card-title">Past Emergency Requests</h2>
        </div>
        <div id="emergency-history-list">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸ†˜</div>
            <p>No emergency requests yet.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Destination Services Section -->
    <section id="destination-services" class="section">
      <div class="page-header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
          <div>
            <h1 class="page-title" style="color:var(--accent-blue);">ðŸš— Destination Services</h1>
            <p class="page-subtitle">Let a vetted driver take your car where it needs to go.</p>
          </div>
          <button class="btn btn-primary" onclick="openDestinationBookingModal()" style="padding:12px 24px;">+ Book Service</button>
        </div>
      </div>

      <!-- What Are Destination Services Info Card -->
      <div class="card" style="background:linear-gradient(135deg, rgba(74,124,255,0.08), rgba(212,168,85,0.06));border:1px solid rgba(74,124,255,0.2);margin-bottom:24px;">
        <h3 style="margin:0 0 12px;color:var(--accent-blue);">How It Works</h3>
        <p style="color:var(--text-secondary);margin:0 0 16px;line-height:1.6;">
          Need your car somewhere but can't drive it yourself? A verified provider will pick up your vehicle, drive it to the destination, and return it when done. <strong>You stay home while your car gets where it needs to go.</strong>
        </p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;">
          <div style="text-align:center;padding:12px;background:var(--bg-card);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="font-size:1.8rem;margin-bottom:4px;">âœˆï¸</div>
            <strong style="font-size:0.85rem;">Airport</strong>
            <p style="font-size:0.75rem;color:var(--text-muted);margin:4px 0 0;">Pickup or dropoff</p>
          </div>
          <div style="text-align:center;padding:12px;background:var(--bg-card);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="font-size:1.8rem;margin-bottom:4px;">ðŸ¢</div>
            <strong style="font-size:0.85rem;">Dealership</strong>
            <p style="font-size:0.75rem;color:var(--text-muted);margin:4px 0 0;">Warranty & recalls</p>
          </div>
          <div style="text-align:center;padding:12px;background:var(--bg-card);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="font-size:1.8rem;margin-bottom:4px;">âœ¨</div>
            <strong style="font-size:0.85rem;">Detailing</strong>
            <p style="font-size:0.75rem;color:var(--text-muted);margin:4px 0 0;">Full cleaning service</p>
          </div>
          <div style="text-align:center;padding:12px;background:var(--bg-card);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
            <div style="font-size:1.8rem;margin-bottom:4px;">ðŸ”‘</div>
            <strong style="font-size:0.85rem;">Valet</strong>
            <p style="font-size:0.75rem;color:var(--text-muted);margin:4px 0 0;">Any service pickup</p>
          </div>
        </div>
      </div>

      <div class="tabs" id="destination-tabs">
        <div class="tab active" data-dest-filter="active">Active</div>
        <div class="tab" data-dest-filter="pending">Pending</div>
        <div class="tab" data-dest-filter="completed">Completed</div>
        <div class="tab" data-dest-filter="all">All</div>
      </div>

      <div id="destination-services-list" class="packages-list">
        <div class="empty-state">
          <div class="empty-state-icon">ðŸš—</div>
          <p>No destination services yet.</p>
          <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Book airport runs, dealership trips, and more!</p>
          <button class="btn btn-primary" onclick="openDestinationBookingModal()" style="margin-top:16px;">+ Book Your First Service</button>
        </div>
      </div>
    </section>

    <!-- Household Section -->
    <section id="household" class="section">
      <div class="page-header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
          <div>
            <h1 class="page-title">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Household</h1>
            <p class="page-subtitle">Manage your family members and share vehicles.</p>
          </div>
        </div>
      </div>

      <!-- Pending Invitations Banner -->
      <div id="household-pending-invitations-banner" style="display:none;margin-bottom:24px;"></div>

      <!-- No Household - Create Card -->
      <div id="household-no-household" style="display:none;">
        <div class="card" style="text-align:center;padding:48px 32px;">
          <div style="font-size:64px;margin-bottom:20px;">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦</div>
          <h2 style="font-size:1.5rem;margin-bottom:12px;">Create Your Household</h2>
          <p style="color:var(--text-secondary);max-width:500px;margin:0 auto 24px;line-height:1.6;">
            Create a household to share vehicles with family members. Everyone in your household can view shared vehicles, request services, and stay informed about maintenance.
          </p>
          <div style="max-width:400px;margin:0 auto;">
            <div class="form-group">
              <input type="text" class="form-input" id="create-household-name" placeholder="e.g., Smith Family" style="text-align:center;font-size:1.1rem;">
            </div>
            <button class="btn btn-primary" onclick="createNewHousehold()" style="width:100%;padding:14px 28px;font-size:1rem;">
              Create Household
            </button>
          </div>
          <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border-subtle);">
            <h4 style="margin-bottom:12px;color:var(--accent-gold);">âœ¨ Benefits of Household Sharing</h4>
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;text-align:left;max-width:600px;margin:0 auto;">
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-blue);">ðŸš— Share Vehicles</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Family members can view and request services for shared vehicles.</p>
              </div>
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-green);">ðŸ‘€ Stay Informed</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Everyone sees service history and upcoming maintenance.</p>
              </div>
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-gold);">ðŸ”’ Control Access</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Set permissions and spending limits for each member.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Household Dashboard -->
      <div id="household-dashboard" style="display:none;">
        <!-- Header Card -->
        <div class="card" style="margin-bottom:24px;">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;">
            <div style="display:flex;align-items:center;gap:16px;">
              <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--accent-gold), #e8bc5a);border-radius:var(--radius-lg);display:flex;align-items:center;justify-content:center;font-size:28px;">ðŸ </div>
              <div>
                <h2 id="household-name-display" style="font-size:1.4rem;font-weight:600;margin-bottom:4px;"></h2>
                <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                  <span class="package-status accepted" id="household-member-count-badge" style="font-size:0.8rem;"></span>
                  <span class="package-status" id="household-vehicle-count-badge" style="font-size:0.8rem;background:var(--accent-blue-soft);color:var(--accent-blue);"></span>
                  <span style="color:var(--text-muted);font-size:0.85rem;" id="household-role-display"></span>
                </div>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <button class="btn btn-ghost btn-sm" onclick="editHouseholdName()" id="edit-household-btn" style="display:none;">âœï¸ Edit Name</button>
              <button class="btn btn-primary" onclick="openInviteMemberModal()" id="invite-member-btn" style="display:none;">+ Invite Member</button>
            </div>
          </div>
        </div>

        <!-- Members Section -->
        <div class="card" style="margin-bottom:24px;">
          <div class="card-header">
            <h2 class="card-title">ðŸ‘¥ Members</h2>
          </div>
          <div id="household-members-grid" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px;">
          </div>
        </div>

        <!-- Pending Invitations Section -->
        <div class="card" id="household-pending-section" style="margin-bottom:24px;display:none;">
          <div class="card-header">
            <h2 class="card-title">ðŸ“¨ Pending Invitations</h2>
          </div>
          <div id="household-pending-list">
          </div>
        </div>

        <!-- Shared Vehicles Section -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ðŸš— Shared Vehicles</h2>
            <button class="btn btn-secondary btn-sm" onclick="openShareVehicleModal()" id="share-vehicle-btn" style="display:none;">+ Share a Vehicle</button>
          </div>
          <div id="household-vehicles-grid" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px;">
            <div class="empty-state" style="grid-column:1/-1;padding:32px;">
              <div class="empty-state-icon">ðŸš—</div>
              <p>No vehicles shared yet.</p>
            </div>
          </div>
        </div>

        <!-- Household Activity Section -->
        <div class="card" style="margin-top:24px;">
          <div class="card-header">
            <h2 class="card-title">ðŸ“Š Household Activity</h2>
            <button class="btn btn-ghost btn-sm" onclick="refreshHouseholdActivity()">â†» Refresh</button>
          </div>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-bottom:20px;">Recent service requests by household members.</p>
          <div id="household-activity-list">
            <div class="empty-state" style="padding:24px;">
              <div class="empty-state-icon">ðŸ“Š</div>
              <p>No recent activity.</p>
              <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Service requests from household members will appear here.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Fleet Management Section -->
    <section id="fleet" class="section">
      <div class="page-header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
          <div>
            <h1 class="page-title" style="color:var(--accent-gold);">ðŸ¢ Fleet Management</h1>
            <p class="page-subtitle">Manage your business vehicles and schedule bulk services.</p>
          </div>
        </div>
      </div>

      <!-- No Fleet - Create Card -->
      <div id="fleet-no-fleet" style="display:none;">
        <div class="card" style="text-align:center;padding:48px 32px;">
          <div style="font-size:64px;margin-bottom:20px;">ðŸ¢</div>
          <h2 style="font-size:1.5rem;margin-bottom:12px;">Create Your Fleet</h2>
          <p style="color:var(--text-secondary);max-width:500px;margin:0 auto 24px;line-height:1.6;">
            Set up a business fleet to manage company vehicles, assign drivers, and schedule bulk maintenance services for your organization.
          </p>
          <div style="max-width:600px;margin:0 auto;">
            <div class="form-group">
              <input type="text" class="form-input" id="create-fleet-name" placeholder="Fleet/Company Name" style="text-align:center;font-size:1.1rem;">
            </div>
            <div class="form-row" style="margin-bottom:16px;">
              <div class="form-group" style="margin-bottom:0;">
                <select class="form-select" id="create-fleet-business-type">
                  <option value="">Select Business Type...</option>
                  <option value="rental">Rental</option>
                  <option value="corporate">Corporate</option>
                  <option value="delivery">Delivery</option>
                  <option value="rideshare">Rideshare</option>
                  <option value="logistics">Logistics</option>
                  <option value="government">Government</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group" style="margin-bottom:0;">
                <input type="email" class="form-input" id="create-fleet-billing-email" placeholder="Billing Email">
              </div>
            </div>
            <div class="form-group" style="margin-bottom:16px;">
              <input type="text" class="form-input" id="create-fleet-billing-address" placeholder="Billing Address (Street, City, State, ZIP)">
            </div>
            <div class="form-group" style="margin-bottom:16px;">
              <input type="text" class="form-input" id="create-fleet-tax-id" placeholder="Tax ID / EIN (Optional)">
            </div>
            <button class="btn btn-primary" onclick="createNewFleet()" style="width:100%;padding:14px 28px;font-size:1rem;">
              Create Fleet
            </button>
          </div>
          <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border-subtle);">
            <h4 style="margin-bottom:12px;color:var(--accent-gold);">âœ¨ Fleet Benefits</h4>
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;text-align:left;max-width:700px;margin:0 auto;">
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-blue);">ðŸš— Central Management</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Manage all company vehicles in one place.</p>
              </div>
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-green);">ðŸ“… Bulk Scheduling</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Schedule maintenance for multiple vehicles at once.</p>
              </div>
              <div style="padding:12px;background:var(--bg-input);border-radius:var(--radius-md);">
                <strong style="color:var(--accent-gold);">ðŸ‘¥ Role Management</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Assign roles, spending limits, and approvals.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fleet Dashboard -->
      <div id="fleet-dashboard" style="display:none;">
        <!-- Fleet Overview Card -->
        <div class="card" style="margin-bottom:24px;">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;">
            <div style="display:flex;align-items:center;gap:16px;">
              <div style="width:56px;height:56px;background:linear-gradient(135deg, var(--accent-gold), #c49a45);border-radius:var(--radius-lg);display:flex;align-items:center;justify-content:center;font-size:28px;">ðŸ¢</div>
              <div>
                <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                  <h2 id="fleet-name-display" style="font-size:1.4rem;font-weight:600;margin:0;"></h2>
                  <button class="btn btn-ghost btn-sm" onclick="editFleetName()" id="edit-fleet-name-btn" style="padding:4px 8px;">âœï¸</button>
                </div>
                <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-top:8px;">
                  <span class="fleet-business-badge" id="fleet-business-type-badge"></span>
                  <span class="package-status accepted" id="fleet-member-count-badge" style="font-size:0.8rem;"></span>
                  <span class="package-status" id="fleet-vehicle-count-badge" style="font-size:0.8rem;background:var(--accent-blue-soft);color:var(--accent-blue);"></span>
                </div>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <button class="btn btn-secondary btn-sm" onclick="openFleetSettingsModal()">âš™ï¸ Settings</button>
            </div>
          </div>
          <div id="fleet-company-info" style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border-subtle);display:none;">
            <div style="display:flex;gap:24px;flex-wrap:wrap;font-size:0.88rem;color:var(--text-secondary);">
              <span id="fleet-billing-email-display" style="display:flex;align-items:center;gap:6px;">ðŸ“§</span>
              <span id="fleet-address-display" style="display:flex;align-items:center;gap:6px;">ðŸ“</span>
              <span id="fleet-tax-id-display" style="display:flex;align-items:center;gap:6px;"></span>
            </div>
          </div>
        </div>

        <!-- Quick Stats Cards -->
        <div class="stats-grid" style="margin-bottom:24px;">
          <div class="stat-card">
            <div class="stat-icon green">ðŸ”§</div>
            <div class="stat-value" id="fleet-stat-active-services">0</div>
            <div class="stat-label">Active Services</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange">â³</div>
            <div class="stat-value" id="fleet-stat-pending-approvals">0</div>
            <div class="stat-label">Pending Approvals</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon blue">ðŸš—</div>
            <div class="stat-value" id="fleet-stat-total-vehicles">0</div>
            <div class="stat-label">Total Vehicles</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon gold">ðŸ‘¥</div>
            <div class="stat-value" id="fleet-stat-team-size">0</div>
            <div class="stat-label">Team Size</div>
          </div>
        </div>

        <!-- Approval Queue Section (for Managers/Owners) -->
        <div class="card" id="fleet-approval-queue-section" style="margin-bottom:24px;display:none;">
          <div class="card-header">
            <h2 class="card-title" style="display:flex;align-items:center;gap:8px;">
              <span style="color:var(--accent-orange);">âš ï¸</span> Approval Queue
            </h2>
            <button class="btn btn-ghost btn-sm" onclick="refreshFleetApprovals()">â†» Refresh</button>
          </div>
          <p style="font-size:0.9rem;color:var(--text-secondary);margin-bottom:16px;">Service requests requiring your approval.</p>
          <div id="fleet-approval-queue-list">
            <div class="empty-state" style="padding:24px;">
              <div class="empty-state-icon">âœ…</div>
              <p>No pending approvals.</p>
              <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Service requests from team members will appear here.</p>
            </div>
          </div>
        </div>

        <!-- Fleet Members Section -->
        <div class="card" style="margin-bottom:24px;">
          <div class="card-header">
            <h2 class="card-title">ðŸ‘¥ Fleet Members</h2>
            <button class="btn btn-primary btn-sm" onclick="openAddFleetEmployeeModal()">+ Add Employee</button>
          </div>
          <div style="overflow-x:auto;">
            <table class="fleet-table" id="fleet-members-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Employee ID</th>
                  <th>Department</th>
                  <th>Spending Limit</th>
                  <th>Approval</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="fleet-members-tbody">
                <tr>
                  <td colspan="8" style="text-align:center;padding:32px;color:var(--text-muted);">
                    <div style="font-size:32px;margin-bottom:8px;">ðŸ‘¥</div>
                    No fleet members yet. Add your first employee.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Fleet Vehicles Section -->
        <div class="card" style="margin-bottom:24px;">
          <div class="card-header">
            <h2 class="card-title">ðŸš— Fleet Vehicles</h2>
            <button class="btn btn-primary btn-sm" onclick="openAddFleetVehicleModal()">+ Add Vehicle</button>
          </div>
          <div class="tabs" id="fleet-vehicle-tabs" style="margin-bottom:16px;">
            <div class="tab active" data-fleet-filter="all" onclick="filterFleetVehicles('all')">All</div>
            <div class="tab" data-fleet-filter="assigned" onclick="filterFleetVehicles('assigned')">Assigned</div>
            <div class="tab" data-fleet-filter="pool" onclick="filterFleetVehicles('pool')">Pool</div>
            <div class="tab" data-fleet-filter="needs_service" onclick="filterFleetVehicles('needs_service')">Needs Service</div>
          </div>
          <div id="fleet-vehicles-grid" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:16px;">
            <div class="empty-state" style="grid-column:1/-1;padding:32px;">
              <div class="empty-state-icon">ðŸš—</div>
              <p>No vehicles in fleet yet.</p>
              <button class="btn btn-primary btn-sm" onclick="openAddFleetVehicleModal()" style="margin-top:12px;">+ Add First Vehicle</button>
            </div>
          </div>
        </div>

        <!-- Bulk Service Scheduling Section -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ðŸ“… Bulk Service Scheduling</h2>
            <button class="btn btn-primary" onclick="openBulkServiceWizard()">+ Schedule Bulk Service</button>
          </div>
          <div id="bulk-batches-list">
            <div class="empty-state" style="padding:32px;">
              <div class="empty-state-icon">ðŸ“…</div>
              <p>No bulk service batches yet.</p>
              <p style="font-size:0.85rem;color:var(--text-muted);margin-top:8px;">Schedule maintenance for multiple vehicles at once.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <div style="text-align:center;padding:40px 20px 20px;font-size:0.8rem;color:var(--text-muted);">
      Â© 2025 My Car Concierge. All rights reserved. - IMOR
    </div>
  </main>

  <!-- Invite Household Member Modal -->
  <div class="modal-backdrop" id="invite-member-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Invite Household Member</h3>
        <button class="modal-close" onclick="closeModal('invite-member-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Email Address *</label>
          <input type="email" class="form-input" id="invite-email" placeholder="family@example.com">
          <p class="form-hint">They'll receive an invitation to join your household.</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">Role *</label>
          <select class="form-select" id="invite-role" onchange="updateInvitePermissions()">
            <option value="adult">Adult - Can manage and approve services</option>
            <option value="driver">Driver - Can request services</option>
            <option value="viewer">Viewer - Can only view vehicle info</option>
          </select>
        </div>
        
        <div class="form-section" id="invite-permissions-section">
          <div class="form-section-title">Permissions</div>
          <div style="display:grid;gap:12px;">
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
              <input type="checkbox" id="perm-request-services" checked>
              <span>Can request services</span>
            </label>
            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;" id="perm-approve-container">
              <input type="checkbox" id="perm-approve-services">
              <span>Can approve services (for Adults)</span>
            </label>
          </div>
          
          <div class="form-group" style="margin-top:16px;">
            <label class="form-label">Spending Limit (Optional)</label>
            <div style="display:flex;align-items:center;gap:8px;">
              <span style="color:var(--text-muted);">$</span>
              <input type="number" class="form-input" id="invite-spending-limit" placeholder="No limit" style="max-width:150px;">
              <span style="color:var(--text-muted);font-size:0.85rem;">per service</span>
            </div>
            <p class="form-hint">Leave empty for no spending limit.</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('invite-member-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="sendHouseholdInvitation()">Send Invitation</button>
      </div>
    </div>
  </div>

  <!-- Share Vehicle Modal -->
  <div class="modal-backdrop" id="share-vehicle-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Share Vehicle with Household</h3>
        <button class="modal-close" onclick="closeModal('share-vehicle-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Select Vehicle *</label>
          <select class="form-select" id="share-vehicle-select">
            <option value="">Choose a vehicle...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Access Level *</label>
          <div style="display:grid;gap:12px;">
            <label style="display:flex;align-items:flex-start;gap:12px;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.15s;" class="access-level-option" onclick="selectAccessLevel('full')">
              <input type="radio" name="access-level" value="full" style="margin-top:4px;">
              <div>
                <strong style="color:var(--accent-green);">Full Access</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Members can request any service without approval.</p>
              </div>
            </label>
            <label style="display:flex;align-items:flex-start;gap:12px;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.15s;" class="access-level-option" onclick="selectAccessLevel('request')">
              <input type="radio" name="access-level" value="request" style="margin-top:4px;">
              <div>
                <strong style="color:var(--accent-orange);">Request Only</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Members can request services, but owner must approve.</p>
              </div>
            </label>
            <label style="display:flex;align-items:flex-start;gap:12px;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.15s;" class="access-level-option" onclick="selectAccessLevel('view')">
              <input type="radio" name="access-level" value="view" style="margin-top:4px;">
              <div>
                <strong style="color:var(--text-muted);">View Only</strong>
                <p style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">Members can see vehicle info but cannot request services.</p>
              </div>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('share-vehicle-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="shareVehicle()">Share Vehicle</button>
      </div>
    </div>
  </div>

  <!-- Manage Member Modal -->
  <div class="modal-backdrop" id="manage-member-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Manage Member</h3>
        <button class="modal-close" onclick="closeModal('manage-member-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="manage-member-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="removeMemberFromHousehold()" id="remove-member-btn">Remove from Household</button>
        <button class="btn btn-primary" onclick="saveMemberPermissions()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Destination Service Booking Modal -->
  <div class="modal-backdrop" id="destination-booking-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title" id="dest-modal-title">Book Destination Service</h3>
        <button class="modal-close" onclick="closeModal('destination-booking-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Service Type Selection -->
        <div id="dest-step-1" class="dest-wizard-step">
          <div class="form-section-title" style="margin-bottom:20px;">Select Service Type</div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));gap:16px;">
            <div class="dest-service-option" data-service="airport" onclick="selectDestServiceType('airport')" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px 16px;text-align:center;cursor:pointer;transition:all 0.2s;">
              <div style="font-size:48px;margin-bottom:12px;">âœˆï¸</div>
              <div style="font-weight:600;font-size:1rem;margin-bottom:4px;">Airport Pickup/Drop-off</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">We'll handle your car while you travel</div>
            </div>
            <div class="dest-service-option" data-service="dealership" onclick="selectDestServiceType('dealership')" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px 16px;text-align:center;cursor:pointer;transition:all 0.2s;">
              <div style="font-size:48px;margin-bottom:12px;">ðŸ¢</div>
              <div style="font-weight:600;font-size:1rem;margin-bottom:4px;">Dealership Service Run</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">We take your car for warranty/recall work</div>
            </div>
            <div class="dest-service-option" data-service="detailing" onclick="selectDestServiceType('detailing')" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px 16px;text-align:center;cursor:pointer;transition:all 0.2s;">
              <div style="font-size:48px;margin-bottom:12px;">âœ¨</div>
              <div style="font-weight:600;font-size:1rem;margin-bottom:4px;">Mobile Detail</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Premium detailing at your location</div>
            </div>
            <div class="dest-service-option" data-service="valet" onclick="selectDestServiceType('valet')" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px 16px;text-align:center;cursor:pointer;transition:all 0.2s;">
              <div style="font-size:48px;margin-bottom:12px;">ðŸ”‘</div>
              <div style="font-weight:600;font-size:1rem;margin-bottom:4px;">Valet Service</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Event and venue valet coordination</div>
            </div>
          </div>
        </div>

        <!-- Step 2: Airport Form -->
        <div id="dest-step-airport" class="dest-wizard-step" style="display:none;">
          <button class="btn btn-ghost" onclick="goBackToServiceSelection()" style="margin-bottom:16px;">â† Back to services</button>
          <div class="form-section-title" style="margin-bottom:20px;">âœˆï¸ Airport Parking Service</div>
          
          <div class="form-group">
            <label class="form-label">Vehicle *</label>
            <select class="form-select" id="dest-airport-vehicle" required>
              <option value="">Select a vehicle...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Trip Type *</label>
            <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;">
              <label class="dest-trip-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-trip-type" value="departure" style="display:none;">
                <span style="font-size:24px;margin-bottom:8px;">ðŸ›«</span>
                <span style="font-weight:500;">Departure</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Drop car at airport</span>
              </label>
              <label class="dest-trip-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-trip-type" value="arrival" style="display:none;">
                <span style="font-size:24px;margin-bottom:8px;">ðŸ›¬</span>
                <span style="font-weight:500;">Arrival</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Pick up from airport</span>
              </label>
              <label class="dest-trip-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-trip-type" value="round_trip" style="display:none;">
                <span style="font-size:24px;margin-bottom:8px;">ðŸ”„</span>
                <span style="font-weight:500;">Round Trip</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Both ways</span>
              </label>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Pickup Location *</label>
              <input type="text" class="form-input" id="dest-airport-pickup" placeholder="Home address">
            </div>
            <div class="form-group">
              <label class="form-label">Airport/Parking Location *</label>
              <input type="text" class="form-input" id="dest-airport-location" placeholder="e.g., EWR Terminal A">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Airline</label>
              <input type="text" class="form-input" id="dest-airport-airline" placeholder="e.g., United, Delta">
            </div>
            <div class="form-group">
              <label class="form-label">Flight Number (optional)</label>
              <input type="text" class="form-input" id="dest-airport-flight" placeholder="e.g., UA123">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Flight Date/Time *</label>
              <input type="datetime-local" class="form-input" id="dest-airport-datetime">
            </div>
            <div class="form-group" id="dest-airport-return-group">
              <label class="form-label">Return Date/Time</label>
              <input type="datetime-local" class="form-input" id="dest-airport-return">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Parking Preference</label>
            <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;">
              <label class="dest-parking-option" style="display:flex;flex-direction:column;align-items:center;padding:14px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-parking-pref" value="long_term" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸ…¿ï¸</span>
                <span style="font-weight:500;font-size:0.9rem;">Long-Term</span>
                <span style="font-size:0.72rem;color:var(--text-muted);">Economy lot</span>
              </label>
              <label class="dest-parking-option" style="display:flex;flex-direction:column;align-items:center;padding:14px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-parking-pref" value="short_term" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸ¢</span>
                <span style="font-weight:500;font-size:0.9rem;">Short-Term</span>
                <span style="font-size:0.72rem;color:var(--text-muted);">Garage parking</span>
              </label>
              <label class="dest-parking-option" style="display:flex;flex-direction:column;align-items:center;padding:14px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-parking-pref" value="valet" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸŽ©</span>
                <span style="font-weight:500;font-size:0.9rem;">Valet</span>
                <span style="font-size:0.72rem;color:var(--text-muted);">Premium service</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-textarea" id="dest-airport-instructions" placeholder="Key handoff details, specific parking section, etc."></textarea>
          </div>
        </div>

        <!-- Step 2: Dealership Form -->
        <div id="dest-step-dealership" class="dest-wizard-step" style="display:none;">
          <button class="btn btn-ghost" onclick="goBackToServiceSelection()" style="margin-bottom:16px;">â† Back to services</button>
          <div class="form-section-title" style="margin-bottom:20px;">ðŸ¢ Dealership Service Run</div>
          
          <div class="form-group">
            <label class="form-label">Vehicle *</label>
            <select class="form-select" id="dest-dealer-vehicle" required>
              <option value="">Select a vehicle...</option>
            </select>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Pickup Location *</label>
              <input type="text" class="form-input" id="dest-dealer-pickup" placeholder="Home or work address">
            </div>
            <div class="form-group">
              <label class="form-label">Dealership Name *</label>
              <input type="text" class="form-input" id="dest-dealer-name" placeholder="e.g., BMW of Manhattan">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Dealership Address *</label>
            <input type="text" class="form-input" id="dest-dealer-address" placeholder="Full dealership address">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Service Type *</label>
              <select class="form-select" id="dest-dealer-service-type">
                <option value="">Select service type...</option>
                <option value="warranty">Warranty Work</option>
                <option value="recall">Recall Service</option>
                <option value="scheduled">Scheduled Maintenance</option>
                <option value="repair">Repair</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Appointment Date/Time *</label>
              <input type="datetime-local" class="form-input" id="dest-dealer-datetime">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-textarea" id="dest-dealer-instructions" placeholder="Appointment confirmation number, service advisor name, etc."></textarea>
          </div>
        </div>

        <!-- Step 2: Mobile Detailing Form -->
        <div id="dest-step-detailing" class="dest-wizard-step" style="display:none;">
          <button class="btn btn-ghost" onclick="goBackToServiceSelection()" style="margin-bottom:16px;">â† Back to services</button>
          <div class="form-section-title" style="margin-bottom:20px;">âœ¨ Mobile Detailing</div>
          
          <div class="form-group">
            <label class="form-label">Vehicle *</label>
            <select class="form-select" id="dest-detail-vehicle" required>
              <option value="">Select a vehicle...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Service Location *</label>
            <input type="text" class="form-input" id="dest-detail-location" placeholder="Where is the car located?">
          </div>
          
          <div class="form-group">
            <label class="form-label">Service Level *</label>
            <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:12px;">
              <label class="dest-detail-level" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-detail-level" value="basic" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸ’§</span>
                <span style="font-weight:600;">Basic</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Exterior wash</span>
                <span style="font-size:0.85rem;color:var(--accent-gold);margin-top:4px;">$</span>
              </label>
              <label class="dest-detail-level" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-detail-level" value="standard" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸš¿</span>
                <span style="font-weight:600;">Standard</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Interior + exterior</span>
                <span style="font-size:0.85rem;color:var(--accent-gold);margin-top:4px;">$$</span>
              </label>
              <label class="dest-detail-level" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-detail-level" value="premium" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">âœ¨</span>
                <span style="font-weight:600;">Premium</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Full detail + wax</span>
                <span style="font-size:0.85rem;color:var(--accent-gold);margin-top:4px;">$$$</span>
              </label>
              <label class="dest-detail-level" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
                <input type="radio" name="dest-detail-level" value="full" style="display:none;">
                <span style="font-size:20px;margin-bottom:6px;">ðŸ†</span>
                <span style="font-weight:600;">Full Detail</span>
                <span style="font-size:0.75rem;color:var(--text-muted);">Complete restoration</span>
                <span style="font-size:0.85rem;color:var(--accent-gold);margin-top:4px;">$$$$</span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Preferred Date/Time *</label>
            <input type="datetime-local" class="form-input" id="dest-detail-datetime">
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-textarea" id="dest-detail-instructions" placeholder="Specific areas of concern, access instructions, etc."></textarea>
          </div>
        </div>

        <!-- Step 2: Valet Form -->
        <div id="dest-step-valet" class="dest-wizard-step" style="display:none;">
          <button class="btn btn-ghost" onclick="goBackToServiceSelection()" style="margin-bottom:16px;">â† Back to services</button>
          <div class="form-section-title" style="margin-bottom:20px;">ðŸ”‘ Valet Service</div>
          
          <div class="form-group">
            <label class="form-label">Vehicle *</label>
            <select class="form-select" id="dest-valet-vehicle" required>
              <option value="">Select a vehicle...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Pickup Location *</label>
            <input type="text" class="form-input" id="dest-valet-pickup" placeholder="Where to pick up the vehicle">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Event Name *</label>
              <input type="text" class="form-input" id="dest-valet-event" placeholder="e.g., Wedding, Gala, Party">
            </div>
            <div class="form-group">
              <label class="form-label">Event Venue *</label>
              <input type="text" class="form-input" id="dest-valet-venue" placeholder="Venue name and address">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Event Date/Time *</label>
              <input type="datetime-local" class="form-input" id="dest-valet-datetime">
            </div>
            <div class="form-group">
              <label class="form-label">Expected Duration</label>
              <select class="form-select" id="dest-valet-duration">
                <option value="2">2 hours</option>
                <option value="3">3 hours</option>
                <option value="4" selected>4 hours</option>
                <option value="5">5 hours</option>
                <option value="6">6 hours</option>
                <option value="8">8 hours</option>
                <option value="12">12 hours</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-textarea" id="dest-valet-instructions" placeholder="Parking preferences, timing details, contact person, etc."></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="dest-modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('destination-booking-modal')">Cancel</button>
        <button class="btn btn-primary" id="dest-submit-btn" onclick="submitDestinationService()" style="display:none;">Book Service</button>
      </div>
    </div>
  </div>

  <!-- Destination Service Detail Modal -->
  <div class="modal-backdrop" id="destination-detail-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title" id="dest-detail-title">Service Details</h3>
        <button class="modal-close" onclick="closeModal('destination-detail-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="dest-detail-body">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Add Vehicle Modal -->
  <div class="modal-backdrop" id="vehicle-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" style="display:flex;align-items:center;gap:10px;">
          Add Vehicle to Garage
        </h3>
        <button class="modal-close" onclick="closeModal('vehicle-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="vehicle-form-section">
        <div class="form-section">
          <div class="form-section-title">Vehicle Photo</div>
          <div id="vehicle-photo-upload-area" class="vehicle-photo-upload-container" onclick="document.getElementById('vehicle-photo-input').click()" style="position:relative;height:200px;background:linear-gradient(135deg, var(--bg-elevated), var(--bg-input));border:2px dashed var(--border-subtle);border-radius:var(--radius-lg);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;overflow:hidden;">
            <input type="file" id="vehicle-photo-input" accept="image/*" style="display:none;" onchange="handleVehiclePhotoSelect(event)">
            <div id="vehicle-photo-placeholder" style="text-align:center;">
              <div style="font-size:48px;margin-bottom:12px;opacity:0.7;">ðŸ“·</div>
              <div style="font-weight:500;color:var(--text-primary);margin-bottom:4px;">Add a photo of your vehicle</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Click to upload â€¢ Max 5MB</div>
            </div>
            <img id="vehicle-photo-preview" src="" alt="Vehicle Preview" style="display:none;width:100%;height:100%;object-fit:cover;">
            <button type="button" id="vehicle-photo-remove" onclick="event.stopPropagation();removeVehiclePhoto();" style="display:none;position:absolute;top:12px;right:12px;width:32px;height:32px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;color:white;cursor:pointer;font-size:16px;">Ã—</button>
          </div>
          <p style="font-size:0.78rem;color:var(--text-muted);margin-top:8px;text-align:center;">Show off your car like on Turo! A great photo helps providers identify your vehicle.</p>
        </div>
        
        <div class="form-section">
          <div class="form-section-title">Vehicle Information</div>
          <div class="form-row three">
            <div class="form-group">
              <label class="form-label">Year *</label>
              <select class="form-select" id="v-year" onchange="updateMakeOptions()">
                <option value="">Select Year</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Make *</label>
              <select class="form-select" id="v-make" onchange="updateModelOptions()" disabled>
                <option value="">Select Make</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Model *</label>
              <select class="form-select" id="v-model" onchange="updateTrimOptions()" disabled>
                <option value="">Select Model</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Trim / Version</label>
              <input type="text" class="form-input" id="v-trim" list="v-trim-options" placeholder="e.g. Sport, Turbo, Mk 7.5, CLA 45" disabled>
              <datalist id="v-trim-options"></datalist>
              <small style="color: var(--text-muted); font-size: 0.75rem;">Select from suggestions or type your own</small>
            </div>
            <div class="form-group">
              <label class="form-label">Color</label>
              <select class="form-select" id="v-color">
                <option value="">Select Color (Optional)</option>
                <option value="Black">Black</option>
                <option value="White">White</option>
                <option value="Silver">Silver</option>
                <option value="Gray">Gray</option>
                <option value="Red">Red</option>
                <option value="Blue">Blue</option>
                <option value="Navy">Navy</option>
                <option value="Green">Green</option>
                <option value="Brown">Brown</option>
                <option value="Tan">Tan</option>
                <option value="Beige">Beige</option>
                <option value="Gold">Gold</option>
                <option value="Orange">Orange</option>
                <option value="Yellow">Yellow</option>
                <option value="Purple">Purple</option>
                <option value="Burgundy">Burgundy</option>
                <option value="Champagne">Champagne</option>
                <option value="Pearl White">Pearl White</option>
                <option value="Metallic Silver">Metallic Silver</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nickname (Optional)</label>
              <input type="text" class="form-input" id="v-nickname" placeholder="My daily driver">
            </div>
            <div class="form-group">
              <label class="form-label">Current Mileage</label>
              <input type="number" class="form-input" id="v-mileage" placeholder="45000">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label class="form-label">VIN (Optional but Recommended)</label>
              <input type="text" class="form-input" id="v-vin" placeholder="17-character Vehicle Identification Number" maxlength="17" style="text-transform: uppercase;">
              <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">Helps providers find exact parts for your vehicle</small>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label class="form-label">Fuel Injection Type</label>
              <select class="form-select" id="v-fuel-injection">
                <option value="">Auto-detect based on vehicle</option>
                <option value="port_injection">Port Injection (Traditional)</option>
                <option value="direct_injection">Direct Injection (GDI/TSI/TFSI)</option>
                <option value="dual_injection">Dual Injection (Both)</option>
              </select>
              <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">Direct injection engines require carbon cleaning maintenance</small>
            </div>
          </div>
        </div>
        </div><!-- End vehicle-form-section -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('vehicle-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveVehicle()">Add Vehicle</button>
      </div>
    </div>
  </div>

  <!-- Edit Vehicle Modal -->
  <div class="modal-backdrop" id="edit-vehicle-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Vehicle</h3>
        <button class="modal-close" onclick="closeModal('edit-vehicle-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-section">
          <div class="form-section-title">Vehicle Photo</div>
          <div id="edit-vehicle-photo-upload-area" class="vehicle-photo-upload-container" onclick="document.getElementById('edit-vehicle-photo-input').click()" style="position:relative;height:200px;background:linear-gradient(135deg, var(--bg-elevated), var(--bg-input));border:2px dashed var(--border-subtle);border-radius:var(--radius-lg);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;overflow:hidden;">
            <input type="file" id="edit-vehicle-photo-input" accept="image/*" style="display:none;" onchange="handleEditVehiclePhotoSelect(event)">
            <div id="edit-vehicle-photo-placeholder" style="text-align:center;">
              <div style="font-size:48px;margin-bottom:12px;opacity:0.7;">ðŸ“·</div>
              <div style="font-weight:500;color:var(--text-primary);margin-bottom:4px;">Add a photo of your vehicle</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Click to upload â€¢ Max 5MB</div>
            </div>
            <img id="edit-vehicle-photo-preview" src="" alt="Vehicle Preview" style="display:none;width:100%;height:100%;object-fit:cover;">
            <button type="button" id="edit-vehicle-photo-remove" onclick="event.stopPropagation();removeEditVehiclePhoto();" style="display:none;position:absolute;top:12px;right:12px;width:32px;height:32px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;color:white;cursor:pointer;font-size:16px;">Ã—</button>
          </div>
          <p style="font-size:0.78rem;color:var(--text-muted);margin-top:8px;text-align:center;">Show off your car like on Turo! A great photo helps providers identify your vehicle.</p>
        </div>
        
        <div class="form-section">
          <div class="form-section-title">Vehicle Information</div>
          <div class="form-row three">
            <div class="form-group">
              <label class="form-label">Year *</label>
              <select class="form-select" id="edit-v-year" onchange="updateEditMakeOptions()">
                <option value="">Select Year</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Make *</label>
              <select class="form-select" id="edit-v-make" onchange="updateEditModelOptions()">
                <option value="">Select Make</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Model *</label>
              <select class="form-select" id="edit-v-model" onchange="updateEditTrimOptions()">
                <option value="">Select Model</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Trim / Version</label>
              <input type="text" class="form-input" id="edit-v-trim" list="edit-v-trim-options" placeholder="e.g. Sport, Turbo, Mk 7.5, CLA 45">
              <datalist id="edit-v-trim-options"></datalist>
              <small style="color: var(--text-muted); font-size: 0.75rem;">Select from suggestions or type your own</small>
            </div>
            <div class="form-group">
              <label class="form-label">Color</label>
              <select class="form-select" id="edit-v-color">
                <option value="">Select Color (Optional)</option>
                <option value="Black">Black</option>
                <option value="White">White</option>
                <option value="Silver">Silver</option>
                <option value="Gray">Gray</option>
                <option value="Red">Red</option>
                <option value="Blue">Blue</option>
                <option value="Navy">Navy</option>
                <option value="Green">Green</option>
                <option value="Brown">Brown</option>
                <option value="Tan">Tan</option>
                <option value="Beige">Beige</option>
                <option value="Gold">Gold</option>
                <option value="Orange">Orange</option>
                <option value="Yellow">Yellow</option>
                <option value="Purple">Purple</option>
                <option value="Burgundy">Burgundy</option>
                <option value="Champagne">Champagne</option>
                <option value="Pearl White">Pearl White</option>
                <option value="Metallic Silver">Metallic Silver</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nickname (Optional)</label>
              <input type="text" class="form-input" id="edit-v-nickname" placeholder="My daily driver">
            </div>
            <div class="form-group">
              <label class="form-label">Current Mileage</label>
              <input type="number" class="form-input" id="edit-v-mileage" placeholder="45000">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label class="form-label">VIN (Optional but Recommended)</label>
              <input type="text" class="form-input" id="edit-v-vin" placeholder="17-character Vehicle Identification Number" maxlength="17" style="text-transform: uppercase;">
              <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">Helps providers find exact parts for your vehicle</small>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label class="form-label">Fuel Injection Type</label>
              <select class="form-select" id="edit-v-fuel-injection">
                <option value="">Auto-detect based on vehicle</option>
                <option value="port_injection">Port Injection (Traditional)</option>
                <option value="direct_injection">Direct Injection (GDI/TSI/TFSI)</option>
                <option value="dual_injection">Dual Injection (Both)</option>
              </select>
              <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">Direct injection engines require carbon cleaning maintenance</small>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('edit-vehicle-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveEditVehicle()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- New Maintenance Package Modal -->
  <div class="modal-backdrop" id="package-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title">Create Maintenance Package</h3>
        <button class="modal-close" onclick="closeModal('package-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-section">
          <div class="form-section-title">What do you need?</div>
          <div class="form-group">
            <label class="form-label">Vehicle *</label>
            <select class="form-select" id="p-vehicle" required>
              <option value="">Select a vehicle...</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Category *</label>
              <select class="form-select" id="p-category" required>
                <option value="maintenance">Maintenance & Mechanical</option>
                <option value="manufacturer_service">Manufacturer Service Packages</option>
                <option value="detailing">Detailing & Cleaning</option>
                <option value="cosmetic">Cosmetic & Body</option>
                <option value="accident_repair">Accident / Insurance Repair</option>
                <option value="performance">Performance & Modifications</option>
                <option value="audio_electronics">Audio & Electronics</option>
                <option value="lighting">Lighting & Accessories</option>
                <option value="interior">Interior & Upholstery</option>
                <option value="offroad">Off-Road & Specialty</option>
                <option value="ev_hybrid">EV & Hybrid Services</option>
                <option value="classic_vintage">Classic & Vintage Cars</option>
                <option value="fleet_graphics">Fleet & Commercial Graphics</option>
                <option value="premium_protection">Premium Protection (PPF/Coating)</option>
                <option value="convertible_specialty">Convertible & Specialty</option>
                <option value="motorcycle">Motorcycle Services</option>
                <option value="rv_camper">RV & Camper Services</option>
                <option value="boat_marine">Boat & Marine Services</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Service Type</label>
              <select class="form-select" id="p-service-type">
                <option value="">Select service...</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Title / Summary *</label>
            <input type="text" class="form-input" id="p-title" placeholder="e.g., Full detail + ceramic coating" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="p-description" placeholder="Describe what you need, any specific concerns, symptoms, etc."></textarea>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-title">Frequency & Schedule</div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Frequency</label>
              <select class="form-select" id="p-frequency">
                <option value="one_time">One-time service</option>
                <option value="weekly">Weekly</option>
                <option value="bi_weekly">Every 2 weeks</option>
                <option value="monthly">Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="annually">Annually</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Preferred Schedule</label>
              <input type="text" class="form-input" id="p-schedule" placeholder="e.g., Weekdays after 5pm, Saturday morning">
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-title">Parts Preference</div>
          <div class="parts-tiers" id="parts-tiers">
            <div class="parts-tier" data-tier="economy">
              <div class="parts-tier-name">ðŸ’° Economy</div>
              <div class="parts-tier-desc">Budget-friendly, gets the job done</div>
            </div>
            <div class="parts-tier selected" data-tier="standard">
              <div class="parts-tier-name">âš™ï¸ Standard (OEM)</div>
              <div class="parts-tier-desc">Original equipment quality</div>
            </div>
            <div class="parts-tier" data-tier="premium">
              <div class="parts-tier-name">â­ Premium</div>
              <div class="parts-tier-desc">High-performance, extended warranty</div>
            </div>
          </div>
        </div>

        <div class="form-section" id="fitment-section" style="display: none;">
          <div class="form-section-title">ðŸ”§ Fitment & Specifications</div>
          <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:16px;">Provide specific measurements to ensure proper part compatibility</p>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Bolt Pattern</label>
              <input type="text" class="form-input" id="p-bolt-pattern" placeholder="e.g., 5x114.3, 6x139.7">
            </div>
            <div class="form-group">
              <label class="form-label">Hub Bore Size</label>
              <input type="text" class="form-input" id="p-hub-bore" placeholder="e.g., 67.1mm, 73.1mm">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Wheel Spline Type</label>
              <select class="form-select" id="p-spline-type">
                <option value="">Select if applicable...</option>
                <option value="6_spline">6 Spline</option>
                <option value="7_spline">7 Spline</option>
                <option value="conical">Conical Seat</option>
                <option value="spherical">Spherical/Ball Seat</option>
                <option value="flat">Flat Seat</option>
                <option value="other">Other (specify in notes)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Thread Size</label>
              <input type="text" class="form-input" id="p-thread-size" placeholder="e.g., M12x1.5, M14x1.5">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Wheel Offset (ET)</label>
              <input type="text" class="form-input" id="p-wheel-offset" placeholder="e.g., +35, +45, -12">
            </div>
            <div class="form-group">
              <label class="form-label">Wheel Width</label>
              <input type="text" class="form-input" id="p-wheel-width" placeholder="e.g., 8.5J, 9.5J, 10J">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Additional Fitment Notes</label>
            <textarea class="form-textarea" id="p-fitment-notes" placeholder="Other specifications: suspension lift height, brake caliper clearance, fender modifications needed, etc."></textarea>
          </div>
        </div>

        <div class="form-section" id="oil-preference-section" style="display: none;">
          <div class="form-section-title">ðŸ›¢ï¸ Oil/Fluid Preference</div>
          <div class="oil-preference-toggle" id="oil-preference-toggle">
            <div class="oil-pref-option selected" data-choice="provider">
              <div class="oil-pref-radio"></div>
              <div class="oil-pref-content">
                <div class="oil-pref-name">Let provider choose</div>
                <div class="oil-pref-desc">Based on my car's specs and manufacturer recommendations</div>
              </div>
            </div>
            <div class="oil-pref-option" data-choice="specify">
              <div class="oil-pref-radio"></div>
              <div class="oil-pref-content">
                <div class="oil-pref-name">I want to specify</div>
                <div class="oil-pref-desc">Choose specific oil type and brand preferences</div>
              </div>
            </div>
          </div>
          <div id="oil-specify-options" style="display: none; margin-top: 16px;">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Oil Type</label>
                <select class="form-select" id="p-oil-type">
                  <option value="conventional">Conventional</option>
                  <option value="synthetic_blend">Synthetic Blend</option>
                  <option value="full_synthetic" selected>Full Synthetic</option>
                  <option value="high_mileage">High Mileage</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Brand Preference (Optional)</label>
                <input type="text" class="form-input" id="p-oil-brand" placeholder="e.g., Mobil 1, Castrol, Pennzoil">
              </div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-title">Logistics</div>
          <div class="form-group">
            <label class="form-label">How should the vehicle get to the shop?</label>
            <select class="form-select" id="p-pickup" onchange="handlePickupChange()">
              <option value="either">Flexible - any option works</option>
              <option value="provider_pickup">Provider picks up from my location</option>
              <option value="member_dropoff">I'll drop it off</option>
              <option value="rideshare">I'll drive there, need ride home (Uber/Lyft)</option>
              <option value="destination_service">ðŸš— Transport to a destination (airport, dealership, etc.)</option>
            </select>
          </div>
          
          <div id="destination-service-fields" style="display: none; margin-top: 16px;">
            <div class="destination-service-info" style="background: linear-gradient(135deg, rgba(212,175,55,0.1), rgba(59,130,246,0.1)); border: 1px solid var(--gold); border-radius: var(--radius-md); padding: 16px; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 1.25rem;">ðŸš—</span>
                <strong style="color: var(--gold);">Destination Service</strong>
              </div>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">A verified driver will pick up your vehicle, take it to the destination, and return it when ready. Background-checked drivers only.</p>
            </div>
            
            <div class="form-group">
              <label class="form-label">Where should your vehicle be taken?</label>
              <div class="destination-type-options" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                <div class="destination-type-option" data-type="airport" onclick="selectDestinationType('airport')" style="border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; text-align: center; transition: all 0.2s;">
                  <div style="font-size: 1.5rem; margin-bottom: 4px;">âœˆï¸</div>
                  <div style="font-weight: 500;">Airport Parking</div>
                  <div style="font-size: 0.8rem; color: var(--text-muted);">Park while you travel</div>
                </div>
                <div class="destination-type-option" data-type="dealership" onclick="selectDestinationType('dealership')" style="border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; text-align: center; transition: all 0.2s;">
                  <div style="font-size: 1.5rem; margin-bottom: 4px;">ðŸ¢</div>
                  <div style="font-weight: 500;">Dealership</div>
                  <div style="font-size: 0.8rem; color: var(--text-muted);">Warranty, recall, service</div>
                </div>
                <div class="destination-type-option" data-type="detail" onclick="selectDestinationType('detail')" style="border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; text-align: center; transition: all 0.2s;">
                  <div style="font-size: 1.5rem; margin-bottom: 4px;">âœ¨</div>
                  <div style="font-weight: 500;">Detail Shop</div>
                  <div style="font-size: 0.8rem; color: var(--text-muted);">Drop off for detailing</div>
                </div>
                <div class="destination-type-option" data-type="other" onclick="selectDestinationType('other')" style="border: 2px solid var(--border-subtle); border-radius: var(--radius-md); padding: 16px; cursor: pointer; text-align: center; transition: all 0.2s;">
                  <div style="font-size: 1.5rem; margin-bottom: 4px;">ðŸ“</div>
                  <div style="font-weight: 500;">Other Location</div>
                  <div style="font-size: 0.8rem; color: var(--text-muted);">Specify destination</div>
                </div>
              </div>
              <input type="hidden" id="p-destination-type" value="">
            </div>
            
            <div id="airport-fields" style="display: none; margin-top: 16px;">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Trip Type</label>
                  <select class="form-select" id="p-trip-type">
                    <option value="departure">Departure - Take car to airport</option>
                    <option value="arrival">Arrival - Pick up car from airport</option>
                    <option value="round_trip">Round Trip - Both ways</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Airport</label>
                  <input type="text" class="form-input" id="p-airport" placeholder="e.g., LAX, JFK, ORD">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Flight Number (Optional)</label>
                  <input type="text" class="form-input" id="p-flight-number" placeholder="e.g., AA1234">
                </div>
                <div class="form-group">
                  <label class="form-label">Airline (Optional)</label>
                  <input type="text" class="form-input" id="p-airline" placeholder="e.g., American Airlines">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Departure Date & Time</label>
                  <input type="datetime-local" class="form-input" id="p-departure-datetime">
                </div>
                <div class="form-group">
                  <label class="form-label">Return Date & Time (if round trip)</label>
                  <input type="datetime-local" class="form-input" id="p-return-datetime">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Parking Preference</label>
                <select class="form-select" id="p-parking-preference">
                  <option value="any">Any available parking</option>
                  <option value="covered">Covered/garage parking</option>
                  <option value="valet">Valet parking</option>
                  <option value="economy">Economy lot (budget option)</option>
                </select>
              </div>
            </div>
            
            <div id="dealership-fields" style="display: none; margin-top: 16px;">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Dealership Name</label>
                  <input type="text" class="form-input" id="p-dealership-name" placeholder="e.g., BMW of Beverly Hills">
                </div>
                <div class="form-group">
                  <label class="form-label">Service Type</label>
                  <select class="form-select" id="p-dealership-service-type">
                    <option value="scheduled">Scheduled Maintenance</option>
                    <option value="warranty">Warranty Work</option>
                    <option value="recall">Recall Service</option>
                    <option value="repair">Repair</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Dealership Address</label>
                <input type="text" class="form-input" id="p-dealership-address" placeholder="Full address">
              </div>
              <div class="form-group">
                <label class="form-label">Appointment Date & Time (if scheduled)</label>
                <input type="datetime-local" class="form-input" id="p-dealership-appointment">
              </div>
            </div>
            
            <div id="detail-fields" style="display: none; margin-top: 16px;">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Detail Shop Name</label>
                  <input type="text" class="form-input" id="p-detail-shop-name" placeholder="Shop name">
                </div>
                <div class="form-group">
                  <label class="form-label">Service Level</label>
                  <select class="form-select" id="p-detail-service-level">
                    <option value="basic">Basic Detail</option>
                    <option value="standard">Standard Detail</option>
                    <option value="premium">Premium Detail</option>
                    <option value="full">Full Correction/Coating</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Shop Address</label>
                <input type="text" class="form-input" id="p-detail-shop-address" placeholder="Full address">
              </div>
            </div>
            
            <div id="other-destination-fields" style="display: none; margin-top: 16px;">
              <div class="form-group">
                <label class="form-label">Destination Name/Type</label>
                <input type="text" class="form-input" id="p-other-destination-name" placeholder="e.g., Body shop, tire shop, etc.">
              </div>
              <div class="form-group">
                <label class="form-label">Destination Address</label>
                <input type="text" class="form-input" id="p-other-destination-address" placeholder="Full address">
              </div>
            </div>
            
            <div class="form-group" style="margin-top: 16px;">
              <label class="form-label">Special Instructions for Driver</label>
              <textarea class="form-textarea" id="p-destination-instructions" rows="3" placeholder="Any special instructions for pickup, parking, or handling your vehicle..."></textarea>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-title">Bidding Window</div>
          <p class="form-hint" style="margin-bottom:16px;">How long should providers have to submit bids? After this window closes, no new bids can be submitted.</p>
          <div class="bidding-window-options" id="bidding-window-options">
            <div class="bid-window-option" data-hours="24">
              <div class="bid-window-time">24 hours</div>
              <div class="bid-window-desc">Quick turnaround</div>
            </div>
            <div class="bid-window-option" data-hours="48">
              <div class="bid-window-time">2 days</div>
              <div class="bid-window-desc">Standard</div>
            </div>
            <div class="bid-window-option selected" data-hours="72">
              <div class="bid-window-time">3 days</div>
              <div class="bid-window-desc">Recommended</div>
            </div>
            <div class="bid-window-option" data-hours="120">
              <div class="bid-window-time">5 days</div>
              <div class="bid-window-desc">More options</div>
            </div>
            <div class="bid-window-option" data-hours="168">
              <div class="bid-window-time">7 days</div>
              <div class="bid-window-desc">Maximum reach</div>
            </div>
          </div>
        </div>

        <div class="form-section" id="insurance-section" style="display: none;">
          <div class="form-section-title">Insurance Information</div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Insurance Carrier</label>
              <input type="text" class="form-input" id="p-insurance-carrier" placeholder="State Farm, GEICO, etc.">
            </div>
            <div class="form-group">
              <label class="form-label">Claim Number</label>
              <input type="text" class="form-input" id="p-claim-number" placeholder="Claim #">
            </div>
          </div>
        </div>

        <div class="form-section" id="private-job-section" style="display: none;">
          <div class="form-section-title">ðŸ”’ Private Job Request</div>
          <div class="private-job-container" style="background:var(--accent-gold-soft);border:1px solid var(--accent-gold);border-radius:var(--radius-md);padding:16px;">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:16px;">
              <div>
                <div style="font-weight:600;color:var(--text-primary);margin-bottom:4px;">Send directly to <span id="preferred-provider-name">your preferred provider</span></div>
                <div style="font-size:0.85rem;color:var(--text-secondary);">Private jobs skip the bidding process. Only your preferred provider will see this request.</div>
              </div>
              <label class="toggle-switch" style="flex-shrink:0;">
                <input type="checkbox" id="p-private-job" onchange="handlePrivateJobToggle()">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div id="private-job-info" style="display:none;margin-top:12px;padding-top:12px;border-top:1px solid rgba(201, 162, 39, 0.3);">
              <div style="display:flex;align-items:center;gap:8px;color:var(--accent-gold);">
                <span style="font-size:1.2rem;">âš¡</span>
                <span style="font-size:0.9rem;">Provider can accept immediately without competitive bidding</span>
              </div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-title">ðŸ“· Photos (Optional)</div>
          <p class="form-hint" style="margin-bottom:12px;">Add photos to help providers understand the issue and provide accurate quotes.</p>
          <div class="photo-upload-area" onclick="document.getElementById('package-photo-input').click()" style="border:2px dashed var(--border-subtle);border-radius:var(--radius-md);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s;">
            <div style="font-size:32px;margin-bottom:8px;">ðŸ“¸</div>
            <div style="font-weight:500;color:var(--text-primary);">Click to upload photos</div>
            <div style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">JPG, PNG up to 5MB each â€¢ Max 5 photos</div>
          </div>
          <input type="file" id="package-photo-input" accept="image/*" multiple style="display:none;" onchange="handlePackagePhotoSelect(event)">
          <div id="package-photo-preview" style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('package-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="savePackage()">Create Package</button>
      </div>
    </div>
  </div>

  <!-- View Package Modal (with bids) -->
  <div class="modal-backdrop" id="view-package-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title" id="view-package-title">Package Details</h3>
        <button class="modal-close" onclick="closeModal('view-package-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="view-package-body">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Vehicle Recalls Modal -->
  <div class="modal-backdrop" id="recalls-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title">
          <span style="color: var(--accent-red);">âš ï¸</span> Safety Recalls
        </h3>
        <button class="modal-close" onclick="closeModal('recalls-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="recalls-vehicle-info" style="margin-bottom: 20px; padding: 16px; background: var(--bg-input); border-radius: var(--radius-md);">
          <div id="recalls-vehicle-name" style="font-weight: 600; font-size: 1.1rem;"></div>
          <div id="recalls-vehicle-details" style="color: var(--text-muted); font-size: 0.88rem;"></div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <span id="recalls-active-count" style="font-weight: 600; color: var(--accent-red);"></span>
            <span style="color: var(--text-muted);"> active recalls</span>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="refreshVehicleRecalls()" id="refresh-recalls-btn">
            ðŸ”„ Check for Updates
          </button>
        </div>
        <div id="recalls-list" style="max-height: 400px; overflow-y: auto;">
          <!-- Populated by JS -->
        </div>
        <div id="recalls-empty" style="display: none; text-align: center; padding: 40px 20px; color: var(--text-muted);">
          <div style="font-size: 48px; margin-bottom: 12px;">âœ…</div>
          <div style="font-weight: 500; margin-bottom: 4px;">No recalls found!</div>
          <div style="font-size: 0.88rem;">Your vehicle has no active safety recalls.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('recalls-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Repost Package Modal -->
  <div class="modal-backdrop" id="repost-modal">
    <div class="modal" style="max-width:480px;">
      <div class="modal-header">
        <h3 class="modal-title">Repost Package</h3>
        <button class="modal-close" onclick="closeModal('repost-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="repost-package-id">
        <p style="margin-bottom:8px;color:var(--text-secondary);">Reposting:</p>
        <p id="repost-package-title" style="font-weight:600;font-size:1.1rem;margin-bottom:20px;"></p>
        
        <p style="margin-bottom:12px;">How long should providers have to bid?</p>
        <div class="repost-window-options" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
          <div class="repost-window-option bid-window-option" data-hours="24" onclick="selectRepostWindow(this)">
            <div class="bid-window-time">24 hours</div>
            <div class="bid-window-desc">Quick</div>
          </div>
          <div class="repost-window-option bid-window-option" data-hours="48" onclick="selectRepostWindow(this)">
            <div class="bid-window-time">2 days</div>
            <div class="bid-window-desc">Standard</div>
          </div>
          <div class="repost-window-option bid-window-option selected" data-hours="72" onclick="selectRepostWindow(this)">
            <div class="bid-window-time">3 days</div>
            <div class="bid-window-desc">Recommended</div>
          </div>
          <div class="repost-window-option bid-window-option" data-hours="120" onclick="selectRepostWindow(this)">
            <div class="bid-window-time">5 days</div>
            <div class="bid-window-desc">More bids</div>
          </div>
          <div class="repost-window-option bid-window-option" data-hours="168" onclick="selectRepostWindow(this)">
            <div class="bid-window-time">7 days</div>
            <div class="bid-window-desc">Maximum</div>
          </div>
        </div>

        <div class="alert" style="background:var(--accent-blue-soft);border:1px solid rgba(74,124,255,0.3);color:var(--accent-blue);margin-top:20px;padding:14px;border-radius:var(--radius-md);font-size:0.88rem;">
          ðŸ’¡ Previous bids will be cleared. Providers can submit new bids during the new window.
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('repost-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="confirmRepost()">ðŸ”„ Repost Package</button>
      </div>
    </div>
  </div>

  <!-- Extend Deadline Modal -->
  <div class="modal-backdrop" id="extend-modal">
    <div class="modal" style="max-width:480px;">
      <div class="modal-header">
        <h3 class="modal-title">â±ï¸ Extend Bidding Window</h3>
        <button class="modal-close" onclick="closeModal('extend-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="extend-package-id">
        <p style="margin-bottom:8px;color:var(--text-secondary);">Package:</p>
        <p id="extend-package-title" style="font-weight:600;font-size:1.1rem;margin-bottom:12px;"></p>
        <p id="extend-current-deadline" style="font-size:0.9rem;color:var(--text-muted);margin-bottom:20px;"></p>
        
        <p style="margin-bottom:12px;">Add more time for providers to bid:</p>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;">
          <div class="extend-option bid-window-option" data-hours="12" onclick="selectExtendTime(this)">
            <div class="bid-window-time">+12h</div>
          </div>
          <div class="extend-option bid-window-option selected" data-hours="24" onclick="selectExtendTime(this)">
            <div class="bid-window-time">+24h</div>
          </div>
          <div class="extend-option bid-window-option" data-hours="48" onclick="selectExtendTime(this)">
            <div class="bid-window-time">+2 days</div>
          </div>
          <div class="extend-option bid-window-option" data-hours="72" onclick="selectExtendTime(this)">
            <div class="bid-window-time">+3 days</div>
          </div>
        </div>

        <div id="extend-new-deadline" style="margin-top:16px;padding:12px;background:var(--accent-blue-soft);border-radius:var(--radius-md);border:1px solid rgba(74,124,255,0.3);">
          <span style="color:var(--accent-blue);font-size:0.9rem;">New deadline: <strong id="extend-new-time"></strong></span>
        </div>

        <div class="alert" style="background:var(--bg-input);border:1px solid var(--border-subtle);color:var(--text-secondary);margin-top:16px;padding:14px;border-radius:var(--radius-md);font-size:0.88rem;">
          ðŸ’¡ Existing bids will be preserved. Providers who already bid won't be notified.
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('extend-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="confirmExtend()">â±ï¸ Extend Deadline</button>
      </div>
    </div>
  </div>

  <!-- Message Modal -->
  <div class="modal-backdrop" id="message-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="message-modal-title">Message Provider</h3>
        <button class="modal-close" onclick="closeModal('message-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="messages-container" id="message-thread">
          <!-- Messages populated by JS -->
        </div>
        <div class="message-input-row">
          <input type="text" class="form-input" id="message-input" placeholder="Type your message...">
          <button class="btn btn-primary" onclick="sendMessage()">Send</button>
        </div>
        <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border-subtle);">
          <button class="btn btn-ghost" onclick="openReportModal()" style="font-size:0.85rem;color:var(--text-muted);">
            ðŸš© Report policy violation
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Circumvention Modal -->
  <div class="modal-backdrop" id="report-modal">
    <div class="modal" style="max-width:520px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸš© Report Policy Violation</h3>
        <button class="modal-close" onclick="closeModal('report-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="background:var(--accent-gold-soft);border:1px solid rgba(212,168,85,0.3);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;">
          <h4 style="margin-bottom:8px;color:var(--accent-gold);">ðŸ’° Earn a Reward</h4>
          <p style="font-size:0.9rem;color:var(--text-secondary);line-height:1.6;">
            If a provider is trying to take your business outside of My Car Concierge, let us know! 
            Verified reports may qualify for a <strong>reward of up to 25%</strong> of any damages recovered.
          </p>
        </div>

        <div class="form-group">
          <label class="form-label">What happened? <span class="required">*</span></label>
          <select class="form-input" id="report-type" style="cursor:pointer;">
            <option value="">Select violation type...</option>
            <option value="contact_info">Provider shared their contact information</option>
            <option value="solicitation">Provider asked me to contact them directly</option>
            <option value="payment_outside">Provider requested payment outside MCC</option>
            <option value="discount_offer">Provider offered discount to bypass MCC</option>
            <option value="business_card">Provider gave me a business card or flyer</option>
            <option value="other">Other policy violation</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Describe what happened <span class="required">*</span></label>
          <textarea class="form-textarea" id="report-description" placeholder="Please provide details about the violation. Include any specific language the provider used, when it happened, etc." style="min-height:100px;"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Evidence (optional but helps your case)</label>
          <p style="font-size:0.85rem;color:var(--text-muted);margin-bottom:8px;">Upload screenshots of messages, photos of business cards, etc.</p>
          <label class="file-upload" style="padding:20px;cursor:pointer;">
            <div style="text-align:center;">
              <div style="font-size:24px;margin-bottom:8px;">ðŸ“Ž</div>
              <div style="font-size:0.9rem;">Click to upload evidence</div>
            </div>
            <input type="file" id="report-evidence" accept="image/*,.pdf" multiple style="display:none;" onchange="handleReportEvidence(this)">
          </label>
          <div id="report-evidence-list" style="margin-top:8px;"></div>
        </div>

        <label class="checkbox-item" style="width:100%;margin-top:16px;">
          <input type="checkbox" id="report-truthful">
          <span>I confirm this report is truthful and accurate to the best of my knowledge</span>
        </label>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('report-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitReport()">Submit Report</button>
      </div>
    </div>
  </div>

  <!-- Vehicle Details Modal -->
  <div class="modal-backdrop" id="vehicle-details-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title" id="vehicle-details-title">Vehicle Details</h3>
        <button class="modal-close" onclick="closeModal('vehicle-details-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="vehicle-details-body">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Registration Verification Modal -->
  <div class="modal-backdrop" id="registration-modal">
    <div class="modal" style="max-width:520px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“‹ Verify Vehicle Registration</h3>
        <button class="modal-close" onclick="closeModal('registration-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="registration-vehicle-id">
        
        <div id="registration-current-status" style="display:none;margin-bottom:20px;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--border-subtle);">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:8px;">Current Status</div>
          <div id="registration-status-display"></div>
        </div>

        <div style="background:var(--accent-blue-soft);border:1px solid rgba(74,124,255,0.3);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;">
          <h4 style="margin-bottom:8px;color:var(--accent-blue);font-size:0.95rem;">ðŸ“¸ Upload Registration Document</h4>
          <p style="font-size:0.88rem;color:var(--text-secondary);line-height:1.5;">
            Upload a clear photo of your vehicle registration. Our system will verify the vehicle details match your profile.
          </p>
          <p style="font-size:0.8rem;color:var(--text-muted);margin-top:8px;">Accepts JPG, PNG (max 10MB)</p>
        </div>

        <div id="registration-drop-zone" style="border:2px dashed var(--border-medium);border-radius:var(--radius-md);padding:24px;text-align:center;margin-bottom:16px;transition:all 0.2s;cursor:pointer;" ondragover="handleRegistrationDragOver(event)" ondragleave="handleRegistrationDragLeave(event)" ondrop="handleRegistrationDrop(event)" onclick="document.getElementById('registration-gallery-input').click()">
          <div style="font-size:32px;margin-bottom:8px;">ðŸ“„</div>
          <div style="font-weight:500;color:var(--text-primary);">Drag & drop your registration here</div>
          <div style="font-size:0.85rem;color:var(--text-muted);margin-top:4px;">or use the buttons below</div>
        </div>

        <div id="registration-upload-buttons" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
          <button type="button" class="btn" onclick="document.getElementById('registration-camera-input').click()" style="background:var(--accent-gold-soft);border:1px solid var(--accent-gold);color:var(--accent-gold);padding:16px;font-size:1rem;">
            <span style="font-size:24px;margin-right:8px;">ðŸ“·</span> Take Photo
          </button>
          <button type="button" class="btn" onclick="document.getElementById('registration-gallery-input').click()" style="background:var(--accent-blue-soft);border:1px solid var(--accent-blue);color:var(--accent-blue);padding:16px;font-size:1rem;">
            <span style="font-size:24px;margin-right:8px;">ðŸ–¼ï¸</span> Choose from Gallery
          </button>
        </div>
        <input type="file" id="registration-camera-input" accept="image/jpeg,image/png" capture="environment" style="display:none;" onchange="handleRegistrationFileSelect(event)">
        <input type="file" id="registration-gallery-input" accept="image/jpeg,image/png,image/jpg" style="display:none;" onchange="handleRegistrationFileSelect(event)">
        
        <div class="registration-upload-area" id="registration-upload-area" style="display:none;">
          <img id="registration-preview-img" class="registration-preview-img" alt="Registration preview" style="max-width:100%;max-height:300px;border-radius:var(--radius-md);">
        </div>
        
        <div id="registration-file-info" style="display:none;margin-top:12px;padding:12px;background:var(--bg-elevated);border-radius:var(--radius-md);display:flex;align-items:center;gap:12px;">
          <span style="font-size:24px;">ðŸ“„</span>
          <div style="flex:1;">
            <div id="registration-file-name" style="font-weight:500;"></div>
            <div id="registration-file-size" style="font-size:0.82rem;color:var(--text-muted);"></div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="removeRegistrationFile()" style="color:var(--accent-red);">âœ• Remove</button>
        </div>

        <div id="registration-loading" style="display:none;text-align:center;padding:30px;">
          <div style="font-size:32px;margin-bottom:12px;animation:pulse 1.5s infinite;" id="registration-loading-icon">ðŸ“¤</div>
          <div style="font-weight:500;" id="registration-loading-text">Uploading document...</div>
          <div style="font-size:0.88rem;color:var(--text-muted);margin-top:4px;" id="registration-loading-subtext">Please wait</div>
          <div style="margin-top:16px;height:6px;background:var(--bg-elevated);border-radius:3px;overflow:hidden;">
            <div id="registration-progress-bar" style="width:0%;height:100%;background:var(--accent-gold);border-radius:3px;transition:width 0.3s ease;"></div>
          </div>
        </div>

        <div id="registration-result" style="display:none;margin-top:20px;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('registration-modal')">Cancel</button>
        <button class="btn btn-primary" id="verify-registration-btn" onclick="submitRegistrationVerification()" disabled>
          âœ“ Verify Registration
        </button>
      </div>
    </div>
  </div>

  <!-- Dispute Modal -->
  <div class="modal-backdrop" id="dispute-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Open a Dispute</h3>
        <button class="modal-close" onclick="closeModal('dispute-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="dispute-package-id">
        
        <div class="alert" style="background:var(--accent-orange-soft);border:1px solid rgba(245,158,11,0.3);color:var(--accent-orange);margin-bottom:20px;">
          âš ï¸ Opening a dispute will put the payment on hold while our team reviews the issue.
        </div>

        <div class="form-group">
          <label class="form-label">Reason for Dispute</label>
          <select class="form-select" id="dispute-reason">
            <option value="">Select a reason...</option>
            <option value="work_not_started">Work was never started</option>
            <option value="work_incomplete">Work is incomplete</option>
            <option value="poor_quality">Poor quality work</option>
            <option value="overcharged">Overcharged / unexpected fees</option>
            <option value="damage_caused">Provider caused damage to vehicle</option>
            <option value="no_show">Provider no-show</option>
            <option value="other">Other issue</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Describe the Issue</label>
          <textarea class="form-textarea" id="dispute-description" placeholder="Please describe what happened in detail. Include any relevant dates, communications, and specifics about the problem."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Upload Evidence (optional)</label>
          <div style="border:2px dashed var(--border-subtle);border-radius:var(--radius-md);padding:20px;text-align:center;cursor:pointer;">
            <div style="font-size:24px;margin-bottom:8px;">ðŸ“¸</div>
            <div style="color:var(--text-secondary);font-size:0.9rem;">Click to upload photos or videos</div>
            <input type="file" id="dispute-evidence" multiple accept="image/*,video/*" style="display:none;">
          </div>
          <div class="form-hint">Photos of damage, incomplete work, or other evidence will help us resolve your dispute faster.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('dispute-modal')">Cancel</button>
        <button class="btn btn-danger" onclick="submitDispute()">Submit Dispute</button>
      </div>
    </div>
  </div>

  <!-- Support Ticket Modal -->
  <div class="modal-backdrop" id="support-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Contact Support</h3>
        <button class="modal-close" onclick="closeModal('support-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="support-category">
            <option value="account">Account Issue</option>
            <option value="payment">Payment / Billing</option>
            <option value="technical">Technical Problem</option>
            <option value="feedback">Feedback / Suggestion</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Subject</label>
          <input type="text" class="form-input" id="support-subject" placeholder="Brief description of your issue">
        </div>

        <div class="form-group">
          <label class="form-label">Message</label>
          <textarea class="form-textarea" id="support-message" placeholder="Describe your issue or question in detail..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('support-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitSupportTicket()">Submit</button>
      </div>
    </div>
  </div>

  <!-- Schedule Appointment Modal -->
  <div class="modal-backdrop" id="schedule-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“… Schedule Service Appointment</h3>
        <button class="modal-close" onclick="closeModal('schedule-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="schedule-package-id">
        <input type="hidden" id="schedule-member-id">
        <input type="hidden" id="schedule-provider-id">
        
        <div class="form-group">
          <label class="form-label">Preferred Date *</label>
          <input type="date" class="form-input" id="schedule-date" min="">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Time</label>
            <input type="time" class="form-input" id="schedule-time-start" value="09:00">
          </div>
          <div class="form-group">
            <label class="form-label">End Time (optional)</label>
            <input type="time" class="form-input" id="schedule-time-end" value="17:00">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Estimated Duration (days)</label>
          <select class="form-select" id="schedule-duration">
            <option value="">Not sure</option>
            <option value="1">Same day</option>
            <option value="2">1-2 days</option>
            <option value="3">2-3 days</option>
            <option value="5">Up to a week</option>
            <option value="7">More than a week</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Notes for Provider</label>
          <textarea class="form-textarea" id="schedule-notes" placeholder="Any special instructions, preferred drop-off time, etc."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('schedule-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitScheduleProposal()">Send Proposal</button>
      </div>
    </div>
  </div>

  <!-- Counter Proposal Modal -->
  <div class="modal-backdrop" id="counter-proposal-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“… Propose Different Time</h3>
        <button class="modal-close" onclick="closeModal('counter-proposal-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="counter-appointment-id">
        <input type="hidden" id="counter-package-id">
        
        <div style="background:var(--bg-input);padding:16px;border-radius:var(--radius-md);margin-bottom:20px;">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:4px;">Originally proposed:</div>
          <div id="counter-original-time" style="font-weight:500;"></div>
        </div>
        
        <div class="form-group">
          <label class="form-label">New Preferred Date *</label>
          <input type="date" class="form-input" id="counter-date" min="">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">New Start Time</label>
            <input type="time" class="form-input" id="counter-time-start" value="09:00">
          </div>
          <div class="form-group">
            <label class="form-label">New End Time (optional)</label>
            <input type="time" class="form-input" id="counter-time-end" value="17:00">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Reason for Change</label>
          <textarea class="form-textarea" id="counter-notes" placeholder="Why does this time work better for you?"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('counter-proposal-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitCounterProposal()">Send Counter Proposal</button>
      </div>
    </div>
  </div>

  <!-- Transfer Setup Modal -->
  <div class="modal-backdrop" id="transfer-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸš— Setup Vehicle Transfer</h3>
        <button class="modal-close" onclick="closeModal('transfer-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="transfer-package-id">
        <input type="hidden" id="transfer-member-id">
        <input type="hidden" id="transfer-provider-id">
        <input type="hidden" id="selected-transfer-type" value="">
        
        <div class="form-group">
          <label class="form-label">Transfer Method *</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div class="transfer-type-option" onclick="selectTransferType('member_dropoff')" data-transfer-type="member_dropoff" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;cursor:pointer;text-align:center;transition:all 0.15s;">
              <div style="font-size:24px;margin-bottom:8px;">ðŸš™</div>
              <div style="font-weight:600;margin-bottom:4px;">Drop-off</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">I'll bring my car to the shop</div>
            </div>
            <div class="transfer-type-option" onclick="selectTransferType('provider_pickup')" data-transfer-type="provider_pickup" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;cursor:pointer;text-align:center;transition:all 0.15s;">
              <div style="font-size:24px;margin-bottom:8px;">ðŸ </div>
              <div style="font-weight:600;margin-bottom:4px;">Pickup</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Provider picks up from me</div>
            </div>
            <div class="transfer-type-option" onclick="selectTransferType('mobile_service')" data-transfer-type="mobile_service" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;cursor:pointer;text-align:center;transition:all 0.15s;">
              <div style="font-size:24px;margin-bottom:8px;">ðŸ”§</div>
              <div style="font-weight:600;margin-bottom:4px;">Mobile Service</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Work done at my location</div>
            </div>
            <div class="transfer-type-option" onclick="selectTransferType('towing')" data-transfer-type="towing" style="background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);padding:16px;cursor:pointer;text-align:center;transition:all 0.15s;">
              <div style="font-size:24px;margin-bottom:8px;">ðŸš›</div>
              <div style="font-weight:600;margin-bottom:4px;">Towing</div>
              <div style="font-size:0.8rem;color:var(--text-muted);">Vehicle needs to be towed</div>
            </div>
          </div>
        </div>

        <div id="transfer-address-section" style="display:none;">
          <div class="form-group">
            <label class="form-label">Pickup Address *</label>
            <input type="text" class="form-input" id="transfer-pickup-address" placeholder="Street address for pickup">
          </div>
          <div class="form-group">
            <label class="form-label">Pickup Notes</label>
            <input type="text" class="form-input" id="transfer-pickup-notes" placeholder="Gate code, parking spot, etc.">
          </div>
          <div class="form-group">
            <label class="form-label">Return Address (if different)</label>
            <input type="text" class="form-input" id="transfer-return-address" placeholder="Leave empty if same as pickup">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Special Instructions</label>
          <textarea class="form-textarea" id="transfer-special-instructions" placeholder="Any special instructions for vehicle handling..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('transfer-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitTransferSetup()">Setup Transfer</button>
      </div>
    </div>
  </div>

  <!-- Location Share Modal -->
  <div class="modal-backdrop" id="location-share-modal">
    <div class="modal" style="max-width:450px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“ Share Your Location</h3>
        <button class="modal-close" onclick="closeModal('location-share-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="location-share-package-id">
        <input type="hidden" id="location-share-provider-id">
        
        <div style="text-align:center;padding:20px 0;">
          <div style="font-size:48px;margin-bottom:16px;">ðŸ“</div>
          <p style="color:var(--text-secondary);margin-bottom:16px;">Share your current location with the provider so they can find you for pickup or delivery.</p>
          <div style="background:var(--bg-input);padding:12px;border-radius:var(--radius-md);font-size:0.85rem;color:var(--text-muted);">
            Your location will only be visible to this provider and will expire after 24 hours.
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Add a message (optional)</label>
          <input type="text" class="form-input" id="location-share-message" placeholder="e.g., I'm in the parking lot by the blue car">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('location-share-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="confirmShareLocation()">ðŸ“ Share Location</button>
      </div>
    </div>
  </div>

  <!-- View Shared Location Modal -->
  <div class="modal-backdrop" id="view-location-modal">
    <div class="modal" style="max-width:500px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“ Provider Location</h3>
        <button class="modal-close" onclick="closeModal('view-location-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="view-location-body">
        <!-- Populated by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('view-location-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div class="modal-backdrop" id="review-modal">
    <div class="modal" style="max-width:550px;">
      <div class="modal-header">
        <h3 class="modal-title">Leave a Review</h3>
        <button class="modal-close" onclick="skipReview()">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:24px;">
          <div style="font-size:48px;margin-bottom:8px;">â­</div>
          <h3 id="review-provider-name" style="margin-bottom:4px;">Provider Name</h3>
          <div style="color:var(--text-muted);font-size:0.9rem;">
            <span id="review-service-title">Service</span> â€¢ <span id="review-amount">$0</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Overall Rating *</label>
          <div class="star-rating" data-type="overall" data-value="5">
            <span class="star active" onclick="setRating('overall', 1)">â˜…</span>
            <span class="star active" onclick="setRating('overall', 2)">â˜…</span>
            <span class="star active" onclick="setRating('overall', 3)">â˜…</span>
            <span class="star active" onclick="setRating('overall', 4)">â˜…</span>
            <span class="star active" onclick="setRating('overall', 5)">â˜…</span>
          </div>
        </div>

        <div class="form-group" id="complaint-reason-group" style="display:none;">
          <label class="form-label">What was the main issue? *</label>
          <select class="form-select" id="complaint-reason" onchange="handleComplaintReasonChange()">
            <option value="">Select a reason...</option>
            <option value="poor_quality">Poor Quality of Work</option>
            <option value="incomplete_work">Incomplete or Unfinished Work</option>
            <option value="damage_caused">Damage Caused to Vehicle</option>
            <option value="overcharged">Overcharged / Unexpected Fees</option>
            <option value="late_delivery">Late Delivery / Missed Deadline</option>
            <option value="poor_communication">Poor Communication</option>
            <option value="unprofessional">Unprofessional Behavior</option>
            <option value="no_show">No Show / Missed Appointment</option>
            <option value="dishonest">Dishonest or Misleading</option>
            <option value="bait_switch">Bait and Switch Tactics</option>
            <option value="safety_concern">Safety Concern</option>
            <option value="other">Other</option>
          </select>
          <input type="text" class="form-input" id="complaint-reason-other" placeholder="Please specify..." style="display:none;margin-top:8px;">
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label" style="font-size:0.85rem;">Quality of Work</label>
            <div class="star-rating small" data-type="quality" data-value="5">
              <span class="star active" onclick="setRating('quality', 1)">â˜…</span>
              <span class="star active" onclick="setRating('quality', 2)">â˜…</span>
              <span class="star active" onclick="setRating('quality', 3)">â˜…</span>
              <span class="star active" onclick="setRating('quality', 4)">â˜…</span>
              <span class="star active" onclick="setRating('quality', 5)">â˜…</span>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label" style="font-size:0.85rem;">Communication</label>
            <div class="star-rating small" data-type="communication" data-value="5">
              <span class="star active" onclick="setRating('communication', 1)">â˜…</span>
              <span class="star active" onclick="setRating('communication', 2)">â˜…</span>
              <span class="star active" onclick="setRating('communication', 3)">â˜…</span>
              <span class="star active" onclick="setRating('communication', 4)">â˜…</span>
              <span class="star active" onclick="setRating('communication', 5)">â˜…</span>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label" style="font-size:0.85rem;">Timeliness</label>
            <div class="star-rating small" data-type="timeliness" data-value="5">
              <span class="star active" onclick="setRating('timeliness', 1)">â˜…</span>
              <span class="star active" onclick="setRating('timeliness', 2)">â˜…</span>
              <span class="star active" onclick="setRating('timeliness', 3)">â˜…</span>
              <span class="star active" onclick="setRating('timeliness', 4)">â˜…</span>
              <span class="star active" onclick="setRating('timeliness', 5)">â˜…</span>
            </div>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label" style="font-size:0.85rem;">Value for Money</label>
            <div class="star-rating small" data-type="value" data-value="5">
              <span class="star active" onclick="setRating('value', 1)">â˜…</span>
              <span class="star active" onclick="setRating('value', 2)">â˜…</span>
              <span class="star active" onclick="setRating('value', 3)">â˜…</span>
              <span class="star active" onclick="setRating('value', 4)">â˜…</span>
              <span class="star active" onclick="setRating('value', 5)">â˜…</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Review Title (optional)</label>
          <input type="text" class="form-input" id="review-title" placeholder="Summarize your experience">
        </div>

        <div class="form-group">
          <label class="form-label">Your Review (optional)</label>
          <textarea class="form-textarea" id="review-text" placeholder="Tell others about your experience with this provider..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="skipReview()">Skip for Now</button>
        <button class="btn btn-primary" onclick="submitReview()">Submit Review</button>
      </div>
    </div>
  </div>

  <!-- Vehicle Assistant Modal -->
  <div class="modal-backdrop" id="vehicle-assistant-modal">
    <div class="modal wide" style="max-width: 700px;">
      <div class="modal-header" style="background: linear-gradient(135deg, var(--accent-blue-soft), rgba(74, 124, 255, 0.05));">
        <h3 class="modal-title">ðŸ¤– Vehicle Assistant</h3>
        <button class="modal-close" onclick="closeModal('vehicle-assistant-modal')">Ã—</button>
      </div>
      <div class="modal-body" style="padding: 0;">
        <div style="background: rgba(245, 158, 11, 0.12); border-bottom: 1px solid rgba(245, 158, 11, 0.3); padding: 14px 24px; display: flex; gap: 12px; align-items: flex-start;">
          <span style="font-size: 20px;">âš ï¸</span>
          <p style="font-size: 0.85rem; color: var(--accent-orange); margin: 0; line-height: 1.5;">
            <strong>Important:</strong> This is an AI-powered informational tool only. It is NOT a substitute for diagnosis by a trained mechanic. Actual costs, issues, and recommendations may vary significantly. Always consult a professional.
          </p>
        </div>
        
        <div style="padding: 24px;">
          <div id="va-stepper" style="display: flex; justify-content: center; margin-bottom: 28px;">
            <div class="va-step active" data-step="1">
              <div class="va-step-circle">1</div>
              <span>Type & Vehicle</span>
            </div>
            <div class="va-step-line"></div>
            <div class="va-step" data-step="2">
              <div class="va-step-circle">2</div>
              <span>Describe</span>
            </div>
            <div class="va-step-line"></div>
            <div class="va-step" data-step="3">
              <div class="va-step-circle">3</div>
              <span>Media</span>
            </div>
            <div class="va-step-line"></div>
            <div class="va-step" data-step="4">
              <div class="va-step-circle">4</div>
              <span>Assessment</span>
            </div>
          </div>

          <div id="va-step-1" class="va-content">
            <div class="form-group">
              <label class="form-label" style="font-size: 1rem; margin-bottom: 16px;">What do you need help with?</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="va-type-card selected" data-type="diagnostic" onclick="selectVaType('diagnostic')">
                  <div style="font-size: 32px; margin-bottom: 12px;">ðŸ”§</div>
                  <div style="font-weight: 600; margin-bottom: 4px;">Diagnose an Issue</div>
                  <div style="font-size: 0.85rem; color: var(--text-muted);">Strange sounds, warning lights, performance problems</div>
                </div>
                <div class="va-type-card" data-type="custom" onclick="selectVaType('custom')">
                  <div style="font-size: 32px; margin-bottom: 12px;">âœ¨</div>
                  <div style="font-weight: 600; margin-bottom: 4px;">Describe Custom Work</div>
                  <div style="font-size: 0.85rem; color: var(--text-muted);">Cosmetic upgrades, modifications, custom requests</div>
                </div>
              </div>
            </div>
            <div class="form-group" style="margin-top: 24px;">
              <label class="form-label">Select Your Vehicle</label>
              <select class="form-select" id="va-vehicle-select">
                <option value="">Choose a vehicle from your garage...</option>
              </select>
            </div>
          </div>

          <div id="va-step-2" class="va-content" style="display: none;">
            <div class="form-group">
              <label class="form-label" id="va-description-label">Describe the Issue</label>
              <textarea class="form-textarea" id="va-description" rows="5" placeholder="Be as detailed as possible. What do you see, hear, or feel? When did it start?"></textarea>
            </div>
            <div id="va-symptoms-section">
              <label class="form-label">Common Symptoms (check all that apply)</label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 12px;">
                <label class="va-checkbox"><input type="checkbox" value="warning_light"> Warning light on dashboard</label>
                <label class="va-checkbox"><input type="checkbox" value="strange_noise"> Strange noises</label>
                <label class="va-checkbox"><input type="checkbox" value="vibration"> Vibration or shaking</label>
                <label class="va-checkbox"><input type="checkbox" value="smell"> Unusual smell</label>
                <label class="va-checkbox"><input type="checkbox" value="leak"> Leaking fluid</label>
                <label class="va-checkbox"><input type="checkbox" value="performance"> Performance issues</label>
                <label class="va-checkbox"><input type="checkbox" value="starting"> Starting problems</label>
                <label class="va-checkbox"><input type="checkbox" value="brakes"> Brake issues</label>
              </div>
            </div>
          </div>

          <div id="va-step-3" class="va-content" style="display: none;">
            <div class="form-group">
              <label class="form-label">Upload Photos, Videos, or Audio (Optional)</label>
              <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 16px;">Adding media helps get a more accurate assessment.</p>
              <div class="va-media-upload" onclick="document.getElementById('va-media-input').click()">
                <div style="font-size: 40px; margin-bottom: 12px;">ðŸ“·</div>
                <div style="font-weight: 500;">Click to upload files</div>
                <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 8px;">Photos, videos, audio â€¢ Max 10MB per file â€¢ Up to 5 files</div>
              </div>
              <input type="file" id="va-media-input" accept="image/*,video/*,audio/*" multiple style="display: none;" onchange="handleVaMediaSelect(event)">
              <div id="va-media-preview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-top: 16px;"></div>
              <div id="va-upload-status" style="margin-top: 12px; font-size: 0.85rem; color: var(--text-muted);"></div>
            </div>
          </div>

          <div id="va-step-4" class="va-content" style="display: none;">
            <div id="va-loading" style="text-align: center; padding: 40px;">
              <div class="va-spinner"></div>
              <p style="margin-top: 16px; color: var(--text-muted);">Analyzing your request...</p>
            </div>
            <div id="va-result" style="display: none;">
              <div id="va-severity-badge" style="margin-bottom: 20px;"></div>
              
              <div class="va-result-card">
                <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">ðŸ“‹ Assessment</h4>
                <p id="va-assessment-text" style="line-height: 1.6; color: var(--text-secondary);"></p>
              </div>

              <div class="va-result-card" style="margin-top: 16px;">
                <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 16px;">ðŸ’° Estimated Costs</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <div style="background: var(--bg-input); padding: 16px; border-radius: var(--radius-md);">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 4px;">Parts</div>
                    <div id="va-parts-cost" style="font-size: 1.2rem; font-weight: 600; color: var(--accent-gold);"></div>
                  </div>
                  <div style="background: var(--bg-input); padding: 16px; border-radius: var(--radius-md);">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 4px;">Labor</div>
                    <div id="va-labor-cost" style="font-size: 1.2rem; font-weight: 600; color: var(--accent-blue);"></div>
                  </div>
                </div>
                <div style="margin-top: 16px; padding: 12px; background: var(--bg-input); border-radius: var(--radius-md); text-align: center;">
                  <span style="font-size: 0.85rem; color: var(--text-muted);">Total Estimate:</span>
                  <span id="va-total-cost" style="font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-left: 8px;"></span>
                </div>
              </div>

              <div id="va-safety-warnings" style="margin-top: 16px; display: none;">
                <div class="va-result-card" style="background: rgba(239, 95, 95, 0.1); border-color: rgba(239, 95, 95, 0.3);">
                  <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px; color: var(--accent-red);">âš ï¸ Safety Warnings</h4>
                  <ul id="va-warnings-list" style="margin: 0; padding-left: 20px; color: var(--accent-red);"></ul>
                </div>
              </div>

              <div id="va-recommendations" style="margin-top: 16px;">
                <div class="va-result-card">
                  <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">ðŸ”§ Recommended Services</h4>
                  <div id="va-services-list" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
              </div>

              <div style="background: rgba(245, 158, 11, 0.08); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: var(--radius-md); padding: 14px; margin-top: 20px;">
                <p id="va-disclaimer-text" style="font-size: 0.85rem; color: var(--accent-orange); margin: 0; line-height: 1.5;"></p>
              </div>

              <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-subtle);">
                <button class="btn btn-primary" onclick="createServiceRequestFromAssessment()" style="width: 100%; padding: 14px; font-size: 1rem;">
                  ðŸ“ Create Service Request with This Assessment
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="va-footer">
        <button class="btn btn-secondary" id="va-back-btn" onclick="vaGoBack()" style="display: none;">â† Back</button>
        <button class="btn btn-primary" id="va-next-btn" onclick="vaGoNext()">Next â†’</button>
      </div>
    </div>
  </div>

  <style>
    .va-step { display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0.5; }
    .va-step.active { opacity: 1; }
    .va-step.completed { opacity: 1; }
    .va-step-circle { width: 32px; height: 32px; border-radius: 50%; background: var(--bg-input); border: 2px solid var(--border-subtle); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.85rem; }
    .va-step.active .va-step-circle { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
    .va-step.completed .va-step-circle { background: var(--accent-green); border-color: var(--accent-green); color: white; }
    .va-step span { font-size: 0.78rem; color: var(--text-muted); }
    .va-step.active span { color: var(--text-primary); }
    .va-step-line { width: 60px; height: 2px; background: var(--border-subtle); margin-top: 16px; }
    
    .va-type-card { background: var(--bg-input); border: 2px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s ease; }
    .va-type-card:hover { border-color: var(--border-medium); }
    .va-type-card.selected { border-color: var(--accent-blue); background: var(--accent-blue-soft); }
    
    .va-checkbox { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); cursor: pointer; font-size: 0.88rem; }
    .va-checkbox:hover { border-color: var(--border-medium); }
    .va-checkbox input { width: 18px; height: 18px; accent-color: var(--accent-blue); }
    
    .va-media-upload { border: 2px dashed var(--border-subtle); border-radius: var(--radius-lg); padding: 40px; text-align: center; cursor: pointer; transition: all 0.2s ease; }
    .va-media-upload:hover { border-color: var(--accent-blue); background: var(--accent-blue-soft); }
    
    .va-media-item { position: relative; aspect-ratio: 1; border-radius: var(--radius-md); overflow: hidden; background: var(--bg-input); }
    .va-media-item img, .va-media-item video { width: 100%; height: 100%; object-fit: cover; }
    .va-media-item .va-media-remove { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(0,0,0,0.7); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .va-media-item .va-media-remove:hover { background: var(--accent-red); }
    .va-media-item .va-audio-icon { display: flex; align-items: center; justify-content: center; height: 100%; font-size: 32px; }
    
    .va-result-card { background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px; }
    
    .va-severity { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 100px; font-weight: 600; font-size: 0.88rem; }
    .va-severity.low { background: var(--accent-green-soft); color: var(--accent-green); }
    .va-severity.medium { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .va-severity.high { background: rgba(239, 95, 95, 0.15); color: var(--accent-red); }
    .va-severity.critical { background: rgba(239, 95, 95, 0.25); color: #ff4444; }
    .va-severity.cosmetic { background: var(--accent-blue-soft); color: var(--accent-blue); }
    
    .va-service-tag { background: var(--bg-elevated); border: 1px solid var(--border-subtle); padding: 6px 12px; border-radius: 100px; font-size: 0.82rem; color: var(--text-secondary); }
    
    .va-spinner { width: 40px; height: 40px; border: 3px solid var(--border-subtle); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <!-- Create Reminder Modal -->
  <div class="modal-backdrop" id="create-reminder-modal">
    <div class="modal" style="max-width:550px;">
      <div class="modal-header">
        <h3 class="modal-title">Create Reminder</h3>
        <button class="modal-close" onclick="closeModal('create-reminder-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Vehicle *</label>
          <select class="form-select" id="reminder-vehicle">
            <option value="">Select a vehicle...</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Reminder Title *</label>
          <input type="text" class="form-input" id="reminder-title-input" placeholder="e.g., Brake pad replacement">
        </div>

        <div class="form-group">
          <label class="form-label">Reminder Type *</label>
          <select class="form-select" id="reminder-type-select">
            <option value="maintenance">Maintenance</option>
            <option value="inspection">Inspection</option>
            <option value="tire_rotation">Tire Rotation</option>
            <option value="brake_check">Brake Check</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Due Type *</label>
          <div style="display:flex;gap:12px;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input type="radio" name="reminder-due-type" value="date" checked onchange="toggleReminderDueType()"> Due Date
            </label>
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input type="radio" name="reminder-due-type" value="mileage" onchange="toggleReminderDueType()"> Due Mileage
            </label>
          </div>
        </div>

        <div class="form-group" id="reminder-date-group">
          <label class="form-label">Due Date</label>
          <input type="date" class="form-input" id="reminder-due-date">
        </div>

        <div class="form-group" id="reminder-mileage-group" style="display:none;">
          <label class="form-label">Due Mileage</label>
          <input type="number" class="form-input" id="reminder-due-mileage" placeholder="e.g., 60000">
        </div>

        <div class="form-group">
          <label class="form-label">Notes (optional)</label>
          <textarea class="form-textarea" id="reminder-notes" placeholder="Add any additional notes..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('create-reminder-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveReminder()">Create Reminder</button>
      </div>
    </div>
  </div>

  <!-- Member Evidence Capture Modal -->
  <div class="modal-backdrop" id="member-evidence-modal">
    <div class="modal" style="max-width:640px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“¸ <span id="member-evidence-modal-title">Document Vehicle Condition</span></h3>
        <button class="modal-close" onclick="closeModal('member-evidence-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="member-evidence-package-id">
        <input type="hidden" id="member-evidence-type">
        
        <div class="alert" style="background:var(--accent-blue-soft);border:1px solid rgba(74,124,255,0.3);color:var(--accent-blue);margin-bottom:20px;padding:16px;border-radius:var(--radius-md);">
          ðŸ“¸ Document your vehicle's condition before pickup for your protection.
        </div>

        <div class="form-group">
          <label class="form-label">Photos (up to 10) *</label>
          <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px;" id="member-evidence-photo-preview"></div>
          <input type="file" id="member-evidence-photos" accept="image/*" multiple onchange="previewMemberEvidencePhotos()" style="display:none;">
          <button type="button" class="btn btn-secondary" onclick="document.getElementById('member-evidence-photos').click()">ðŸ“· Add Photos</button>
          <p class="form-hint">Take photos of vehicle condition, odometer, fuel gauge</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Odometer Reading *</label>
            <input type="number" class="form-input" id="member-evidence-odometer" placeholder="e.g., 45230" required>
          </div>
          <div class="form-group">
            <label class="form-label">Fuel Level *</label>
            <select class="form-input" id="member-evidence-fuel" required>
              <option value="">Select...</option>
              <option value="empty">Empty</option>
              <option value="1/4">1/4</option>
              <option value="1/2">1/2</option>
              <option value="3/4">3/4</option>
              <option value="full">Full</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Exterior Condition</label>
          <textarea class="form-textarea" id="member-evidence-exterior" placeholder="Note any scratches, dents, or damage on the exterior..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Interior Condition</label>
          <textarea class="form-textarea" id="member-evidence-interior" placeholder="Note interior condition, cleanliness, any damage..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">General Notes</label>
          <textarea class="form-textarea" id="member-evidence-notes" placeholder="Any additional observations..."></textarea>
        </div>

        <div id="member-evidence-upload-status" style="display:none;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);margin-top:16px;"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('member-evidence-modal')">Cancel</button>
        <button class="btn btn-primary" id="submit-member-evidence-btn" onclick="submitMemberEvidence()">ðŸ“¸ Save Evidence</button>
      </div>
    </div>
  </div>


  <!-- Emergency Request Modal -->
  <div class="modal-backdrop" id="emergency-request-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸš¨ Request Emergency Help</h3>
        <button class="modal-close" onclick="closeModal('emergency-request-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="emergency-location-status" style="background:var(--bg-input);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;display:flex;align-items:center;gap:12px;">
          <span style="font-size:24px;">ðŸ“</span>
          <div>
            <div id="emergency-location-text" style="font-weight:500;">Getting your location...</div>
            <div id="emergency-address-text" style="font-size:0.85rem;color:var(--text-muted);"></div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Select Vehicle (Optional)</label>
          <select class="form-select" id="emergency-vehicle"></select>
        </div>

        <div class="form-group">
          <label class="form-label">What's the emergency? *</label>
          <select class="form-select" id="emergency-type" required onchange="handleEmergencyTypeChange()">
            <option value="">Select emergency type...</option>
            <option value="flat_tire">ðŸ›ž Flat Tire</option>
            <option value="dead_battery">ðŸ”‹ Dead Battery / Jump Start</option>
            <option value="lockout">ðŸ” Locked Out of Vehicle</option>
            <option value="tow_needed">ðŸš› Need a Tow</option>
            <option value="fuel_delivery">â›½ Out of Fuel</option>
            <option value="accident">ðŸ’¥ Accident / Collision</option>
            <option value="other">â“ Other Emergency</option>
          </select>
        </div>

        <div class="form-group" id="tow-distance-group" style="display:none;">
          <label class="form-label">Estimated tow distance (miles)</label>
          <input type="number" class="form-input" id="emergency-tow-miles" value="10" min="1" max="500" oninput="updateEmergencyPricePreview()">
          <p class="form-hint">Base rate covers up to 10 miles. Additional miles charged at $6/mile.</p>
        </div>

        <div id="emergency-price-preview" style="display:none;background:var(--accent-gold-soft);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;">
          <div style="font-weight:600;margin-bottom:8px;">ðŸ’° Estimated Cost</div>
          <div style="display:flex;justify-content:space-between;font-size:0.9rem;margin-bottom:4px;">
            <span>Activation Fee:</span>
            <span>$25.00</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:0.9rem;margin-bottom:8px;">
            <span>Service Escrow:</span>
            <span id="emergency-escrow-preview">$0.00</span>
          </div>
          <div style="display:flex;justify-content:space-between;font-weight:600;padding-top:8px;border-top:1px solid var(--border-subtle);">
            <span>Total Pre-Authorization:</span>
            <span id="emergency-total-preview">$25.00</span>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Describe the situation</label>
          <textarea class="form-textarea" id="emergency-description" placeholder="Any additional details that would help the provider..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Photos (Optional - up to 5)</label>
          <div class="photo-upload-area" onclick="document.getElementById('emergency-photo-input').click()">
            <div class="photo-upload-icon">ðŸ“¸</div>
            <div class="photo-upload-text">Tap to add photos</div>
            <div class="photo-upload-hint">Take photos of the issue or your location</div>
          </div>
          <input type="file" id="emergency-photo-input" accept="image/*" multiple style="display:none;" onchange="handleEmergencyPhotos(this)">
          <div id="emergency-photo-previews" class="emergency-photos"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('emergency-request-modal')">Cancel</button>
        <button class="btn" style="background:linear-gradient(135deg, #ef5f5f, #ff4444);color:white;" onclick="submitEmergencyRequest()">ðŸš¨ Request Help Now</button>
      </div>
    </div>
  </div>

  <!-- Emergency Status Modal -->
  <div class="modal-backdrop" id="emergency-status-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸš¨ Emergency Status</h3>
        <button class="modal-close" onclick="closeModal('emergency-status-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="emergency-status-content">
          <div style="text-align:center;padding:40px;">
            <div style="font-size:48px;margin-bottom:16px;">â³</div>
            <div style="color:var(--text-muted);">Loading...</div>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="emergency-status-footer"></div>
    </div>
  </div>

  <!-- Emergency Payment Authorization Modal -->
  <div class="modal-backdrop" id="emergency-payment-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ’³ Emergency Service Authorization</h3>
        <button class="modal-close" onclick="closeModal('emergency-payment-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:24px;">
          <div style="font-size:48px;margin-bottom:12px;">ðŸš¨</div>
          <div style="font-size:1.1rem;font-weight:600;">Confirm Emergency Request</div>
          <div style="color:var(--text-secondary);margin-top:4px;">Payment authorization required</div>
        </div>

        <div style="background:var(--bg-input);border-radius:var(--radius-md);padding:20px;margin-bottom:20px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
            <span style="color:var(--text-secondary);">Activation Fee (non-refundable):</span>
            <span style="font-weight:600;">$25.00</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
            <span style="color:var(--text-secondary);">Service Escrow:</span>
            <span style="font-weight:600;" id="payment-modal-escrow">$0.00</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding-top:12px;border-top:1px solid var(--border-subtle);">
            <span style="font-weight:600;">Total Pre-Authorization:</span>
            <span style="font-weight:700;font-size:1.2rem;color:var(--accent-gold);" id="payment-modal-total">$25.00</span>
          </div>
        </div>

        <div style="background:var(--accent-blue-soft);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;">
          <div style="display:flex;gap:12px;">
            <span style="font-size:20px;">â„¹ï¸</span>
            <div style="font-size:0.9rem;color:var(--text-secondary);line-height:1.5;">
              <strong style="color:var(--text-primary);">Your card will be charged $25.00 immediately.</strong><br>
              An additional <span id="payment-modal-escrow-text">$0.00</span> will be held until service is complete. 
              The escrow is only captured when you confirm the service is done. If no provider responds, the escrow hold will be released.
            </div>
          </div>
        </div>

        <div style="background:rgba(239, 95, 95, 0.1);border:1px solid rgba(239, 95, 95, 0.3);border-radius:var(--radius-md);padding:16px;">
          <div style="display:flex;gap:12px;">
            <span style="font-size:20px;">âš ï¸</span>
            <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.5;">
              The $25 activation fee is <strong style="color:var(--accent-red);">non-refundable</strong> once a provider claims your request.
              Providers will have 5 minutes to claim your emergency.
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('emergency-payment-modal')">Cancel</button>
        <button class="btn" style="background:linear-gradient(135deg, #ef5f5f, #ff4444);color:white;" onclick="confirmEmergencyPayment()">ðŸ’³ Authorize & Request Help</button>
      </div>
    </div>
  </div>

  <!-- Add Fleet Employee Modal -->
  <div class="modal-backdrop" id="add-fleet-employee-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Fleet Employee</h3>
        <button class="modal-close" onclick="closeModal('add-fleet-employee-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Email Address *</label>
          <input type="email" class="form-input" id="fleet-employee-email" placeholder="employee@company.com">
          <p class="form-hint">They'll receive an invitation to join your fleet.</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">Role *</label>
          <select class="form-select" id="fleet-employee-role">
            <option value="driver">Driver - Can request services for assigned vehicles</option>
            <option value="manager">Manager - Can manage vehicles and approve services</option>
            <option value="viewer">Viewer - View-only access to fleet information</option>
          </select>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Employee ID</label>
            <input type="text" class="form-input" id="fleet-employee-id" placeholder="e.g., EMP-001">
          </div>
          <div class="form-group">
            <label class="form-label">Department</label>
            <input type="text" class="form-input" id="fleet-employee-dept" placeholder="e.g., Sales">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Spending Limit (per service)</label>
          <div style="display:flex;align-items:center;gap:8px;">
            <span style="color:var(--text-muted);">$</span>
            <input type="number" class="form-input" id="fleet-employee-spending-limit" placeholder="No limit" style="max-width:150px;">
          </div>
          <p class="form-hint">Leave empty for no spending limit.</p>
        </div>
        
        <div class="form-group">
          <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
            <input type="checkbox" id="fleet-employee-requires-approval">
            <span>Requires approval for all service requests</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('add-fleet-employee-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="addFleetEmployee()">Add Employee</button>
      </div>
    </div>
  </div>

  <!-- Edit Fleet Employee Modal -->
  <div class="modal-backdrop" id="edit-fleet-employee-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Fleet Employee</h3>
        <button class="modal-close" onclick="closeModal('edit-fleet-employee-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="edit-fleet-employee-content"></div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="removeFleetEmployee()">Remove from Fleet</button>
        <button class="btn btn-primary" onclick="saveFleetEmployee()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Add Fleet Vehicle Modal -->
  <div class="modal-backdrop" id="add-fleet-vehicle-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Add Vehicle to Fleet</h3>
        <button class="modal-close" onclick="closeModal('add-fleet-vehicle-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Select Vehicle *</label>
          <select class="form-select" id="fleet-vehicle-select">
            <option value="">Choose a vehicle from your garage...</option>
          </select>
          <p class="form-hint">Or <a href="#" onclick="openVehicleModal();closeModal('add-fleet-vehicle-modal');" style="color:var(--accent-gold);">add a new vehicle</a> first.</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">Assigned Driver</label>
          <select class="form-select" id="fleet-vehicle-driver">
            <option value="">No assigned driver (Pool vehicle)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Assignment Type *</label>
          <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;">
            <label class="fleet-assignment-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
              <input type="radio" name="fleet-assignment-type" value="permanent" style="display:none;">
              <span style="font-size:24px;margin-bottom:8px;">ðŸ”’</span>
              <span style="font-weight:500;">Permanent</span>
              <span style="font-size:0.75rem;color:var(--text-muted);">Long-term assignment</span>
            </label>
            <label class="fleet-assignment-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
              <input type="radio" name="fleet-assignment-type" value="temporary" style="display:none;">
              <span style="font-size:24px;margin-bottom:8px;">â±ï¸</span>
              <span style="font-weight:500;">Temporary</span>
              <span style="font-size:0.75rem;color:var(--text-muted);">Short-term use</span>
            </label>
            <label class="fleet-assignment-option" style="display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-input);border:2px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;transition:all 0.2s;">
              <input type="radio" name="fleet-assignment-type" value="pool" checked style="display:none;">
              <span style="font-size:24px;margin-bottom:8px;">ðŸ”„</span>
              <span style="font-weight:500;">Pool</span>
              <span style="font-size:0.75rem;color:var(--text-muted);">Shared vehicle</span>
            </label>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Department / Cost Center</label>
            <input type="text" class="form-input" id="fleet-vehicle-dept" placeholder="e.g., Sales">
          </div>
        </div>
        
        <div class="form-row" id="fleet-vehicle-dates-row" style="display:none;">
          <div class="form-group">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-input" id="fleet-vehicle-start-date">
          </div>
          <div class="form-group">
            <label class="form-label">End Date</label>
            <input type="date" class="form-input" id="fleet-vehicle-end-date">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('add-fleet-vehicle-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="addVehicleToFleet()">Add to Fleet</button>
      </div>
    </div>
  </div>

  <!-- Edit Fleet Vehicle Modal -->
  <div class="modal-backdrop" id="edit-fleet-vehicle-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Fleet Vehicle Assignment</h3>
        <button class="modal-close" onclick="closeModal('edit-fleet-vehicle-modal')">Ã—</button>
      </div>
      <div class="modal-body" id="edit-fleet-vehicle-content"></div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="removeVehicleFromFleet()">Remove from Fleet</button>
        <button class="btn btn-primary" onclick="saveFleetVehicle()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Bulk Service Wizard Modal -->
  <div class="modal-backdrop" id="bulk-service-wizard-modal">
    <div class="modal wide">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ“… Schedule Bulk Service</h3>
        <button class="modal-close" onclick="closeModal('bulk-service-wizard-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- Wizard Steps Indicator -->
        <div class="wizard-steps">
          <div class="wizard-step active" data-step="1"><span class="wizard-step-num">1</span> Service Details</div>
          <div class="wizard-step" data-step="2"><span class="wizard-step-num">2</span> Select Vehicles</div>
          <div class="wizard-step" data-step="3"><span class="wizard-step-num">3</span> Schedule Dates</div>
          <div class="wizard-step" data-step="4"><span class="wizard-step-num">4</span> Review & Submit</div>
        </div>

        <!-- Step 1: Service Details -->
        <div class="bulk-wizard-step" id="bulk-step-1">
          <div class="form-group">
            <label class="form-label">Batch Title *</label>
            <input type="text" class="form-input" id="bulk-batch-title" placeholder="e.g., Q1 Oil Change - All Vehicles">
          </div>
          
          <div class="form-group">
            <label class="form-label">Service Type *</label>
            <select class="form-select" id="bulk-service-type">
              <option value="">Select service type...</option>
              <optgroup label="Maintenance">
                <option value="oil_change">Oil Change</option>
                <option value="tire_rotation">Tire Rotation</option>
                <option value="brake_inspection">Brake Inspection</option>
                <option value="full_inspection">Full Vehicle Inspection</option>
              </optgroup>
              <optgroup label="Detailing & Appearance">
                <option value="detailing">Detailing/Wash</option>
                <option value="ceramic_coating">Ceramic Coating</option>
                <option value="car_wrap">Car Wrap</option>
              </optgroup>
              <optgroup label="Audio & Electronics">
                <option value="dash_cameras">Dash Camera Install</option>
                <option value="rideshare_cameras">Rideshare Camera Setup</option>
                <option value="sound_system">Sound System Install</option>
              </optgroup>
              <optgroup label="Lighting">
                <option value="christmas_lights">Holiday/Christmas Lights</option>
                <option value="led_lighting">LED Lighting Upgrades</option>
              </optgroup>
              <optgroup label="Modifications">
                <option value="lift_kit">Lift Kit Installation</option>
                <option value="custom_wheels">Custom Wheels/Rims</option>
              </optgroup>
              <option value="other">Other Maintenance</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="bulk-batch-description" placeholder="Additional details about the service requirements..."></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Preferred Date Range Start *</label>
              <input type="date" class="form-input" id="bulk-date-start">
            </div>
            <div class="form-group">
              <label class="form-label">Preferred Date Range End *</label>
              <input type="date" class="form-input" id="bulk-date-end">
            </div>
          </div>
        </div>

        <!-- Step 2: Select Vehicles -->
        <div class="bulk-wizard-step" id="bulk-step-2" style="display:none;">
          <div style="margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;">
            <span style="font-weight:500;"><span id="bulk-selected-count">0</span> vehicles selected</span>
            <button class="btn btn-ghost btn-sm" onclick="toggleAllBulkVehicles()">Select All</button>
          </div>
          <div id="bulk-vehicles-list" style="display:grid;gap:12px;max-height:400px;overflow-y:auto;"></div>
        </div>

        <!-- Step 3: Schedule Dates -->
        <div class="bulk-wizard-step" id="bulk-step-3" style="display:none;">
          <p style="color:var(--text-secondary);margin-bottom:16px;">Set preferred service dates for each selected vehicle:</p>
          <div id="bulk-schedule-list" style="display:grid;gap:12px;max-height:400px;overflow-y:auto;"></div>
        </div>

        <!-- Step 4: Review & Submit -->
        <div class="bulk-wizard-step" id="bulk-step-4" style="display:none;">
          <div id="bulk-review-content"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="bulk-prev-btn" onclick="bulkWizardPrev()" style="display:none;">â† Previous</button>
        <button class="btn btn-secondary" onclick="closeModal('bulk-service-wizard-modal')">Cancel</button>
        <button class="btn btn-primary" id="bulk-next-btn" onclick="bulkWizardNext()">Next â†’</button>
        <button class="btn btn-primary" id="bulk-submit-btn" onclick="submitBulkServiceBatch()" style="display:none;">Submit for Approval</button>
      </div>
    </div>
  </div>

  <!-- Fleet Settings Modal -->
  <div class="modal-backdrop" id="fleet-settings-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">âš™ï¸ Fleet Settings</h3>
        <button class="modal-close" onclick="closeModal('fleet-settings-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Fleet Name *</label>
          <input type="text" class="form-input" id="fleet-settings-name">
        </div>
        
        <div class="form-group">
          <label class="form-label">Company Name</label>
          <input type="text" class="form-input" id="fleet-settings-company-name" placeholder="Legal company name">
        </div>
        
        <div class="form-group">
          <label class="form-label">Business Type</label>
          <select class="form-select" id="fleet-settings-business-type">
            <option value="rental">Rental</option>
            <option value="corporate">Corporate</option>
            <option value="delivery">Delivery</option>
            <option value="rideshare">Rideshare</option>
            <option value="logistics">Logistics</option>
            <option value="government">Government</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Billing Email</label>
          <input type="email" class="form-input" id="fleet-settings-billing-email" placeholder="billing@company.com">
        </div>
        
        <div class="form-group">
          <label class="form-label">Business Address</label>
          <textarea class="form-textarea" id="fleet-settings-address" placeholder="Street address, City, State, ZIP" style="min-height:60px;"></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Tax ID / EIN (Optional)</label>
          <input type="text" class="form-input" id="fleet-settings-tax-id" placeholder="XX-XXXXXXX">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('fleet-settings-modal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveFleetSettings()">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- 2FA Verification Modal -->
  <div class="modal-backdrop" id="2fa-verify-modal">
    <div class="modal" style="max-width:420px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ” Verify Your Phone</h3>
        <button class="modal-close" onclick="close2FAVerifyModal()">Ã—</button>
      </div>
      <div class="modal-body" style="text-align:center;">
        <div style="font-size:3rem;margin-bottom:16px;">ðŸ“±</div>
        <p style="color:var(--text-secondary);margin-bottom:8px;">We sent a verification code to</p>
        <p id="2fa-verify-phone-display" style="font-weight:600;font-size:1.1rem;margin-bottom:24px;color:var(--accent-blue);">(555) 555-5555</p>
        
        <div class="form-group" style="margin-bottom:20px;">
          <label class="form-label" style="text-align:center;">Enter 6-digit code</label>
          <div style="display:flex;justify-content:center;gap:8px;">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-1" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 1)" onkeydown="handle2FAKeydown(event, 1)">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-2" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 2)" onkeydown="handle2FAKeydown(event, 2)">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-3" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 3)" onkeydown="handle2FAKeydown(event, 3)">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-4" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 4)" onkeydown="handle2FAKeydown(event, 4)">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-5" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 5)" onkeydown="handle2FAKeydown(event, 5)">
            <input type="text" class="form-input 2fa-digit" id="2fa-digit-6" maxlength="1" style="width:48px;height:56px;text-align:center;font-size:1.5rem;font-weight:600;" oninput="handle2FADigitInput(this, 6)" onkeydown="handle2FAKeydown(event, 6)">
          </div>
        </div>
        
        <div id="2fa-verify-error" style="display:none;color:var(--accent-red);margin-bottom:16px;font-size:0.9rem;"></div>
        
        <button class="btn btn-primary" id="2fa-verify-btn" onclick="verify2FACode()" style="width:100%;margin-bottom:16px;" disabled>
          Verify & Enable 2FA
        </button>
        
        <div style="font-size:0.85rem;color:var(--text-muted);">
          Didn't receive the code? 
          <button onclick="resend2FACode()" style="background:none;border:none;color:var(--accent-blue);cursor:pointer;font-size:0.85rem;text-decoration:underline;" id="2fa-resend-btn">Resend Code</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 2FA Disable Confirmation Modal -->
  <div class="modal-backdrop" id="2fa-disable-modal">
    <div class="modal" style="max-width:420px;">
      <div class="modal-header">
        <h3 class="modal-title">ðŸ”“ Disable 2FA</h3>
        <button class="modal-close" onclick="close2FADisableModal()">Ã—</button>
      </div>
      <div class="modal-body" style="text-align:center;">
        <div style="font-size:3rem;margin-bottom:16px;">âš ï¸</div>
        <h4 style="margin-bottom:12px;">Are you sure?</h4>
        <p style="color:var(--text-secondary);margin-bottom:24px;line-height:1.6;">
          Disabling two-factor authentication will make your account less secure. 
          Anyone with your password will be able to access your account.
        </p>
        
        <div style="display:flex;gap:12px;justify-content:center;">
          <button class="btn btn-secondary" onclick="close2FADisableModal()">Cancel</button>
          <button class="btn btn-danger" onclick="confirm2FADisable()">Yes, Disable 2FA</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Release Payment Confirmation Modal -->
  <div class="modal-backdrop" id="release-payment-modal">
    <div class="modal" style="max-width:520px;">
      <div class="modal-header">
        <h3 class="modal-title">âœ“ Confirm Job Complete</h3>
        <button class="modal-close" onclick="closeModal('release-payment-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:24px;">
          <div style="font-size:3rem;margin-bottom:12px;">ðŸ’°</div>
          <h4 style="margin-bottom:8px;">Release Payment to Provider</h4>
          <p style="color:var(--text-secondary);font-size:0.95rem;">You are about to confirm that the service is complete and release payment.</p>
        </div>
        
        <div style="background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:20px;margin-bottom:20px;">
          <div id="release-payment-details">
            <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
              <span style="color:var(--text-secondary);">Service</span>
              <span id="release-payment-service" style="font-weight:600;"></span>
            </div>
            <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
              <span style="color:var(--text-secondary);">Provider</span>
              <span id="release-payment-provider" style="font-weight:500;"></span>
            </div>
            <div style="display:flex;justify-content:space-between;padding-top:12px;border-top:1px solid var(--border-subtle);">
              <span style="color:var(--text-secondary);font-weight:600;">Amount to Release</span>
              <span id="release-payment-amount" style="font-size:1.3rem;font-weight:700;color:var(--accent-gold);"></span>
            </div>
          </div>
        </div>
        
        <div style="background:var(--accent-blue-soft);border:1px solid rgba(56,189,248,0.3);border-radius:var(--radius-md);padding:16px;margin-bottom:20px;">
          <div style="display:flex;align-items:flex-start;gap:12px;">
            <span style="font-size:1.2rem;">â„¹ï¸</span>
            <div style="font-size:0.9rem;color:var(--text-secondary);line-height:1.6;">
              <strong style="color:var(--accent-blue);">What happens next:</strong><br>
              â€¢ The held payment will be released to the service provider<br>
              â€¢ This action cannot be undone<br>
              â€¢ You'll be asked to leave a review for the provider
            </div>
          </div>
        </div>
        
        <label style="display:flex;align-items:flex-start;gap:12px;padding:16px;background:var(--bg-elevated);border:1px solid var(--border-subtle);border-radius:var(--radius-md);cursor:pointer;margin-bottom:20px;">
          <input type="checkbox" id="release-payment-confirm-checkbox" style="margin-top:3px;width:20px;height:20px;accent-color:var(--accent-green);">
          <span style="color:var(--text-secondary);font-size:0.9rem;line-height:1.5;">
            I confirm that I have received my vehicle and the service has been completed satisfactorily. I understand this will release the payment to the provider and cannot be undone.
          </span>
        </label>
        
        <div style="display:flex;gap:12px;">
          <button class="btn btn-secondary" onclick="closeModal('release-payment-modal')" style="flex:1;">Cancel</button>
          <button class="btn btn-success" id="release-payment-btn" onclick="confirmReleasePayment()" style="flex:1;" disabled>
            âœ“ Release Payment
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabaseclient.js?v=20260122"></script>
  <script src="mcc-config.js?v=20260122"></script>
  <script src="tos-modal.js?v=20260122"></script>
  <script src="emailService.js?v=20260122"></script>
  <script src="mobile-pay.js?v=20260124"></script>
  <script src="stripeutils.js?v=20260124"></script>
  <script src="members-core.js?v=20260122"></script>
  <script src="members-packages.js?v=20260124"></script>
  <script src="/pwa-init.js?v=20260122"></script>
  <script src="/chat-widget-base.js?v=20260122"></script>
  <script src="/ai-chat.js?v=20260122"></script>
  <script src="/helpdesk-widget.js?v=20260122"></script>
  <script>
    function toggleTheme() {
      const html = document.documentElement;
      html.classList.add('theme-transition');
      const current = html.getAttribute('data-theme');
      const newTheme = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      const metaTheme = document.querySelector('meta[name="theme-color"]');
      if (metaTheme) {
        metaTheme.content = newTheme === 'dark' ? '#12161c' : '#ffffff';
      }
      setTimeout(() => html.classList.remove('theme-transition'), 300);
    }

    let helpdeskInstance = null;
    
    function openCarAcademyAI() {
      if (helpdeskInstance && typeof helpdeskInstance.openWithMode === 'function') {
        helpdeskInstance.openWithMode('education');
      } else {
        helpdeskInstance = new HelpdeskWidget({ mode: 'education', position: 'bottom-right' });
        setTimeout(() => {
          if (helpdeskInstance && helpdeskInstance.open) {
            helpdeskInstance.open();
          }
        }, 100);
      }
    }
    
    // Onboarding checklist functions
    function checkOnboardingStatus() {
      const dismissed = localStorage.getItem('mcc_onboarding_dismissed');
      if (dismissed) return;
      
      const vehicleCount = parseInt(document.getElementById('stat-vehicles')?.textContent || '0');
      const packageCount = parseInt(document.getElementById('stat-packages')?.textContent || '0');
      
      // Show onboarding if user has less than 1 vehicle or 1 package
      if (vehicleCount < 1 || packageCount < 1) {
        const checklist = document.getElementById('onboarding-checklist');
        if (checklist) checklist.style.display = 'block';
        updateOnboardingProgress();
      }
    }
    
    function updateOnboardingProgress() {
      const vehicleCount = parseInt(document.getElementById('stat-vehicles')?.textContent || '0');
      const packageCount = parseInt(document.getElementById('stat-packages')?.textContent || '0');
      
      let completed = 0;
      
      // Step 1: Add vehicle
      const step1 = document.getElementById('step-add-vehicle');
      if (vehicleCount > 0 && step1) {
        step1.classList.add('completed');
        step1.querySelector('.step-check').textContent = 'âœ“';
        completed++;
      }
      
      // Step 2: Verify vehicle (check if any vehicle is verified - simplified check)
      // For now, mark as pending - would need API call to check verification status
      
      // Step 3: Create request
      const step3 = document.getElementById('step-create-request');
      if (packageCount > 0 && step3) {
        step3.classList.add('completed');
        step3.querySelector('.step-check').textContent = 'âœ“';
        completed++;
      }
      
      // Update progress bar
      const progressFill = document.getElementById('onboarding-progress-fill');
      const progressText = document.getElementById('onboarding-progress-text');
      if (progressFill) progressFill.style.width = `${(completed / 3) * 100}%`;
      if (progressText) progressText.textContent = `${completed} of 3 complete`;
      
      // Auto-hide if all complete
      if (completed >= 2) {
        setTimeout(() => {
          const checklist = document.getElementById('onboarding-checklist');
          if (checklist) checklist.style.display = 'none';
        }, 2000);
      }
    }
    
    function dismissOnboarding() {
      localStorage.setItem('mcc_onboarding_dismissed', 'true');
      const checklist = document.getElementById('onboarding-checklist');
      if (checklist) checklist.style.display = 'none';
    }
    
    // Check onboarding after stats are loaded
    const statsObserver = new MutationObserver(() => {
      checkOnboardingStatus();
    });
    const vehicleStat = document.getElementById('stat-vehicles');
    if (vehicleStat) {
      statsObserver.observe(vehicleStat, { childList: true, characterData: true, subtree: true });
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      await I18n.init();
      I18n.createLanguageSwitcher('language-switcher');
      
      helpdeskInstance = new HelpdeskWidget({ mode: 'driver', position: 'bottom-right' });
      
      // Initial onboarding check after a short delay for stats to load
      setTimeout(checkOnboardingStatus, 1500);
    });
  </script>
</body>
</html>
