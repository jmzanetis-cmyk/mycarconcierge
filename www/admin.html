<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Portal ‚Äì My Car Concierge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0a0f" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="My Car Concierge" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-card: rgba(18, 18, 28, 0.85);
      --bg-elevated: rgba(28, 28, 42, 0.95);
      --bg-input: rgba(22, 22, 34, 0.9);
      --text-primary: #f4f4f6;
      --text-secondary: #9898a8;
      --text-muted: #6b6b7a;
      --accent-gold: #d4a855;
      --accent-gold-soft: rgba(212, 168, 85, 0.15);
      --accent-blue: #4a7cff;
      --accent-blue-soft: rgba(74, 124, 255, 0.12);
      --accent-green: #4ac88c;
      --accent-green-soft: rgba(74, 200, 140, 0.12);
      --accent-red: #ef5f5f;
      --accent-red-soft: rgba(239, 95, 95, 0.15);
      --accent-orange: #f59e0b;
      --accent-orange-soft: rgba(245, 158, 11, 0.15);
      --border-subtle: rgba(148, 148, 168, 0.12);
      --border-medium: rgba(148, 148, 168, 0.2);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { height: 100vh; font-family: 'Outfit', -apple-system, sans-serif; background: var(--bg-deep); color: var(--text-primary); display: flex; overflow: hidden; }

    /* Custom scrollbar styling */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(148, 148, 168, 0.3); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(148, 148, 168, 0.5); }
    ::-webkit-scrollbar-corner { background: transparent; }
    * { scrollbar-width: thin; scrollbar-color: rgba(148, 148, 168, 0.3) transparent; }

    .sidebar { width: 260px; background: var(--bg-card); border-right: 1px solid var(--border-subtle); padding: 24px 16px; display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 50; overflow-y: auto; }
    .sidebar-brand { display: flex; align-items: center; gap: 12px; padding: 0 12px 24px; border-bottom: 1px solid var(--border-subtle); margin-bottom: 24px; text-decoration: none; }
    .sidebar-brand img { height: 120px; border-radius: var(--radius-md); image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges; transition: all 0.3s ease; }
    .sidebar-brand:hover img { filter: drop-shadow(0 8px 32px rgba(212, 168, 85, 0.5)); transform: scale(1.03); }
    .sidebar-brand span { font-family: 'Playfair Display', serif; font-weight: 500; color: var(--text-primary); }
    .nav-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text-muted); padding: 0 12px; margin: 20px 0 8px; }
    .nav-label:first-of-type { margin-top: 0; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-md); cursor: pointer; font-size: 0.92rem; color: var(--text-secondary); transition: all 0.15s; margin-bottom: 4px; }
    .nav-item:hover { background: var(--accent-blue-soft); color: var(--text-primary); }
    .nav-item.active { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .nav-badge { margin-left: auto; font-size: 0.72rem; font-weight: 600; padding: 2px 8px; border-radius: 100px; }
    .nav-badge.red { background: var(--accent-red); color: white; }
    .nav-badge.orange { background: var(--accent-orange); color: #0a0a0f; }
    .nav-badge.green { background: var(--accent-green); color: #022c22; }
    .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-subtle); }

    .main { flex: 1; margin-left: 260px; padding: 32px 40px; height: 100%; overflow-y: auto; }
    .page-header { margin-bottom: 32px; }
    .back-to-dashboard { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-secondary); font-size: 0.85rem; cursor: pointer; transition: all 0.2s; margin-bottom: 16px; -webkit-tap-highlight-color: rgba(212, 168, 85, 0.3); }
    .back-to-dashboard:hover, .back-to-dashboard:active { background: var(--accent-gold-soft); color: var(--accent-gold); border-color: var(--accent-gold); }
    .page-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 500; margin-bottom: 8px; }
    .page-subtitle { color: var(--text-secondary); font-size: 0.95rem; }

    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .stat-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; }
    .quick-stat-btn { display:flex; justify-content:space-between; align-items:center; width:100%; padding:12px; background:var(--bg-elevated); border:none; border-radius:var(--radius-md); cursor:pointer; transition:background 0.2s; color:inherit; font-size:inherit; font-family:inherit; text-align:left; -webkit-tap-highlight-color:rgba(212, 168, 85, 0.3); }
    .quick-stat-btn:hover, .quick-stat-btn:active, .quick-stat-btn:focus { background:var(--bg-card); outline:none; }
    .stat-icon { width: 44px; height: 44px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 12px; }
    .stat-value { font-size: 1.8rem; font-weight: 600; margin-bottom: 2px; }
    .stat-label { font-size: 0.82rem; color: var(--text-muted); }
    .stat-card-clickable { cursor: pointer; transition: all 0.2s ease; -webkit-tap-highlight-color: rgba(212, 168, 85, 0.3); }
    .stat-card-clickable:hover, .stat-card-clickable:active { background: var(--bg-elevated); border-color: var(--accent-gold); transform: translateY(-2px); }
    .stat-card-clickable:focus { outline: 2px solid var(--accent-gold); outline-offset: 2px; }
    .stat-preview { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-subtle); font-size: 0.82rem; color: var(--text-secondary); display: none; }
    .stat-preview.has-data { display: block; }
    .stat-preview-item { display: flex; align-items: center; gap: 8px; padding: 6px 0; }
    .stat-preview-item:not(:last-child) { border-bottom: 1px dashed var(--border-subtle); }
    .stat-preview-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .stat-preview-more { color: var(--accent-gold); font-size: 0.75rem; margin-top: 8px; }
    .stat-tap-hint { font-size: 0.72rem; color: var(--accent-gold); margin-top: 10px; opacity: 0.8; }

    .card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 20px; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .card-title { font-size: 1.1rem; font-weight: 600; }

    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; font-family: inherit; font-size: 0.88rem; font-weight: 500; border: none; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: linear-gradient(135deg, var(--accent-blue), #6b9fff); color: white; }
    .btn-success { background: var(--accent-green); color: #022c22; }
    .btn-danger { background: var(--accent-red-soft); color: var(--accent-red); border: 1px solid rgba(239,95,95,0.3); }
    .btn-secondary { background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-subtle); }
    .btn-ghost { background: transparent; color: var(--text-secondary); padding: 8px 12px; }
    .btn-sm { padding: 6px 12px; font-size: 0.82rem; }

    .section { display: none; }
    .section.active { display: block; }

    .tabs { display: flex; gap: 4px; margin-bottom: 24px; border-bottom: 1px solid var(--border-subtle); }
    .tab { padding: 12px 20px; font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; }
    .tab:hover { color: var(--text-primary); }
    .tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }

    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 14px 16px; border-bottom: 1px solid var(--border-subtle); }
    th { font-size: 0.82rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    td { font-size: 0.9rem; }
    tr:hover { background: var(--bg-elevated); }

    .status-badge { padding: 4px 12px; border-radius: 100px; font-size: 0.75rem; font-weight: 500; }
    .status-badge.pending, .status-badge.orange { background: var(--accent-orange-soft); color: var(--accent-orange); }
    .status-badge.approved, .status-badge.resolved, .status-badge.released { background: var(--accent-green-soft); color: var(--accent-green); }
    .status-badge.rejected, .status-badge.disputed, .status-badge.red { background: var(--accent-red-soft); color: var(--accent-red); }
    .status-badge.held, .status-badge.investigating, .status-badge.blue { background: var(--accent-blue-soft); color: var(--accent-blue); }
    .status-badge.open { background: var(--accent-gold-soft); color: var(--accent-gold); }
    .status-badge.muted, .status-badge.dismissed { background: var(--bg-elevated); color: var(--text-muted); }

    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: none; align-items: flex-start; justify-content: center; z-index: 100; padding: 48px 24px; overflow-y: auto; }
    .modal-backdrop.active { display: flex; }
    .modal { background: var(--bg-elevated); border: 1px solid var(--border-medium); border-radius: var(--radius-xl); width: 100%; max-width: 700px; animation: modalIn 0.2s ease; }
    @keyframes modalIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 24px 28px; border-bottom: 1px solid var(--border-subtle); }
    .modal-title { font-size: 1.15rem; font-weight: 600; }
    .modal-close { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: transparent; border: none; color: var(--text-muted); cursor: pointer; border-radius: var(--radius-sm); font-size: 20px; }
    .modal-body { padding: 24px 28px; max-height: 60vh; overflow-y: auto; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 12px; padding: 20px 28px; border-top: 1px solid var(--border-subtle); }

    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary); }
    .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 16px; background: var(--bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: inherit; font-size: 0.92rem; }
    .form-textarea { min-height: 100px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-section { margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid var(--border-subtle); }
    .form-section:last-child { border-bottom: none; }
    .form-section-title { font-weight: 600; margin-bottom: 16px; }

    .detail-grid { display: grid; grid-template-columns: 140px 1fr; gap: 8px 16px; font-size: 0.9rem; }
    .detail-label { color: var(--text-muted); }
    .detail-value { color: var(--text-primary); }

    .checklist { display: flex; flex-direction: column; gap: 12px; }
    .checklist-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-input); border-radius: var(--radius-md); }
    .checklist-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent-green); }
    .checklist-item label { flex: 1; font-size: 0.9rem; }
    .checklist-item.checked { background: var(--accent-green-soft); }

    .doc-list { display: flex; flex-direction: column; gap: 8px; }
    .doc-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--bg-input); border-radius: var(--radius-md); }
    .doc-item-info { display: flex; align-items: center; gap: 12px; }
    .doc-icon { font-size: 20px; }

    .evidence-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; }
    .evidence-item { aspect-ratio: 4/3; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border-subtle); cursor: pointer; }
    .evidence-item img { width: 100%; height: 100%; object-fit: cover; }

    .empty-state { text-align: center; padding: 48px 24px; color: var(--text-muted); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }

    .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 200; }
    .toast { background: var(--bg-elevated); border: 1px solid var(--accent-green); border-radius: var(--radius-md); padding: 16px 20px; display: flex; align-items: center; gap: 12px; animation: toastIn 0.3s ease; margin-top: 12px; }
    @keyframes toastIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .alert { padding: 16px 20px; border-radius: var(--radius-md); margin-bottom: 20px; font-size: 0.9rem; }
    .alert.warning { background: var(--accent-orange-soft); border: 1px solid rgba(245,158,11,0.3); color: var(--accent-orange); }
    .alert.info { background: var(--accent-blue-soft); border: 1px solid rgba(74,124,255,0.3); color: var(--accent-blue); }

    /* Toggle Switch Styles */
    .toggle-switch input:checked + .toggle-slider { background: var(--accent-green-soft); border-color: var(--accent-green); }
    .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 2px; bottom: 2px; background: var(--accent-red); border-radius: 50%; transition: 0.3s; }
    .toggle-switch input:checked + .toggle-slider:before { transform: translateX(24px); background: var(--accent-green); }

    @media (max-width: 900px) {
      .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
      .sidebar.open { transform: translateX(0); }
      .main { margin-left: 0; padding: 20px 16px; padding-top: 80px; padding-bottom: env(safe-area-inset-bottom, 20px); }
      .form-row { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
      .stat-card { padding: 16px; min-height: 140px; }
      .stat-card-clickable { touch-action: manipulation; }
      .stat-icon { width: 36px; height: 36px; font-size: 16px; margin-bottom: 8px; }
      .stat-value { font-size: 1.5rem; }
      .stat-label { font-size: 0.78rem; }
      .stat-tap-hint { font-size: 0.68rem; margin-top: 8px; }
      .stat-preview { font-size: 0.75rem; margin-top: 8px; padding-top: 8px; }
      .stat-preview-item { padding: 4px 0; }
      .mobile-header { display: flex; }
      .sidebar-overlay { display: block; }
      .dashboard-grid-2col { grid-template-columns: 1fr !important; }
      .quick-stat-btn { min-height: 52px; touch-action: manipulation; position: relative; z-index: 1; }
      .page-title { font-size: 1.5rem; }
      .page-subtitle { font-size: 0.88rem; }
      .card { padding: 16px; margin-bottom: 16px; }
      .card-header { margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
      .card-title { font-size: 1rem; }
      table { font-size: 0.82rem; }
      th, td { padding: 10px 8px; }
      .btn { padding: 12px 16px; font-size: 0.9rem; }
      .modal { margin: 16px; max-width: calc(100vw - 32px); }
      .modal-body { padding: 20px; max-height: 70vh; }
    }

    .mobile-header {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 40;
    }
    .mobile-header-left { display: flex; align-items: center; gap: 12px; }
    .hamburger-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
    }
    .mobile-header-title { font-family: 'Playfair Display', serif; font-size: 1.1rem; }
    .mobile-logout-btn {
      padding: 8px 16px;
      background: var(--accent-red-soft);
      border: 1px solid rgba(239,95,95,0.3);
      border-radius: var(--radius-md);
      color: var(--accent-red);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
    }
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 45;
    }
    .sidebar-overlay.active { display: block; }
  </style>
  <script src="/i18n.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Mobile Header -->
  <header class="mobile-header">
    <div class="mobile-header-left">
      <button class="hamburger-btn" onclick="toggleSidebar()">‚ò∞</button>
      <span class="mobile-header-title">Admin Portal</span>
    </div>
    <button class="mobile-logout-btn" onclick="logout()">Log Out</button>
  </header>
  
  <!-- Sidebar Overlay (for mobile) -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

  <aside class="sidebar" id="sidebar">
    <a href="index.html" class="sidebar-brand">
      <img src="logo.png" alt="My Car Concierge">
    </a>
    <div id="language-switcher" style="padding:0 12px 16px;"></div>

    <div class="nav-label">Overview</div>
    <div class="nav-item active" data-section="dashboard">üìä Dashboard</div>
    <div class="nav-item" data-section="analytics">üìà Analytics</div>

    <div class="nav-label">Provider Management</div>
    <div class="nav-item" data-section="applications">üìã Applications <span class="nav-badge orange" id="app-count">0</span></div>
    <div class="nav-item" data-section="providers">‚úì Active Providers</div>
    <div class="nav-item" data-section="violations">üö© Violation Reports <span class="nav-badge red" id="violation-count">0</span></div>
    <div class="nav-item" data-section="car-reviews">üìù CAR Reviews <span class="nav-badge orange" id="car-count">0</span></div>

    <div class="nav-label">Founder Management</div>
    <div class="nav-item" data-section="pilot-applications">üåü Provider Founders <span class="nav-badge orange" id="pilot-count">0</span></div>
    <div class="nav-item" data-section="member-founders">üë• Member Founders <span class="nav-badge orange" id="member-founder-count">0</span></div>
    <div class="nav-item" data-section="commission-payouts">üí∞ Commission Payouts <span class="nav-badge green" id="payout-count">0</span></div>

    <div class="nav-label">Operations</div>
    <div class="nav-item" data-section="packages">üì¶ All Packages</div>
    <div class="nav-item" data-section="payments">üí≥ Payments</div>
    <div class="nav-item" data-section="disputes">‚ö†Ô∏è Disputes <span class="nav-badge red" id="dispute-count">0</span></div>

    <div class="nav-label">Support</div>
    <div class="nav-item" data-section="tickets">üé´ Help Desk <span class="nav-badge green" id="ticket-count">0</span></div>
    <div class="nav-item" data-section="members">üë• Members</div>
    <div class="nav-item" data-section="user-roles">üîÑ User Roles</div>
    <div class="nav-item" data-section="user-management">üë• User Management</div>

    <div class="nav-label">System</div>
    <div class="nav-item" data-section="settings">‚öôÔ∏è Settings</div>

    <div class="sidebar-footer">
      <button class="btn btn-secondary" onclick="window.location.href='members.html'" style="width:100%;margin-bottom:8px;padding:12px 16px;">üè† Member Portal</button>
      <button class="btn btn-secondary" onclick="logout()" style="width:100%;padding:14px 20px;font-size:0.95rem;">üö™ Log Out</button>
    </div>
  </aside>

  <main class="main">
    <!-- Dashboard Section -->
    <section id="dashboard" class="section active">
      <div class="page-header">
        <h1 class="page-title">Admin Dashboard</h1>
        <p class="page-subtitle">My Car Concierge Management Portal</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('applications')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-orange-soft);">üìã</div>
          <div class="stat-value" id="stat-pending-apps">0</div>
          <div class="stat-label">Pending Applications</div>
          <div class="stat-preview" id="preview-pending-apps"></div>
          <div class="stat-tap-hint">Tap to view ‚Üí</div>
        </div>
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('providers')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-green-soft);">‚úì</div>
          <div class="stat-value" id="stat-active-providers">0</div>
          <div class="stat-label">Active Providers</div>
          <div class="stat-preview" id="preview-active-providers"></div>
          <div class="stat-tap-hint">Tap to view ‚Üí</div>
        </div>
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('payments')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-blue-soft);">üí≥</div>
          <div class="stat-value" id="stat-escrow">$0</div>
          <div class="stat-label">In Escrow</div>
          <div class="stat-tap-hint">Tap for details ‚Üí</div>
        </div>
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('disputes')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-red-soft);">‚ö†Ô∏è</div>
          <div class="stat-value" id="stat-open-disputes">0</div>
          <div class="stat-label">Open Disputes</div>
          <div class="stat-preview" id="preview-open-disputes"></div>
          <div class="stat-tap-hint">Tap to view ‚Üí</div>
        </div>
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('analytics')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-gold-soft);">üí∞</div>
          <div class="stat-value" id="stat-revenue">$0</div>
          <div class="stat-label">Revenue (7.5%)</div>
          <div class="stat-tap-hint">Tap for details ‚Üí</div>
        </div>
        <div class="stat-card stat-card-clickable" onclick="navigateToSection('packages')" role="button" tabindex="0">
          <div class="stat-icon" style="background:var(--accent-blue-soft);">üì¶</div>
          <div class="stat-value" id="stat-packages">0</div>
          <div class="stat-label">Active Packages</div>
          <div class="stat-preview" id="preview-packages"></div>
          <div class="stat-tap-hint">Tap to view ‚Üí</div>
        </div>
      </div>

      <!-- Dashboard Charts Section -->
      <div class="card" style="margin-bottom:20px;">
        <div class="card-header">
          <h2 class="card-title">üìä Dashboard Overview</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-sm dashboard-period active" data-period="week">Week</button>
            <button class="btn btn-sm dashboard-period" data-period="month">Month</button>
            <button class="btn btn-sm dashboard-period" data-period="quarter">Quarter</button>
            <button class="btn btn-sm dashboard-period" data-period="year">Year</button>
          </div>
        </div>
        <div class="stats-grid" style="grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));margin-bottom:24px;">
          <div class="stat-card">
            <div class="stat-icon" style="background:var(--accent-blue-soft);color:var(--accent-blue);">üë•</div>
            <div class="stat-value" id="dash-total-members">0</div>
            <div class="stat-label">Total Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:var(--accent-gold-soft);color:var(--accent-gold);">üîß</div>
            <div class="stat-value" id="dash-total-providers">0</div>
            <div class="stat-label">Total Providers</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">üì¶</div>
            <div class="stat-value" id="dash-active-packages">0</div>
            <div class="stat-label">Active Packages</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:var(--accent-gold-soft);color:var(--accent-gold);">üí∞</div>
            <div class="stat-value" id="dash-total-revenue">$0</div>
            <div class="stat-label">Total Revenue</div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(350px, 1fr));gap:20px;">
          <div style="background:var(--bg-elevated);border-radius:var(--radius-md);padding:16px;">
            <h3 style="font-size:0.95rem;margin-bottom:12px;color:var(--text-secondary);">üí∞ Revenue Over Time</h3>
            <div style="height:220px;position:relative;">
              <canvas id="dashboard-revenue-chart"></canvas>
            </div>
          </div>
          <div style="background:var(--bg-elevated);border-radius:var(--radius-md);padding:16px;">
            <h3 style="font-size:0.95rem;margin-bottom:12px;color:var(--text-secondary);">üë• User Growth</h3>
            <div style="height:220px;position:relative;">
              <canvas id="dashboard-users-chart"></canvas>
            </div>
          </div>
          <div style="background:var(--bg-elevated);border-radius:var(--radius-md);padding:16px;">
            <h3 style="font-size:0.95rem;margin-bottom:12px;color:var(--text-secondary);">üì¶ Orders / Services</h3>
            <div style="height:220px;position:relative;">
              <canvas id="dashboard-orders-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Requires Attention</h2>
        </div>
        <div id="attention-items">
          <div class="empty-state">
            <div class="empty-state-icon">‚úÖ</div>
            <p>All caught up!</p>
          </div>
        </div>
      </div>

      <div class="dashboard-grid-2col" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Recent Activity</h2>
          </div>
          <div id="recent-activity-feed">
            <div class="empty-state">
              <div class="empty-state-icon">üìä</div>
              <p>Loading activity...</p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Quick Stats (Last 7 Days)</h2>
          </div>
          <div id="quick-stats">
            <div style="display:grid;gap:12px;">
              <button type="button" class="quick-stat-btn" data-nav="user-management">
                <span>New Members</span>
                <span style="display:flex;align-items:center;gap:8px;"><strong id="stat-new-members">0</strong><span style="color:var(--accent-gold);">‚Ä∫</span></span>
              </button>
              <button type="button" class="quick-stat-btn" data-nav="analytics">
                <span>Packages Created</span>
                <span style="display:flex;align-items:center;gap:8px;"><strong id="stat-new-packages">0</strong><span style="color:var(--accent-gold);">‚Ä∫</span></span>
              </button>
              <button type="button" class="quick-stat-btn" data-nav="analytics">
                <span>Bids Submitted</span>
                <span style="display:flex;align-items:center;gap:8px;"><strong id="stat-new-bids">0</strong><span style="color:var(--accent-gold);">‚Ä∫</span></span>
              </button>
              <button type="button" class="quick-stat-btn" data-nav="analytics">
                <span>Jobs Completed</span>
                <span style="display:flex;align-items:center;gap:8px;"><strong id="stat-completed-jobs">0</strong><span style="color:var(--accent-gold);">‚Ä∫</span></span>
              </button>
              <button type="button" class="quick-stat-btn" data-nav="payments">
                <span>Total Processed</span>
                <span style="display:flex;align-items:center;gap:8px;"><strong id="stat-total-processed">$0</strong><span style="color:var(--accent-gold);">‚Ä∫</span></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üìà Analytics</h1>
        <p class="page-subtitle">Platform performance and growth metrics</p>
      </div>

      <!-- Date Range Filter -->
      <div class="card" style="margin-bottom:24px;">
        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
          <span style="font-weight:500;">Date Range:</span>
          <button class="btn btn-sm analytics-range active" data-days="7">Last 7 days</button>
          <button class="btn btn-sm analytics-range" data-days="30">Last 30 days</button>
          <button class="btn btn-sm analytics-range" data-days="90">Last 90 days</button>
          <button class="btn btn-sm analytics-range" data-days="365">Last year</button>
          <button class="btn btn-sm analytics-range" data-days="0">All time</button>
        </div>
      </div>

      <!-- Key Metrics -->
      <div class="stats-grid" style="grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">üí∞</div>
          <div class="stat-value" id="analytics-revenue">$0</div>
          <div class="stat-label">Total Revenue (MCC Fees)</div>
          <div id="analytics-revenue-change" style="font-size:0.8rem;margin-top:4px;"></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-blue-soft);color:var(--accent-blue);">üì¶</div>
          <div class="stat-value" id="analytics-packages">0</div>
          <div class="stat-label">Packages Created</div>
          <div id="analytics-packages-change" style="font-size:0.8rem;margin-top:4px;"></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-gold-soft);color:var(--accent-gold);">üí¨</div>
          <div class="stat-value" id="analytics-bids">0</div>
          <div class="stat-label">Bids Submitted</div>
          <div id="analytics-bids-change" style="font-size:0.8rem;margin-top:4px;"></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="analytics-completed">0</div>
          <div class="stat-label">Jobs Completed</div>
          <div id="analytics-completed-change" style="font-size:0.8rem;margin-top:4px;"></div>
        </div>
      </div>

      <!-- Charts Row -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(400px, 1fr));gap:20px;margin-bottom:20px;">
        <!-- Revenue Chart -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üí∞ Revenue Over Time</h2>
          </div>
          <div id="revenue-chart" style="height:250px;display:flex;align-items:flex-end;gap:4px;padding:20px 0;"></div>
        </div>

        <!-- Signups Chart -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üë• New Signups</h2>
          </div>
          <div id="signups-chart" style="height:250px;display:flex;align-items:flex-end;gap:4px;padding:20px 0;"></div>
        </div>
      </div>

      <!-- More Stats Row -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:20px;">
        <!-- Top Providers -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">‚≠ê Top Providers</h2>
          </div>
          <div id="top-providers-list">
            <p style="color:var(--text-muted);">Loading...</p>
          </div>
        </div>

        <!-- Category Breakdown -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üìä Service Categories</h2>
          </div>
          <div id="category-breakdown">
            <p style="color:var(--text-muted);">Loading...</p>
          </div>
        </div>

        <!-- Platform Health -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üè• Platform Health</h2>
          </div>
          <div id="platform-health">
            <div style="display:grid;gap:12px;">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span>Bid-to-Accept Rate</span>
                <span id="health-bid-rate" style="font-weight:600;">--%</span>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span>Avg Bids per Package</span>
                <span id="health-avg-bids" style="font-weight:600;">--</span>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span>Avg Provider Rating</span>
                <span id="health-avg-rating" style="font-weight:600;">-- ‚≠ê</span>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span>Dispute Rate</span>
                <span id="health-dispute-rate" style="font-weight:600;">--%</span>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span>Avg Time to Accept Bid</span>
                <span id="health-time-to-accept" style="font-weight:600;">-- hrs</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Applications Section -->
    <section id="applications" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Provider Applications</h1>
        <p class="page-subtitle">Review and vet provider applications</p>
      </div>

      <div class="tabs">
        <div class="tab active" data-filter="pending">Pending</div>
        <div class="tab" data-filter="under_review">Under Review</div>
        <div class="tab" data-filter="approved">Approved</div>
        <div class="tab" data-filter="rejected">Rejected</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Business</th>
              <th>Type</th>
              <th>Location</th>
              <th>Submitted</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="applications-table">
            <tr><td colspan="6" class="empty-state">No applications</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Pilot Applications Section -->
    <section id="pilot-applications" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üåü Founding Provider Applications</h1>
        <p class="page-subtitle">Review and approve founding provider pilot program applications</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);color:var(--accent-orange);">‚è≥</div>
          <div class="stat-value" id="pilot-pending">0</div>
          <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="pilot-approved">0</div>
          <div class="stat-label">Approved</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-red-soft);color:var(--accent-red);">‚úó</div>
          <div class="stat-value" id="pilot-rejected">0</div>
          <div class="stat-label">Rejected</div>
        </div>
      </div>

      <div class="tabs" id="pilot-tabs">
        <div class="tab active" data-filter="pending">Pending</div>
        <div class="tab" data-filter="approved">Approved</div>
        <div class="tab" data-filter="rejected">Rejected</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Business Name</th>
              <th>Services</th>
              <th>Location</th>
              <th>Phone</th>
              <th>Submitted</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="pilot-applications-table">
            <tr><td colspan="7" class="empty-state">No pilot applications</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Member Founder Applications Section -->
    <section id="member-founders" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üë• Member Founder Applications</h1>
        <p class="page-subtitle">Review and approve member founder ambassador program applications</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);color:var(--accent-orange);">‚è≥</div>
          <div class="stat-value" id="mf-pending">0</div>
          <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="mf-approved">0</div>
          <div class="stat-label">Approved</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-red-soft);color:var(--accent-red);">‚úó</div>
          <div class="stat-value" id="mf-rejected">0</div>
          <div class="stat-label">Rejected</div>
        </div>
      </div>

      <div class="tabs" id="mf-tabs">
        <div class="tab active" data-filter="pending">Pending</div>
        <div class="tab" data-filter="approved">Approved</div>
        <div class="tab" data-filter="rejected">Rejected</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Location</th>
              <th>Promotion Method</th>
              <th>Submitted</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="member-founders-table">
            <tr><td colspan="7" class="empty-state">No member founder applications</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Commission Payouts Section -->
    <section id="commission-payouts" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üí∞ Commission Payouts</h1>
        <p class="page-subtitle">Manage member founder commissions and payouts</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-gold-soft);color:var(--accent-gold);">üë•</div>
          <div class="stat-value" id="total-founders">0</div>
          <div class="stat-label">Active Founders</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-blue-soft);color:var(--accent-blue);">üìä</div>
          <div class="stat-value" id="total-referrals">0</div>
          <div class="stat-label">Total Referrals</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);color:var(--accent-orange);">‚è≥</div>
          <div class="stat-value" id="pending-commissions">$0</div>
          <div class="stat-label">Pending Payouts</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="total-paid">$0</div>
          <div class="stat-label">Total Paid</div>
        </div>
      </div>

      <div class="tabs" id="payout-tabs">
        <div class="tab active" data-filter="founders">Founders</div>
        <div class="tab" data-filter="pending-payouts">Pending Payouts</div>
        <div class="tab" data-filter="completed-payouts">Completed Payouts</div>
      </div>

      <div id="payout-content">
        <div class="card" style="padding:0;overflow:hidden;">
          <table>
            <thead>
              <tr id="payout-table-header">
                <th>Founder</th>
                <th>Referral Code</th>
                <th>Provider Referrals</th>
                <th>Pending Balance</th>
                <th>Total Earned</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="payout-table-body">
              <tr><td colspan="7" class="empty-state">Loading founder data...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Active Providers Section -->
    <section id="providers" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Active Providers</h1>
        <p class="page-subtitle">Manage approved service providers</p>
      </div>

      <!-- Bulk Actions Bar -->
      <div id="bulk-actions-bar" class="card" style="display:none;margin-bottom:16px;padding:16px 20px;background:var(--accent-blue-soft);border:1px solid rgba(74,124,255,0.3);">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;">
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-weight:500;"><span id="selected-count">0</span> providers selected</span>
            <button class="btn btn-sm btn-secondary" onclick="clearSelection()">Clear</button>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn btn-sm btn-secondary" onclick="bulkAddCredits()">üéüÔ∏è Add Credits</button>
            <button class="btn btn-sm btn-secondary" onclick="bulkSendMessage()">üí¨ Send Message</button>
            <button class="btn btn-sm btn-secondary" onclick="bulkExport()">üì• Export</button>
            <button class="btn btn-sm" style="background:var(--accent-orange-soft);color:var(--accent-orange);border:1px solid rgba(245,158,11,0.3);" onclick="bulkSuspend()">‚è∏Ô∏è Suspend</button>
            <button class="btn btn-sm" style="background:var(--accent-green-soft);color:var(--accent-green);border:1px solid rgba(74,200,140,0.3);" onclick="bulkActivate()">‚úì Activate</button>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="card" style="margin-bottom:16px;">
        <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
          <div class="form-group" style="margin:0;min-width:150px;">
            <select class="form-input" id="provider-status-filter" onchange="filterProviders()" style="padding:8px 12px;">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          <div class="form-group" style="margin:0;min-width:150px;">
            <select class="form-input" id="provider-credits-filter" onchange="filterProviders()" style="padding:8px 12px;">
              <option value="all">All Credits</option>
              <option value="zero">No Credits</option>
              <option value="low">Low (1-10)</option>
              <option value="has">Has Credits (10+)</option>
            </select>
          </div>
          <div class="form-group" style="margin:0;min-width:150px;">
            <select class="form-input" id="provider-rating-filter" onchange="filterProviders()" style="padding:8px 12px;">
              <option value="all">All Ratings</option>
              <option value="low">‚ö†Ô∏è Below 4 Stars</option>
              <option value="good">4+ Stars</option>
              <option value="new">New (No Rating)</option>
            </select>
          </div>
          <div class="form-group" style="margin:0;min-width:150px;">
            <select class="form-input" id="provider-type-filter" onchange="filterProviders()" style="padding:8px 12px;">
              <option value="all">All Types</option>
              <option value="founding">üåü Founding Only</option>
              <option value="standard">Standard Only</option>
            </select>
          </div>
          <div class="form-group" style="margin:0;flex:1;min-width:200px;">
            <input type="text" class="form-input" id="provider-search" placeholder="Search by name or email..." oninput="filterProviders()" style="padding:8px 12px;">
          </div>
          <button class="btn btn-sm" style="background:var(--accent-red-soft);color:var(--accent-red);border:1px solid rgba(220,53,69,0.3);" onclick="checkLowRatedProviders()">‚ö†Ô∏è Check Low Ratings</button>
        </div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th style="width:40px;"><input type="checkbox" id="select-all-providers" onchange="toggleSelectAll(this)"></th>
              <th>Business</th>
              <th>Credits</th>
              <th>Rating</th>
              <th>Jobs</th>
              <th>Earnings</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="providers-table">
            <tr><td colspan="7" class="empty-state">No active providers</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Violation Reports Section -->
    <section id="violations" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üö© Circumvention Reports</h1>
        <p class="page-subtitle">Investigate policy violations reported by members</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-red-soft);color:var(--accent-red);">üö©</div>
          <div class="stat-value" id="violations-pending">0</div>
          <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);color:var(--accent-orange);">üîç</div>
          <div class="stat-value" id="violations-investigating">0</div>
          <div class="stat-label">Under Investigation</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="violations-confirmed">0</div>
          <div class="stat-label">Confirmed</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--bg-elevated);color:var(--text-muted);">‚úó</div>
          <div class="stat-value" id="violations-dismissed">0</div>
          <div class="stat-label">Dismissed</div>
        </div>
      </div>

      <div class="tabs" id="violations-tabs">
        <div class="tab active" data-filter="pending">Pending</div>
        <div class="tab" data-filter="investigating">Investigating</div>
        <div class="tab" data-filter="confirmed">Confirmed</div>
        <div class="tab" data-filter="dismissed">Dismissed</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div id="violations-list">
        <div class="empty-state" style="padding:40px;">
          <div class="empty-state-icon">üö©</div>
          <p>No violation reports to review</p>
        </div>
      </div>
    </section>

    <!-- All Packages Section -->
    <section id="packages" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">All Packages</h1>
        <p class="page-subtitle">View all maintenance packages across the platform</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-value" id="packages-open">0</div>
          <div class="stat-label">Open (Bidding)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="packages-accepted">0</div>
          <div class="stat-label">Accepted</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="packages-in-progress">0</div>
          <div class="stat-label">In Progress</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="packages-completed">0</div>
          <div class="stat-label">Completed</div>
        </div>
      </div>

      <div class="tabs" id="packages-tabs">
        <div class="tab active" data-filter="all">All</div>
        <div class="tab" data-filter="open">Open</div>
        <div class="tab" data-filter="accepted">Accepted</div>
        <div class="tab" data-filter="in_progress">In Progress</div>
        <div class="tab" data-filter="completed">Completed</div>
        <div class="tab" data-filter="expired">Expired</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Package</th>
              <th>Member</th>
              <th>Vehicle</th>
              <th>Category</th>
              <th>Bids</th>
              <th>Status</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody id="packages-table">
            <tr><td colspan="7" class="empty-state">Loading packages...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Payments Section -->
    <section id="payments" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Payments & Escrow</h1>
        <p class="page-subtitle">Track all platform transactions</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-value" id="payments-held">$0</div>
          <div class="stat-label">Currently Held</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="payments-released">$0</div>
          <div class="stat-label">Released (30 days)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="payments-refunded">$0</div>
          <div class="stat-label">Refunded (30 days)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="payments-fees">$0</div>
          <div class="stat-label">MCC Fees (30 days)</div>
        </div>
      </div>

      <div class="tabs">
        <div class="tab active" data-filter="held">In Escrow</div>
        <div class="tab" data-filter="released">Released</div>
        <div class="tab" data-filter="refunded">Refunded</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Package</th>
              <th>Member</th>
              <th>Provider</th>
              <th>Amount</th>
              <th>MCC Fee</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="payments-table">
            <tr><td colspan="7" class="empty-state">No payments</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Disputes Section -->
    <section id="disputes" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Disputes</h1>
        <p class="page-subtitle">Review and resolve member/provider disputes</p>
      </div>

      <div class="alert warning" id="high-value-alert" style="display:none;">
        ‚ö†Ô∏è There are disputes over $1,000 that may require third-party inspection.
      </div>

      <div class="tabs">
        <div class="tab active" data-filter="open">Open</div>
        <div class="tab" data-filter="under_review">Under Review</div>
        <div class="tab" data-filter="inspection">Needs Inspection</div>
        <div class="tab" data-filter="resolved">Resolved</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Package</th>
              <th>Filed By</th>
              <th>Reason</th>
              <th>Amount</th>
              <th>Filed</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="disputes-table">
            <tr><td colspan="7" class="empty-state">No disputes</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Help Desk Section -->
    <section id="tickets" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Help Desk</h1>
        <p class="page-subtitle">Support tickets from members and providers</p>
      </div>

      <div class="tabs">
        <div class="tab active" data-filter="open">Open</div>
        <div class="tab" data-filter="in_progress">In Progress</div>
        <div class="tab" data-filter="resolved">Resolved</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Subject</th>
              <th>From</th>
              <th>Category</th>
              <th>Priority</th>
              <th>Submitted</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="tickets-table">
            <tr><td colspan="7" class="empty-state">No tickets</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Members Section -->
    <section id="members" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">Members</h1>
        <p class="page-subtitle">View all registered members</p>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Account Type</th>
              <th>Vehicles</th>
              <th>Packages</th>
              <th>Joined</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="members-table">
            <tr><td colspan="7" class="empty-state">No members</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="user-roles" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">User Roles Management</h1>
        <p class="page-subtitle">Enable dual-role access for users (member + provider)</p>
      </div>

      <div class="alert info" style="margin-bottom:24px;">
        <strong>Dual-Role Access:</strong> Users can have access to both Member and Provider portals. Enable "Also Provider" for members who need provider access, or "Also Member" for providers who need member access. They'll see a "Switch Portal" button in their sidebar.
      </div>

      <div class="card" style="margin-bottom:20px;">
        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
          <input type="text" id="user-roles-search" class="form-input" placeholder="Search by name or email..." style="max-width:300px;" oninput="filterUserRoles()">
          <select id="user-roles-filter" class="form-select" style="max-width:200px;" onchange="filterUserRoles()">
            <option value="all">All Users</option>
            <option value="member">Members Only</option>
            <option value="provider">Providers Only</option>
            <option value="dual">Dual-Role Users</option>
          </select>
        </div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Primary Role</th>
              <th>Also Member</th>
              <th>Also Provider</th>
              <th>Joined</th>
            </tr>
          </thead>
          <tbody id="user-roles-table">
            <tr><td colspan="6" class="empty-state">Loading users...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- User Management Section -->
    <section id="user-management" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üë• User Management</h1>
        <p class="page-subtitle">View, search, filter, and manage all users with their various roles</p>
      </div>

      <div class="card" style="margin-bottom:20px;">
        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
          <input type="text" id="user-management-search" class="form-input" placeholder="Search by name, email, or phone..." style="max-width:350px;" oninput="searchUsers(this.value)">
          <button class="btn btn-secondary btn-sm" onclick="refreshUserManagement()">üîÑ Refresh</button>
        </div>
      </div>

      <div class="tabs" id="user-management-tabs" style="flex-wrap:wrap;">
        <div class="tab active" data-filter="all">All Users</div>
        <div class="tab" data-filter="member">Members Only</div>
        <div class="tab" data-filter="provider">Providers Only</div>
        <div class="tab" data-filter="founding-member">Founding Members</div>
        <div class="tab" data-filter="founding-provider">Founding Providers</div>
        <div class="tab" data-filter="provider-referrers">Provider Referrers</div>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-blue-soft);">üë•</div>
          <div class="stat-value" id="um-total-users">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);">üè†</div>
          <div class="stat-value" id="um-total-members">0</div>
          <div class="stat-label">Members</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-gold-soft);">üîß</div>
          <div class="stat-value" id="um-total-providers">0</div>
          <div class="stat-label">Providers</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);">üåü</div>
          <div class="stat-value" id="um-total-founders">0</div>
          <div class="stat-label">Founders</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-red-soft);">üö´</div>
          <div class="stat-value" id="um-suspended">0</div>
          <div class="stat-label">Suspended</div>
        </div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <div style="overflow-x:auto;">
          <table>
            <thead>
              <tr>
                <th>Name / Email</th>
                <th>Role</th>
                <th>Founder Status</th>
                <th>Referral Count</th>
                <th>Status</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="user-management-table">
              <tr><td colspan="7" class="empty-state">Loading users...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CAR Reviews Section -->
    <section id="car-reviews" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">üìù CAR Reviews</h1>
        <p class="page-subtitle">Review Corrective Action Responses from suspended providers</p>
      </div>

      <div class="stats-grid" style="margin-bottom:24px;">
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-orange-soft);color:var(--accent-orange);">‚è≥</div>
          <div class="stat-value" id="car-pending">0</div>
          <div class="stat-label">Pending Review</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-blue-soft);color:var(--accent-blue);">üîç</div>
          <div class="stat-value" id="car-under-review">0</div>
          <div class="stat-label">Under Review</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-green-soft);color:var(--accent-green);">‚úì</div>
          <div class="stat-value" id="car-approved">0</div>
          <div class="stat-label">Approved</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background:var(--accent-red-soft);color:var(--accent-red);">‚úó</div>
          <div class="stat-value" id="car-rejected">0</div>
          <div class="stat-label">Rejected</div>
        </div>
      </div>

      <div class="tabs" id="car-tabs">
        <div class="tab active" data-filter="pending">Pending</div>
        <div class="tab" data-filter="under_review">Under Review</div>
        <div class="tab" data-filter="approved">Approved</div>
        <div class="tab" data-filter="rejected">Rejected</div>
        <div class="tab" data-filter="revision_requested">Revision Requested</div>
        <div class="tab" data-filter="all">All</div>
      </div>

      <div class="card" style="padding:0;overflow:hidden;">
        <div style="overflow-x:auto;">
          <table>
            <thead>
              <tr>
                <th>Provider</th>
                <th>Submitted</th>
                <th>Primary Complaint</th>
                <th>Complaint Count</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="car-table">
              <tr><td colspan="6" class="empty-state">Loading CAR submissions...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings" class="section">
      <div class="page-header">
        <button class="back-to-dashboard" onclick="navigateToSection('dashboard')">‚Üê Dashboard</button>
        <h1 class="page-title">‚öôÔ∏è System Settings</h1>
        <p class="page-subtitle">Configure global platform settings</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Security Settings</h2>
        </div>
        <div style="display:flex;flex-direction:column;gap:20px;">
          <div style="display:flex;justify-content:space-between;align-items:center;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);">
            <div>
              <div style="font-weight:600;margin-bottom:4px;">Two-Factor Authentication Enforcement</div>
              <div style="font-size:0.85rem;color:var(--text-secondary);">When enabled, users with 2FA configured must verify their identity to access protected features. Disable temporarily for App Store review.</div>
            </div>
            <label class="toggle-switch" style="position:relative;display:inline-block;width:52px;height:28px;flex-shrink:0;margin-left:20px;">
              <input type="checkbox" id="global-2fa-toggle" onchange="toggle2faGlobal(this.checked)" style="opacity:0;width:0;height:0;">
              <span class="toggle-slider" style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--accent-red-soft);border:2px solid var(--accent-red);border-radius:28px;transition:0.3s;"></span>
            </label>
          </div>
          <div id="2fa-status-message" style="display:none;padding:12px 16px;border-radius:var(--radius-md);font-size:0.9rem;"></div>
        </div>
      </div>
    </section>
    
    <div style="text-align:center;padding:40px 20px 20px;font-size:0.8rem;color:var(--text-muted);">
      ¬© 2025 My Car Concierge. All rights reserved. - IMOR
    </div>
  </main>

  <!-- Application Review Modal -->
  <div class="modal-backdrop" id="application-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Review Application</h3>
        <button class="modal-close" onclick="closeModal('application-modal')">√ó</button>
      </div>
      <div class="modal-body" id="application-modal-body">
        <!-- Populated by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="requestMoreInfo()">Request More Info</button>
        <button class="btn btn-danger" onclick="rejectApplication()">Reject</button>
        <button class="btn btn-success" onclick="approveApplication()">Approve</button>
      </div>
    </div>
  </div>

  <!-- Dispute Review Modal -->
  <div class="modal-backdrop" id="dispute-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Review Dispute</h3>
        <button class="modal-close" onclick="closeModal('dispute-modal')">√ó</button>
      </div>
      <div class="modal-body" id="dispute-modal-body">
        <!-- Populated by JS -->
      </div>
      <div class="modal-footer" id="dispute-modal-footer">
        <!-- Dynamic buttons based on dispute state -->
      </div>
    </div>
  </div>

  <!-- Ticket Modal -->
  <div class="modal-backdrop" id="ticket-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Support Ticket</h3>
        <button class="modal-close" onclick="closeModal('ticket-modal')">√ó</button>
      </div>
      <div class="modal-body" id="ticket-modal-body">
        <!-- Populated by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('ticket-modal')">Close</button>
        <button class="btn btn-primary" onclick="sendTicketReply()">Send Reply</button>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toast-container"></div>

  <!-- User Edit Modal -->
  <div class="modal-backdrop" id="user-edit-modal">
    <div class="modal" style="max-width:800px;">
      <div class="modal-header">
        <h3 class="modal-title">üë§ Edit User</h3>
        <button class="modal-close" onclick="closeModal('user-edit-modal')">√ó</button>
      </div>
      <div class="modal-body" id="user-edit-modal-body" style="max-height:70vh;">
        <!-- Populated by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('user-edit-modal')">Close</button>
        <button class="btn btn-primary" id="save-user-btn" onclick="saveUserChanges()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- CAR Review Modal -->
  <div class="modal-backdrop" id="car-modal">
    <div class="modal" style="max-width:850px;">
      <div class="modal-header">
        <h3 class="modal-title">üìù Review Corrective Action Response</h3>
        <button class="modal-close" onclick="closeModal('car-modal')">√ó</button>
      </div>
      <div class="modal-body" id="car-modal-body" style="max-height:70vh;">
      </div>
      <div class="modal-footer" id="car-modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('car-modal')">Close</button>
        <button class="btn btn-danger" onclick="showCARRejectionForm()">Reject</button>
        <button class="btn" style="background:var(--accent-orange-soft);color:var(--accent-orange);border:1px solid var(--accent-orange);" onclick="reviewCAR(currentCAR?.id, 'revision_requested')">Request Revision</button>
        <button class="btn btn-success" onclick="reviewCAR(currentCAR?.id, 'approved')">Approve & Lift Suspension</button>
      </div>
    </div>
  </div>

  <!-- Admin Access Modal (Login + Password) -->
  <div class="modal-backdrop" id="admin-password-modal" style="display:flex;background:rgba(0,0,0,0.95);">
    <div class="modal" style="max-width:420px;">
      <div class="modal-header">
        <h3 class="modal-title" id="admin-modal-title">üîê Admin Access</h3>
      </div>
      <div class="modal-body">
        <!-- Login Form (shown when no session) -->
        <div id="admin-login-form" style="display:none;">
          <p style="color:var(--text-secondary);margin-bottom:20px;">Sign in with your admin account.</p>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="admin-login-email" placeholder="admin@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="admin-login-password" placeholder="Your account password">
          </div>
          <div id="admin-login-error" style="display:none;color:var(--accent-red);font-size:0.85rem;margin-top:8px;"></div>
        </div>
        
        <!-- Password Verification Form (shown when logged in as admin) -->
        <div id="admin-password-form">
          <p style="color:var(--text-secondary);margin-bottom:20px;">Enter the admin password to continue.</p>
          <div class="form-group">
            <label class="form-label">Admin Password</label>
            <input type="password" class="form-input" id="admin-password-input" placeholder="Enter admin password" autofocus>
          </div>
          <div id="admin-password-error" style="display:none;color:var(--accent-red);font-size:0.85rem;margin-top:8px;"></div>
          <div style="margin-top:16px;text-align:center;">
            <a href="#" onclick="showForgotAdminPassword(event)" style="color:var(--accent-gold);font-size:0.9rem;">Forgot admin password?</a>
          </div>
          <div id="admin-forgot-password-info" style="display:none;margin-top:16px;padding:16px;background:var(--bg-input);border-radius:var(--radius-md);border:1px solid var(--accent-gold);">
            <p style="color:var(--accent-gold);font-weight:500;margin-bottom:8px;">üîë Reset Admin Password</p>
            <p style="color:var(--text-secondary);font-size:0.85rem;line-height:1.5;">The admin password is stored securely in the Replit Secrets panel. To reset it:</p>
            <ol style="color:var(--text-secondary);font-size:0.85rem;line-height:1.8;margin:12px 0 0 16px;">
              <li>Open the Replit project</li>
              <li>Click the "Secrets" tab in the sidebar</li>
              <li>Find <code style="background:var(--bg-card);padding:2px 6px;border-radius:4px;">ADMIN_PASSWORD</code></li>
              <li>Update the value to your new password</li>
              <li>Redeploy to Netlify</li>
            </ol>
          </div>
        </div>
        
        <!-- Not Admin Error -->
        <div id="admin-not-admin-error" style="display:none;">
          <p style="color:var(--accent-red);margin-bottom:12px;">‚ö†Ô∏è Your account does not have admin privileges.</p>
          <p style="color:var(--text-secondary);font-size:0.9rem;">Please sign in with an admin account to access this portal.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="window.location.href='index.html'">Cancel</button>
        <button class="btn btn-primary" id="admin-modal-btn" onclick="handleAdminModalAction()">Continue</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabaseclient.js"></script>
  <script src="admin.js"></script>
  <script src="/pwa-init.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await I18n.init();
      I18n.createLanguageSwitcher('language-switcher');
    });
  </script>
</body>
</html>
